Listing of ER for Named ER: N4200790


=======================================================================
     NAMED ER: F42UI05 Edit Line
=======================================================================
     evt_CostLevel
     evt_InventoryInterface
     evt_IMBackFlag
     evt_Pointer
     evt_IBBackFlag
     evt_CheckAvailabilityFlag
     evt_PotencyControl
     evt_StandardPotency
     evt_LotProcessingCode
     evt_ErrorMessageReturned
     evt_LotStatus
     evt_QuantityOnHand
     evt_2716WarningFlag
     evt_QuantityAvailable
     evt_ShipQuantityDifference
     evt_ItemNumber
     evt_LineType
     evt_OriginalOrderQuantity
     evt_OriginalShipQuantity
     evt_OriginalBackorderQuantity
     evt_OriginalCancelQuantity
     evt_OriginalBranchPlant
     evt_OriginalLocation
     evt_OriginalLot
     evt_CommitFlag
     evt_OtherQuantityFlag
     evt_LastStatus
     evt_NextStatus
     evt_UnitCost
     evt_ExtendedCost
     evt_ForeignUnitCost
     evt_ForeignExtendedCost
     evt_UnitPrice
     evt_ExtendedAmount
     evt_ForeignUnitPrice
     evt_ForeignExtendedAmount
     evt_ContainerID
     evt_CarrierID
     evt_ItemWeight
     evt_WeightUoM
     evt_ApplyFreightFlag
     evt_CurrencyConversionRate
     evt_CurrencyCode
     evt_FreightCalculated
     evt_FreightRateCode
     evt_ErrorCode
     evt_PrimaryUoM
     evt_AllowPartialShipments
     evt_SDAllowBackorders
     evt_EditsProcessedFlag
     evt_GenericQuantity
     evt_ConversionFactor
     evt_ConvFactPricToPrim
     evt_UnitWeight
     evt_UnitVolume
     evt_RelatedItemNumber
     evt_SecondaryPrimaryUoM
     evt_PricingUoM
     evt_VolumeUoM
     evt_StandardUoMConversion
     evt_NextStatusSplit
     evt_WriteLedgerFlag
     evt_LocationCache
     evt_GENLNG_CursorB4200810
     evt_PO_NextStatusAddlLine
     evt_X4111Z1CacheLineNum
     evt_B4200310CacheLineNum
     evt_PO_DisplayKitItems
     evt_ErrorMessage
     evt_UpdateOnHandFlag
     evt_GenerateWOFlag
     evt_QuantityShipReversed
     evt_SoldToTable
     evt_ExtendedCostReversed
     evt_SerialNumberRequired
     evt_SerialNumberEditError
     evt_TodaysDate
     evt_RecordWrittentoB4200310
     evt_ErrorLineType
     evt_ValidateStatusCode
     evt_PO_NextStatusConfirm
     evt_PO_NextStatusBackOrder
     evt_PO_CheckAvailability
     evt_PO_PreventNegOnHand
     evt_PO_PreventOverShip
     evt_PO_BackCancelRemainQty
     evt_PO_ErrorLocationOnHold
     evt_PO_VersionR42565
     evt_MPSP_PlanFenceRule
     evt_PrimaryShipQuantity
     evt_OverShipConditionFlag
     evt_CostOverrideFlag
     evt_SoldToName_F0101
     evt_NextStatusTable
     evt_RetrieveCostFlag
     evt_QtySoftCommitSO_WO_Flag
     evt_ItemMasterExists
     evt_UnitCost_TransactionUOM
     evt_InterbranchOrderFlag
     evt_TransferUnitCost
     evt_TextLineYN
     evt_Company_F4211
     evt_CurrencyCodeSellingBranch
     evt_CurrencyCodeShipBranch
     evt_ShipTo_F4211
     evt_BranchPlant_F4201
     evt_RateDivisor
     evt_RateMultiplier
     evt_RateMultiplier_String
     evt_TransactionDateF4211
     evt_CatagorySalesCode1
     evt_SHBackFlag
     evt_Triangulation1_FromCurr
     evt_Triangulation2_ToCurr
     evt_CurrencyConvMethod_GetExch
     evt_TestResultsVersion
     evt_CertificateAnalyVersion
     evt_CertificateAnalyFlag
     evt_NextStatusOverride
     evt_PO_AgreementDestination
     evt_PO_AgreementBPFlag
     evt_PO_AgreementSearchFlag
     evt_SystemCodeBPSearch
     evt_AN8AgreementDestination
     evt_ForeignDepot
     evt_AgreementsFound
     evt_SaveQuantity
     evt_SaveBranchPlant
     evt_DestinationType1
     evt_UpdateGL_Accomadations
     evt_ErrorMessageAgreements
     evt_HDR_LastOverrideLineNumber
     evt_HDR_GLJobNumber
     evt_HDR_InventoryJobNumber
     evt_HDR_BatchStatus
     evt_HDR_LastJELine
     evt_HDR_BatchNumber
     evt_XT4111_DocNumOverride
     evt_XT4111_CompanyNumOverride
     evt_XT4111_DocTypeOverride
     evt_F4101_BulkPackFlag
     evt_XT4111_UpdateGL
     evt_XT4111_OverrideTargetAAI
     evt_XT4111_TransactionDate
     evt_UpdateSalesAgreement
     evt_XT4111_FromAlternateAAI
     evt_BorrowSourceTypeAgreement
     evt_BorrowSequenceAgreement
     evt_BorrowSourceAgreement
     evt_ForeignBPInventoryRelief
     evt_XT4111_UpdatePQOH
     evt_XT4111_BorrowAgreementSupp
     evt_XT4111_BorrowAgreementNumb
     evt_XT4111_BorrowAgreementSeq
     evt_XT4111_BorrowAgreementSour
     evt_XT4111_BorrowAgreeSourceTy
     evt_XT4111_BorrowDueTo
     evt_XT4111_BorrowSearchMethod
     evt_BulkUseManagementFlag
     evt_PriceAmbientStandardF49211
     evt_HDR_OverrideDocType
     evt_HDR_OverrideDocNumber
     evt_HDR_OverrideCompanyKey
     evt_GlCategory
     evt_PO_OverrideRelieveOnHand
     evt_Bulk_StdQtyEnteredReversed
     evt_Bulk_FromToFlag
     evt_BaseCurrenyCode_Agreement
     evt_CurrToConvert_Agreements
     evt_XT4111_UnitCost
     evt_StockingType_F4102
     evt_cQualityMgmtInstalled_EV01
     evt_cQualityControlYN_OT4Y
     evt_cUsePrefMinMax_EV01
     evt_cQMPassFail_EV01
     evt_cQMTestResultStatus_EV01
     evt_c109YWarningFlag_EV01
     evt_cPO_QMReEvalTestRslts_EV01
     evt_AmbientVolumeReversed_AMBR
     evt_WeightQuantityReverse_WGTR
     evt_Sales_AgreementNum_DMCT
     evt_Sales_AgreementSuppy_DMCS
     evt_PO_BulkTransactVolFlagEV01
     evt_DateLayerExpiration
     evt_ErrorLevel
     evt_ErrorMessageKits
     evt_LineNumberKitMaster
     evt_RelatedKitComponent
     evt_SDAllowBackordersParent
     evt_IMBackFlagParent
     evt_IBBackFlagParent
     evt_szReasonCode_RCD
     evt_cForeignCostFlag_EV01
     evt_OrderStatusValidateFlag
     evt_mnTempShortItem_ITM
     evt_szIdentifier2ndItem_LITM
     evt_szIdentifier3rdItem_AITM
     evt_PriceAdjustLineFlag_SO08
     evt_PriceRetrievalUOM_UMB1
     evt_Save_RecordWritten
     evt_StatusInWarehouse
     evt_ShipDateOverridden_SO07
     evt_ModeOfTransport_MOT
     evt_PurchasingReportCode1_PRP1
     evt_Prepay_OriginationFlag_POF
     evt_Prepay_SuffixNumber_SFXO
     evt_Prepay_SequenceNumber_SEQ
     evt_Prepay_TransactStatus_ATS
     evt_ConfiguredItemFlag
     evt_mnNewShipQty_UORG
     evt_RequestedDate_F4211_DRQJ
     evt_OriginalCommittedHS
     evt_TimeOfDay
     evt_CachedItemNumber
     evt_CachedLineType
     evt_CachedQuantityOrdered
     evt_CachedQuantityShipped
     evt_CachedQuantityBackordered
     evt_CachedQuantityCanceled
     evt_CachedLot
     evt_CachedLocation
     evt_CachedUpdateOnHandFlag
     evt_CachedInventoryInterface
     evt_CachedEditsProcessed
     evt_CachedConversionFactor
     evt_CachedOriginalLineNumber
     evt_CachedTransInventoryAffect
     evt_CachedActionCode
     evt_CachedBranchPlant
     evt_TableQuantityShipped
     evt_TableQuantityOrdered
     evt_Lot_BO_Cancel
     evt_Location_BO_Cancel
     evt_CommittedHS_Override
     evt_ShippedDifferenceReversal
     evt_CachedCommittedFlag
     evt_CachedOtherQuantity12
     evt_XT4111Z1_QtySoftCommitted
     evt_XT4111Z1_QtyHardCommitted
     evt_OtherQuantityFlagOverride
     evt_CachedLotProcessingCode
     evt_MultiLocationParentChange
     evt_CommitQuantityDifference
     evt_OtherCommitOverride
     evt_CachedOtherCommitOverride
     evt_CommitLocation
     evt_CommitmentSignReversal
     evt_CommitmentSignRollback
     evt_szFileFormatLocation_LOCN
     evt_XT4111Z1_GLDate_DGL
     evt_newPrimaryShipQuantity
     evt_XT4111_ConfiguredStringID
     evt_ConfiguredStringID
     evt_Tran_ShipmentNumber
     evt_CreditOrderLotValid_EV01
     evt_CreditOrderNoHdComXT4111Z1
     evt_BULK_PrimaryQty_STUM
     evt_BULK_PrimaryQtyReversed
     evt_CommitDifferenceExists
     evt_DualUnitOfMeasureItem
     evt_DualPickingProcessOption
     evt_ConvFactorTranstoSecondary
     evt_OriginalSecondaryQuantity
     evt_DualTolerance
     evt_CachedConvFactorTrantoDual
     evt_CachedSecondaryQuantity
     evt_TableSecondaryQuantity
     evt_SecondaryQtyOnHand
     evt_ConvFactorSecndtoScndPrime
     evt_ConvFactorSecondarytoTrans
     evt_ConvertedSecondaryQuantity
     evt_SecondaryShipQtyDifference
     evt_DualOrderNumber
     evt_DualOrderType
     evt_CommitScndryQtyDifference
     evt_CalculateForeignExtendedPr
     evt_EditingShippedQuantity
     evt_EditingOriginalShippedQty
     evt_EditforDualUOM
     evt_EditingTableShipQuantity
     evt_PrimaryScndryShipQuantity
     evt_EditingCachedShippedQty
     evt_CachedConvFactScndrytoTran
     evt_CachedConvFctScndtoScnPrim
     evt_SecondaryShipDiffReversal
     evt_QuantitySecondaryReversed
     evt_QuantityScndryConvReversed
     evt_NonDualSecondaryQty
     evt_ConvertNonDualItem
     evt_OriginalOrderQtySecondary
     evt_AssignConvertedOrderQty
     evt_DecimalsforRounding_SOQS
     evt_DecimalsforRounding_SQOR
     evt_MemoLotField1_LOT1
     evt_MemoLotField2_LOT2
     evt_MemoLotField3_LOT3
     evt_DualCompanyKeyOrderNo
     evt_PO_SADWarningError_EV01
     evt_F49211FetchedFlag_EV01
     evt_CommitmentDateMethod_CMDM
     evt_InventoryCommitPref_SO06
     evt_ShipAscendError_DTAI
     evt_PO_AllowNewLot4CreditOrder
     evt_F41001InvLotCreation_OT6Y
     evt_cNumRoundDecAEXP_CDEC
     evt_OnHandFlagF4211_SO02
     evt_ShipDateF4211Table_ADDJ
     evt_UnitCostTable_UNCS
     evt_CostExtendedTable_ECST
     evt_ForeignUnitCostTable_FUC
     evt_ForeignExtCostTable_FEC
     evt_ExtendedPriceTable_AEXP
     evt_ForeignExtPriceTable_FEA
     evt_ScheduledPickDate4211_PDDJ
     evt_PickSlipNumberTable_PSN
     evt_ItemVolumeTable_ITVL
     evt_PrimaryQtyOrderTable_PQOR
     evt_DateReleaseTable_RSDJ
     evt_StandardUOMConversion_TFLA
     evt_StockingType_F4101
     evt_WarehouseOnFlag_WCTL
     evt_CIBackAllowed_BACK
     evt_VendorLotNumber
     evt_BackorderQtyTable_SOBK
     evt_CancelQtyTable_SOCN
     evt_ConstAndPOCacheWrittenFlag
     evt_PO_OutboundEDITTypeTran
     evt_PO_OutboundUBERun
     evt_PO_R4210ICVersion
     evt_PO_CreateIntercoOrder
     evt_PO_QM_COAProcessFlag
     evt_PO_AutoPrintInvoice
     evt_PO_PrepaymentProcessing
     evt_PO_Prepay_AuthorizeVersion
     evt_PO_Prepay_SettleVersion
     evt_PO_Prepay_AuthorizeHold
     evt_PO_Prepay_SettleHold
     evt_PO_Prepay_AuthorizeStatus
     evt_PO_Prepay_SettleStatus
     evt_PO_Prepay_AuthorizeProcess
     evt_PO_Prepay_SettleProcess
     evt_PO_CallR45100Mode
     evt_PO_R45100Version
     evt_PO_R42950SubmitUpdate
     evt_PO_R42950Version
     evt_UserId
     evt_XT4111_TransactionDocType
     evt_XT4111_TransactionDocNum
     evt_XT4111_OrderNumber
     evt_XT4111_OrderType
     evt_XT4111_OrderCompany
     evt_XT4111_UpdateDataItem
     evt_XT4111_TransactProcessType
     evt_XT4111_F0911JobNumber
     evt_CallingAppToB4201210_EV01
     evt_DatePromisedPickF4211_PPDJ
     evt_FreightHandlingCodeF4211
     evt_LastStatus_saved
     evt_LotStatusCode_F4108
     evt_LotStatusCode_NewLoc
     evt_LotStatusCode1_NewLoc
     evt_PreferenceSchedule_PRSN
     evt_PreferenceRetrievalUOM
     evt_ErrorMsgAgreemtOvership
     evt_OrigShipQyB4MultSplit4Par
     evt_AgreementSrchQty_SOQS
     evt_ParentAddressNumbF4211_PAS
     evt_TransferDirectShipInterco
     evt_DirectShipAgreementExists
     evt_ProductAllocationFlag_SO10
     evt_387AWarningFlag
     evt_UpdateLastShipmentTableYN
     evt_Dual_ExtendPriceYesOrNo
     evt_InvErrorID_DTAI
     evt_ItemMasterPriceLevel_PLEV
     evt_ItemBranchPtr_GENLNG
     evt_BranchPlantConstPtr_GENLNG
     evt_TranCostInterBPMode_SO01
     evt_InventoryLineNumber_LNID
     evt_szCnfrmtnCartonStatus_CRSS
     evt_cDemandSchedReleased_DSRFU
     evt_szCartonCacheErrMsgID_DTAI
     evt_szCartonStatusErrMsg_DTAI
     evt_cCartonStatusPassFail_QPF
     evt_szItemGroup_PRGR
     evt_cUseNextOrderStsPref_UNOP
     evt_cPOReconcilCartonShip_RCSD
     evt_cCalledByTMS_EV01
     evt_szItemNumberPrimary_UITM
     evt_mnActualShipTimeTable_ADTM
     evt_mnReqDeliverTimeTable_DRQT
     evt_mnPromisedDlvrTimeTbl_RSDT
     evt_mnPromisedPickTimeTbl_PDTT
     evt_mnMultiLocDualAdjQty_SQOR
     evt_mnMultiLocDiffAdjQty_SQOR
     evt_mnWriteActualShipTime_ADTM
     evt_cPotencyMode_EV01
     evt_mnOriginalConvFactor_CNV1
     evt_mnBackorderConvFactor_CNV1
     evt_cExtendPCforNoShipQty_EV01
     evt_cAllowedLotStatusCode_EV01
     evt_PO_LotGroupName_LOTGRP
     evt_cLPSwitch_EV01
     evt_cLPExist_EV01
     evt_mnPrimaryQtyOnLP_MATH01
     evt_mnSecondaryQtyOnLP_MATH01
     evt_szCompany_Cache_CO
     evt_jdCancelDate_CNDJ
     evt_szF41021GlCategory_GLPT
     evt_SecondaryQtyPriceDiff_SQOR
     evt_szGlCategory_Cache_GLPT
     evt_cPricingBasedOnDate_CP01
     evt_jdPriceEffectiveDate_PEFJ
     evt_P4312_F4312ErrorID
     evt_PO_Intransit_Accounting
     evt_PO_P4312Version
     evt_P4312_POJobNumber
     evt_P4312_InvJobNumber
     evt_P4312_GLJobNumber
     evt_P4312_LCJobNumber
     evt_P4312_LCGLJobNumber
     evt_P4312_F4311JobNumber
     evt_P4312_TMSJobNumber
     evt_P4312_BatchNumber
     evt_P4312_BatchType
     evt_P4312_BatchStatus
     evt_P4312_BatchDate
     evt_P4312_RelatedPoNumber
     evt_P4312_OrderNumber
     evt_P4312_OrderType
     evt_P4312_OrderCompany
     evt_OrderSuffix
     evt_P4312_OrderSuffix
     evt_P4312_POLineNumber
     evt_P4312_GLDate
     evt_P4312_ReceiptDate
     evt_P4312_OrderHoldCode
     evt_P4312_Supplier
     evt_P4312_CurrencyProcessing
     evt_P4312_CurrencyMode
     evt_P4312_CurrencyCodeFrom
     evt_P4312_BaseCurrency
     evt_P4312_CurrencyConvMethod
     evt_P4312_TriangRateFrom
     evt_P4312_TriangRateTo
     evt_P4312_ExchangeRate
     evt_P4312_ReceiptBranch
     evt_P4312_Location
     evt_P4312_Lot
     evt_P4312_LastJELine
     evt_P4312_ProgramStatus
     evt_QtyOrderedInPrimary
     evt_mnDecimalsforRounding_PQOH
0001 // ===========================================================================
0002 // 7100995    CA6859852    04/16/04    Cancel line at ship confirm
0003 // 7100080    TT5459086    05/03/04    Process Allowed Lot Status
0004 // 7190089    CA6859852    07/14/04    Blank WF when nonblank primary
0005 // 7257546    CA6859852    07/30/04    License Plate Enhancement (LPN)
0006 // 7190599    RM5906864    08/07/04   Manual B/O & Conv Factor
0007 // 7135266    RM5906864    08/07/04   Qty Balance Error w/ B/O
0008 // 7187023    IC8866511     08/13/04     HCOM to be relieved for CI load after
0009 // a load confirmation
0010 // 7189985    JH6014180     08/17/04     Retrieve Company for BF BranchPlant
0011 // 7154871    IC8866319      08/20/04     Set Cardex Cost in Interbranch
0012 // Multicurrency Transaction of issuing B/P, not header B/P
0013 // 7202941    JH6014180     08/23/04     Write StatusInWarehouse to cache
0014 // 7190134    JH6014180     08/23/04     Write Cancel Date to cache
0015 // 7288641    JH6014180     08/24/04     Write GL Class to cache
0016 // 7302546   RB7567907     08/25/04     Re-extend Dual UOM Price
0017 // 7189942   JS6787836     08/26/04     Return lot memo
0018 // 7190142    JH6014180     08/29/04    Get Curr Code, Exch Rate to Ext. Cost
0019 // 7185618    JH6014180     08/29/04    Use Price Effective Date for
0020 // Interbranch
0021 // 7185378    JH6014180    09/09/04    Commitments and Other Quantity Buckets
0022 // 7369599    IC8562930     10/20/04    Currency Exchange Rate Error
0023 // 7379615    KC5867367    10/20/04    Location Error in Ship Confirm
0024 // 7398171   DO7041104     10/28/04    Currency Exchange Rate Error MultiLoc
0025 // 7445361   KS6271709     01/13/05    STOT Intransit Accounting
0026 // 7459720   MD5644340     02/14/05    Ship Confirm Edit Line Performance
0027 // 7461686    IC9017731      03/15/05   PQOR is inconsistant
0028 // 7412542   RB7567907     04/15/05   0505 error Dual UOM
0029 // 7593283   RB7567907     04/15/05   Not stopping on Avail warning.
0030 // 7451586   RB7567907     04/21/05   Fix Dual Commitments
0031 // 7629442   MD5644340     04/24/05   Ship Confirm Performance
0032 // ===========================================================================
0033 // Flag variable AssignConverted OrderQty is used to determine
0034 // when and how to compute the value of  OriginalOrderQtySecondary, the Order
0035 // Quantity for Secondary converted into the Transaction Unit of Measure.
0036 //
0037 //               0 = Multi Location Parent Line
0038 //               1 = Multi Location Child Line
0039 //               2 = Non Multi Location transaction
0040 // ===========================================================================
0041 // Initialize Variables
0042 // ===========================================================================
0043 //      Initialize Edits Processed Flag To Success
0044 //      1 = All Edits Successful
0045 //      0 = At Least One Edit In Error
0046 //
0047 VA evt_EditsProcessedFlag = "1"
0048 VA evt_Save_RecordWritten = BF cRecordWritten
0049 VA evt_cQualityMgmtInstalled_EV01 = "0"
0050 VA evt_ErrorMessageReturned = ""
0051 //
0052 // Get Job Number
0053 If BF mnJobnumberA is equal to <Blank>
0054    Get Internal Next NUmber
           BF mnJobnumberA <- mnJobnumberA
0055 End If
0056 //
0057 // For the purposes of Edit Line, the called by transportation flag only needs
0058 // to be  on or off.
0059 // Called By Transportation Flag Definitions:
0060 // 1 = Called By TMS for anything other than a standard load
0061 // 2 = Called By TMS for a standard load
0062 //
0063 If BF cCalledByTransportation is equal to "1,2"
0064    VA evt_cCalledByTMS_EV01 = "1"
0065 Else
0066    VA evt_cCalledByTMS_EV01 = ""
0067 End If
0068 //
0069 Load or Unload Ship Confirm Constants/POCache
        BF mnJobnumberA -> mnJobNumber
        BF szComputerID -> szComputerID
        "1" -> szCacheActionCode
        "2" -> mnNumberKeys
        "1" -> cSuppressErrorMessage
        VA evt_ErrorMessageReturned <- szErrorMessageID
        VA evt_PO_NextStatusConfirm <- szPO_NextStatusConfirm
        VA evt_PO_NextStatusAddlLine <- szPO_NextStatusAddlLine
        VA evt_PO_NextStatusBackOrder <- szPO_NextStatusBackOrder
        VA evt_PO_CheckAvailability <- cPO_CheckAvailability
        VA evt_PO_PreventNegOnHand <- cPO_PreventNegOnHand
        VA evt_PO_PreventOverShip <- cPO_PreventOverShip
        VA evt_PO_BackCancelRemainQty <- cPO_BackCancelRemainQty
        VA evt_PO_ErrorLocationOnHold <- cPO_ErrorLocationOnHold
        VA evt_PO_VersionR42565 <- szPO_VersionR42565
        VA evt_PO_DisplayKitItems <- cPO_DisplayKitItems
        VA evt_TestResultsVersion <- szPO_TestResultsVersion
        VA evt_CertificateAnalyFlag <- cPO_CertificateAnalyFlag
        VA evt_CertificateAnalyVersion <- szPO_CertificateAnalyVersion
        VA evt_PO_AgreementDestination <- szPO_AgreementDestination
        VA evt_PO_AgreementBPFlag <- cPO_AgreementBPFlag
        VA evt_PO_AgreementSearchFlag <- cPO_AgreementSearchFlag
        VA evt_PO_BulkTransactVolFlagEV01 <- cPO_BulkTransactVolFlag
        VA evt_PO_OverrideRelieveOnHand <- cPO_OverrideRelieveOnHand
        VA evt_cPO_QMReEvalTestRslts_EV01 <- cPO_QMReEvalTestRslts
        VA evt_PO_SADWarningError_EV01 <- cPO_SADWarningError
        VA evt_PO_AllowNewLot4CreditOrder <- cPO_NewLotsForCO
        VA evt_TodaysDate <- jdTodaysDate
        VA evt_TimeOfDay <- mnTimeOfDay
        VA evt_BulkUseManagementFlag <- cBulkUseMgmtFlag
        VA evt_cQualityMgmtInstalled_EV01 <- cQualityMgmtInstalled
        VA evt_PriceRetrievalUOM_UMB1 <- cPriceRetrievalUOM
        BF cShipAscendingDateFlag <- cShipAscendingDateFlag
        VA evt_cDemandSchedReleased_DSRFU <- cFutureUseChar01
        VA evt_szCnfrmtnCartonStatus_CRSS <- szMinimumCartonStatus
        VA evt_cPOReconcilCartonShip_RCSD <- cReconcileCartonShipmentDe
        VA evt_cUseNextOrderStsPref_UNOP <- cUse_Next_Order_Status_Pre
        VA evt_PO_LotGroupName_LOTGRP <- szLotGroup
        VA evt_cPricingBasedOnDate_CP01 <- cPricingBasedOnDate
        VA evt_PO_Intransit_Accounting <- cIntransit_Accounting
        VA evt_PO_P4312Version <- szP4312Version
0070 //
0071 //     If Error Message != Null (Constants/PO Cache hasn't been populated)
0072 //       Retrieve PO values, Dist. Constants, Audit Info, & Systems On Flags
0073 //     Else
0074 //       Cache has been written, set cache written flag = Y
0075 //
0076 If VA evt_ErrorMessageReturned is not equal to <Null>
0077    VA evt_ConstAndPOCacheWrittenFlag = "N"
0078    F4009 Get Distribution Constants
           VA evt_PriceRetrievalUOM_UMB1 <- cSalesPriceRetrievalUoM
           VA evt_cPricingBasedOnDate_CP01 <- cSalesPriceBasedOnDate
           BF cShipAscendingDateFlag <- cShipAscendingDateRule
           VA evt_PreferenceRetrievalUOM <- cPreferenceRetrievalUOM
           VA evt_PreferenceSchedule_PRSN <- szPreferenceSchedule
0079    If BF szVersion is less than or equal to <Blank>
0080       BF szVersion = "ZJDE0001"
0081    End If
0082    // =============================================================
0083    // Due to a Design Change the Minimum Carton Status listed in the Ship Confirm
0084    // Processing Options is actually the Confirmation Carton Status.
0085    // =============================================================
0086    Retrieve Ship Confirm PO Values
           BF szVersion -> szVersion
           VA evt_PO_NextStatusConfirm <- szStatusNextConfirmed
           VA evt_PO_NextStatusAddlLine <- szStatusNextAddLine
           VA evt_PO_NextStatusBackOrder <- szStatusNextBO
           VA evt_PO_CheckAvailability <- cCheckAvailability
           VA evt_PO_PreventNegOnHand <- cPreventNegativeShip
           VA evt_PO_PreventOverShip <- cPreventOverShip
           VA evt_PO_BackCancelRemainQty <- cBOorCancelRemains
           VA evt_PO_ErrorLocationOnHold <- cErrorItemLocation
           VA evt_PO_VersionR42565 <- szR42565Vers
           VA evt_PO_DisplayKitItems <- cDisplayKitItems
           VA evt_TestResultsVersion <- szTestResultsVersion
           VA evt_CertificateAnalyFlag <- szCertificateAnalyFlag
           VA evt_CertificateAnalyVersion <- szCertificateAnalyVersion
           VA evt_PO_AgreementDestination <- szAgreementDestination
           VA evt_PO_AgreementBPFlag <- cAgreementBPFlag
           VA evt_PO_AgreementSearchFlag <- cAgreementSearchFlag
           VA evt_PO_OutboundEDITTypeTran <- szTypeTransaction
           VA evt_PO_OutboundUBERun <- cOutboundUBERun
           VA evt_PO_BulkTransactVolFlagEV01 <- cBulkTransactionVolFlag
           VA evt_PO_R4210ICVersion <- szR4210ICversion
           VA evt_PO_CreateIntercoOrder <- cCreateIntercompanyOrder
           VA evt_PO_OverrideRelieveOnHand <- cAllowReliefofInventory
           VA evt_PO_QM_COAProcessFlag <- cCertificateOfAnalysisSub
           VA evt_cPO_QMReEvalTestRslts_EV01 <- cReevaluateQualityTests
           VA evt_PO_AutoPrintInvoice <- szAutoPrintInvoice
           VA evt_PO_PrepaymentProcessing <- cPrepaymentProcessing
           VA evt_PO_Prepay_AuthorizeVersion <- szAuthorizePPayTransVersion
           VA evt_PO_Prepay_SettleVersion <- szSettlePPayTransVersion
           VA evt_PO_Prepay_AuthorizeHold <- szAuthorizeHoldPPayProc
           VA evt_PO_Prepay_SettleHold <- szSettleHoldPPayProc
           VA evt_PO_Prepay_AuthorizeStatus <- szAuthLinesNextStatus
           VA evt_PO_Prepay_SettleStatus <- szSettledLinesNextStatus
           VA evt_PO_Prepay_AuthorizeProcess <- cProcessAuthorization
           VA evt_PO_Prepay_SettleProcess <- cProcessSettlement
           VA evt_PO_CallR45100Mode <- cCallR45100Mode
           VA evt_PO_R45100Version <- szR45100Version
           VA evt_PO_R42950SubmitUpdate <- cR42950SubmitUpdate
           VA evt_PO_R42950Version <- szR42950Version
           VA evt_PO_SADWarningError_EV01 <- cSADWarningError
           VA evt_PO_AllowNewLot4CreditOrder <- cNewLotsForCO
           VA evt_szCnfrmtnCartonStatus_CRSS <- szMinimumCartonStatus
           VA evt_cPOReconcilCartonShip_RCSD <- cReconcileCartonShipmentDe
           VA evt_cUseNextOrderStsPref_UNOP <- cUse_Next_Order_Status_Pre
           VA evt_PO_LotGroupName_LOTGRP <- szLotGroup
           VA evt_PO_Intransit_Accounting <- cIntransit_Accounting
           VA evt_PO_P4312Version <- szP4312Version
0087    Get Audit Information
           VA evt_UserId <- szUserName
           VA evt_TodaysDate <- jdDate
           VA evt_TimeOfDay <- mnTime
           UNDEFINED X szWorkstation_UserId
           UNDEFINED X szMachineKey
0088    Get Environment Value
           "SY41B" -> szDataItem
           VA evt_BulkUseManagementFlag <- cModuleExistance
0089    Get Environment Value
           "SY37" -> szDataItem
           VA evt_cQualityMgmtInstalled_EV01 <- cModuleExistance
0090    // ===========================================================
0091    // Check If Demand Scheduling has been released
0092    // ===========================================================
0093    Is Demand Scheduling Delivered For Use
           VA evt_cDemandSchedReleased_DSRFU <- cDemandSchedulingReleased
0094 Else
0095    VA evt_ConstAndPOCacheWrittenFlag = "Y"
0096 End If
0097 VA evt_ErrorMessageReturned = ""
0098 //
0099 // If Certificate of Analysis version is blank, then use ZJDE0001.
0100 If VA evt_CertificateAnalyVersion is equal to <Blank>
     Or VA evt_CertificateAnalyVersion is equal to <Null>
0101    VA evt_CertificateAnalyVersion = "ZJDE0001"
0102 End If
0103 //
0104 // If Test Results Version is blank, use ZJDE0002.
0105 If VA evt_TestResultsVersion is equal to <Blank>
     Or VA evt_TestResultsVersion is equal to <Null>
0106    VA evt_TestResultsVersion = "ZJDE0002"
0107 End If
0108 //
0109 // ************************************************************
0110 //    Inventory Affect Flag - Transportation
0111 //       0 = Normal Ship Confirm Logic
0112 //       1 = (future - not in use for ship confirm)
0113 //       2 = Force relief of Inventory - move to in-transit (non-compartment)
0114 //       3 = Force relief of Inventory - No cache records or GL records.
0115 //            (Inventory was relieved by Compartment based Load Confirm).
0116 //
0117 //
0118 //    Modes of Processing:
0119 //       0 = No Edits
0120 //       1 = Full Edits                           (default)
0121 //       2 = Partial Edits        (No Inventory OH or Availability Verification)
0122 //              Edits Processed Flag will be set to 0
0123 //       3 = Kit Component Edits
0124 //       4 = Transportation
0125 //
0126 //    If calling application has written a record to the cache, retrieve that
0127 //      record, otherwise retrieve the record from the F4211 table.
0128 //
0129 // ***********************************************************
0130 //
0131 // Get Header Cache if called by Transportation and doing Intransit.
0132 If BF cTRAN_InventoryAffectFlag is equal to "2"
0133    Load Or Unload Ship Confirm Hdr Cache
           "1" -> szCacheActionCode
           "2" -> mnNumberKeys
           "1" -> cSuppressErrorMessage
           BF mnJobnumberA -> mnJobnumberA
           VA evt_HDR_InventoryJobNumber <- mnInventoryJobnumberA
           VA evt_HDR_GLJobNumber <- mnGLJobnumberA
           VA evt_HDR_BatchNumber <- mnBatchNumber
           VA evt_HDR_BatchStatus <- cBatchStatus
           VA evt_HDR_LastJELine <- mnLastJELine
           BF szComputerID -> szComputerID
           VA evt_HDR_LastOverrideLineNumber <- mnLastOverrideLineNo
0134    VA evt_HDR_OverrideDocNumber = BF mnTRAN_OverrideInventoryDocNum
0135    VA evt_HDR_OverrideDocType = BF szTRAN_OverrideDocumentType
0136    VA evt_HDR_OverrideCompanyKey = BF szTRAN_DocumentCompany
0137    // Need to conditional the increment of Last Override Line #.
0138    // Use this logic instead:
0139    //      If record not previously written
0140    //           Increment Hdr cache line number
0141    //           Assign inventory line number = calculated Hdr line number
0142    //      End If
0143    If BF cRecordWritten is not equal to "1"
0144       VA evt_HDR_LastOverrideLineNumber = [VA evt_HDR_LastOverrideLineNumber]+1
0145       VA evt_InventoryLineNumber_LNID = VA evt_HDR_LastOverrideLineNumber
0146    End If
0147 End If
0148 // **********************************************************************
0149 //      If a request is made to update an existing cache record, delete record
0150 //      from Cache, get F4211 info again,  & re-add it to cache after edit check
0151 //      are complete.
0152 // **********************************************************************
0153 If BF cRecordWritten is equal to "1"
0154    // Retrieve prior cache values and Line Type Constants.
0155    If BF cModeProcessing is not equal to "5"
0156       //      READ SHIP CONFIRM CACHE
0157       // SAR 7451586 - retrieve TableQuantityOrdered from Cache
0158       Load Or Unload Ship Confirm Cache
              BF mnOrderNumber -> mnOrderNumber
              BF szOrderType -> szOrderType
              BF szOrderCompany -> szOrderCompany
              BF mnLineNumber -> mnLineNumber
              VA evt_CachedItemNumber <- mnItemNumber
              VA evt_CachedLineType <- szLineType
              VA evt_CachedQuantityOrdered <- mnQuantityOrdered
              VA evt_CachedQuantityShipped <- mnQuantityShipped
              VA evt_CachedQuantityBackordered <- mnQuantityBackordered
              VA evt_CachedQuantityCanceled <- mnQuantityCanceled
              VA evt_CachedBranchPlant <- szBranchPlant
              VA evt_CachedLocation <- szLocation
              VA evt_CachedLot <- szLot
              VA evt_CachedCommittedFlag <- cCommitmentFlag
              VA evt_CachedOtherQuantity12 <- cOtherQuantityFlag
              VA evt_CachedUpdateOnHandFlag <- cOnHandFlag
              VA evt_CachedLotProcessingCode <- cLotProcessingCode
              VA evt_CachedInventoryInterface <- cInventoryInterface
              VA evt_CachedEditsProcessed <- cEditsProcessedFlag
              <Blank> -> cSuppressErrorMessage
              BF mnLineNumber -> mnCacheLineNumber
              "I" -> cObsoleteCode
              VA evt_CachedConversionFactor <- mnConversionFactor
              "1" -> cCallType
              BF mnJobnumberA -> mnJobNumberA
              BF szComputerID -> szComputerID
              VA evt_InventoryLineNumber_LNID <- mnX4111Z1CacheLineNum
              VA evt_CachedActionCode <- cSODetailActionCode
              VA evt_CachedTransInventoryAffect <- cInventoryAffectFlag
              VA evt_CachedOtherCommitOverride <- cOHInventoryRelievedFlag
              VA evt_CachedOriginalLineNumber <- mnOriginalLineNumber
              VA evt_CachedSecondaryQuantity <- mnUnitsSecondaryQtyOr
              "6" -> mnNumberKeys
              "1" -> szCacheActionCode
              VA evt_CachedConvFactorTrantoDual <- mnConversionFactorTrantoSecnd
              VA evt_CachedConvFactScndrytoTran <- mnConvFactorSecondarytoTrans
              VA evt_CachedConvFctScndtoScnPrim <- mnConvFactorScndrytoScndPrime
              VA evt_TableQuantityOrdered <- mnOrderQtyTable_UORG
0159       If BF cActionCode is equal to "D"
0160          F40205 Get Line Type Constants
                 BF szEnteredLineType -> szLineType
                 UNDEFINED X szLineTypeDesc
                 UNDEFINED X szLineTypeDesc2
                 UNDEFINED X cGLInterface
                 VA evt_InventoryInterface <- cInventoryInterface
                 UNDEFINED X cARInterface
                 UNDEFINED X cAPInterface
                 UNDEFINED X cReverseSign
                 VA evt_TextLineYN <- cTextLine
                 UNDEFINED X cIncludeSalesCOGS
                 UNDEFINED X cIncludeCashDiscount
                 UNDEFINED X cIncludeTax1
                 UNDEFINED X cIncludeTax2
                 UNDEFINED X szGLOffset
                 UNDEFINED X cPrintDocument1
                 UNDEFINED X cPrintDocument2
                 UNDEFINED X cPrintDocument3
                 UNDEFINED X cRecordVariance
                 UNDEFINED X cIncludeTotalDocument1
                 UNDEFINED X cIncludeTotalDocument2
                 UNDEFINED X cIncludeTotalDocument3
                 UNDEFINED X cIncludeTotaldocument4
                 UNDEFINED X cIncludeColumnSalesJournal
                 UNDEFINED X szOrderType
                 UNDEFINED X cApplyRetainage
                 UNDEFINED X cApplyFreight
                 VA evt_GenerateWOFlag <- cGenerateWorkOrder
                 "1" -> cSuppressErrorMessage
                 VA evt_ErrorLineType <- cErrorCode
                 UNDEFINED X cCallMaterialsIssue
0161       End If
0162    End If
0163    //      DELETE SHIP CONFIRM CACHE
0164    Load Or Unload Ship Confirm Cache
           BF mnOrderNumber <> mnOrderNumber
           BF szOrderType <> szOrderType
           BF szOrderCompany <> szOrderCompany
           BF mnLineNumber <> mnLineNumber
           BF mnJobnumberA -> mnJobNumberA
           BF szComputerID -> szComputerID
           "6" -> mnNumberKeys
           "4" -> szCacheActionCode
0165    BF cRecordWritten = " "
0166 End If
0167 //
0168 //
0169 // REMOVE  X4111Z1 CACHE RECORD
0170 If BF mnXT4111LineNumber is greater than  <Blank>
0171    If BF cTRAN_InventoryAffectFlag is equal to "2"
0172       F4111 Delete Work File
              BF szComputerID -> szComputerID
              BF mnXT4111LineNumber -> mnFromLineNumber
              "1" -> cClearDetailFile
              VA evt_HDR_GLJobNumber X mnF0911JobNumber
              BF mnJobnumberA -> mnInvJobNumber
              BF mnOrderNumber -> mnOrderNumber
              BF szOrderType -> szOrderType
              BF szOrderCompany -> szOrderKeyCompany
              "000" -> szOrderSuffix
0173    Else
0174       F4111 Delete Work File
              BF szComputerID -> szComputerID
              BF mnLineNumber -> mnFromLineNumber
              "1" -> cClearDetailFile
              BF mnJobnumberA -> mnInvJobNumber
              BF mnOrderNumber -> mnOrderNumber
              BF szOrderType -> szOrderType
              BF szOrderCompany -> szOrderKeyCompany
              "000" -> szOrderSuffix
0175    End If
0176 End If
0177 //
0178 // **********************************************************
0179 //
0180 VA evt_GENLNG_CursorB4200810 = "0"
0181 // If this is not a Multi-Location Split Line - Child
0182 If BF cActionCode is not equal to "S"
0183    // Change to Acknowledge Direct Shipment Agreements.
0184    // Retrieve value of SO11.
0185    // SAR 7445361 - STOT Intransit Accounting, backing out inital performance
0186    // enhancement changes. It will be revisited with more appropriate solution.
0187    // SAR 7369599 - Retrieve Price Effective Date
0188    //
0189    // SAR 7459720    MD5644340    02/14/2005
0190    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0191    // Improve performance by fetching only the F4211 columns you need
0192    // The data structure for this function (D4200791B) contains all the F4211
0193    // fields.  However, when you add or remove a field you will have to update
0194    // the functions internal data structure in B4200791.  The internal data
0195    // structure only contains the fields needed by P4205.
0196    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0197 !    Fetch F4211 Table For Ship Confirm
     !       "1" X cSuppressErrorMessage
     !       VA evt_ErrorMessageReturned X szErrorMessage
     !       BF mnOrderNumber -> mnOrderNumber
     !       BF szOrderType -> szOrderType
     !       BF szOrderCompany -> szOrderCompany
     !       BF mnOriginal_LineNumber_3 -> mnLineNumber
     !       VA evt_OrderSuffix <- szOrderSuffix
     !       VA evt_OriginalBranchPlant <- szBranchPlant
     !       VA evt_Company_F4211 <- szCompany
     !       VA evt_P4312_OrderCompany <- szCompanyKeyRelated
     !       VA evt_P4312_RelatedPoNumber <- szRelatedPoSoNumber
     !       VA evt_P4312_OrderType <- szRelatedOrderType
     !       VA evt_P4312_POLineNumber <- mnRelatedPoSoLineNo
     !       VA evt_Sales_AgreementNum_DMCT <- szContractNumberDistributi
     !       VA evt_Sales_AgreementSuppy_DMCS <- mnContractSupplementDistri
     !       VA evt_SoldToTable <- mnAddressNumber
     !       VA evt_ShipTo_F4211 <- mnAddressNumberShipTo
     !       VA evt_ParentAddressNumbF4211_PAS <- mnAddressNumberParent
     !       VA evt_RequestedDate_F4211_DRQJ <- jdDateRequestedJulian
     !       VA evt_TransactionDateF4211 <- jdDateTransactionJulian
     !       VA evt_ShipDateF4211Table_ADDJ <- jdActualShipDate
     !       VA evt_jdCancelDate_CNDJ <- jdCancelDate
     !       VA evt_DateReleaseTable_RSDJ <- jdDateReleaseJulian
     !       VA evt_jdPriceEffectiveDate_PEFJ <- jdDatePriceEffectiveDate
     !       VA evt_DatePromisedPickF4211_PPDJ <- jdDatePromisedShipJu
     !       VA evt_ItemNumber <- mnIdentifierShortItem
     !       VA evt_szIdentifier2ndItem_LITM <- szIdentifier2ndItem
     !       VA evt_szIdentifier3rdItem_AITM <- szIdentifier3rdItem
     !       VA evt_OriginalLocation <- szLocation
     !       VA evt_OriginalLot <- szLot
     !       VA evt_LineType <- szLineType
     !       VA evt_NextStatus <- szStatusCodeNext
     !       VA evt_LastStatus <- szStatusCodeLast
     !       VA evt_RelatedItemNumber <- szItemNumberRelatedKit
     !       VA evt_LineNumberKitMaster <- mnLineNumberKitMaster
     !       VA evt_RelatedKitComponent <- mnRelatedKitComponent
     !       VA evt_PurchasingReportCode1_PRP1 <- szPurchasingReportCode1
     !       VA evt_CommitFlag <- cCommittedHS
     !       VA evt_OtherQuantityFlag <- cOtherQuantity12
     !       VA evt_UnitPrice <- mnAmtPricePerUnit2
     !       VA evt_ExtendedAmount <- mnAmountExtendedPrice
     !       VA evt_UnitCost <- mnAmountUnitCost
     !       VA evt_ExtendedCost <- mnAmountExtendedCost
     !       VA evt_CostOverrideFlag <- cCostOverrideCode
     !       VA evt_TransferUnitCost <- mnExtendedCostTransfer
     !       VA evt_szItemGroup_PRGR <- szPricingCategory
     !       VA evt_PickSlipNumberTable_PSN <- mnPickSlipNumber
     !       VA evt_SDAllowBackorders <- cBackordersAllowedYN
     !       VA evt_AllowPartialShipments <- cPartialShipmntsAllowY
     !       VA evt_CarrierID <- mnCarrier
     !       VA evt_ModeOfTransport_MOT <- szModeOfTransport
     !       VA evt_ContainerID <- szContainerID
     !       VA evt_FreightHandlingCodeF4211 <- szFreightHandlingCode
     !       VA evt_PrimaryUoM <- szUnitOfMeasurePrimary
     !       VA evt_PricingUoM <- szUnitOfMeasurePricing
     !       VA evt_ItemWeight <- mnAmountUnitWeight
     !       VA evt_WeightUoM <- szWeightUnitOfMeasure
     !       VA evt_ItemVolumeTable_ITVL <- mnAmountUnitVolume
     !       VA evt_VolumeUoM <- szVolumeUnitOfMeasure
     !       VA evt_GlCategory <- szGlClass
     !       VA evt_InterbranchOrderFlag <- cInterBranchSales
     !       VA evt_UpdateOnHandFlag <- cOnHandUpdated
     !       VA evt_InventoryCommitPref_SO06 <- cPreferenceCommitment
     !       VA evt_ShipDateOverridden_SO07 <- cShipDateOverride
     !       VA evt_PriceAdjustLineFlag_SO08 <- cPriceAdjustmentLine
     !       VA evt_ProductAllocationFlag_SO10 <- cProductAllocation
     !       VA evt_TransferDirectShipInterco <- cTransferDirectIntercomp
     !       VA evt_szReasonCode_RCD <- szReasonCode
     !       VA evt_StatusInWarehouse <- cStatusInWarehouse
     !       VA evt_CurrencyCode <- szCurrencyCodeFrom
     !       VA evt_CurrencyConversionRate <- mnCurrencyConverRateOv
     !       VA evt_ForeignUnitPrice <- mnAmtForPricePerUnit
     !       VA evt_ForeignExtendedAmount <- mnAmountForeignExtPrice
     !       VA evt_ForeignUnitCost <- mnAmountForeignUnitCost
     !       VA evt_ForeignExtendedCost <- mnAmountForeignExtCost
     !       VA evt_mnReqDeliverTimeTable_DRQT <- mnRequestedDeliveryTime
     !       VA evt_mnActualShipTimeTable_ADTM <- mnActualShipmentTime
     !       VA evt_mnPromisedPickTimeTbl_PDTT <- mnPromisedPickTime
     !       VA evt_Tran_ShipmentNumber <- mnShipmentNumber
     !       VA evt_mnPromisedDlvrTimeTbl_RSDT <- mnPromisedDeliveryTime
0198    Fetch F4211 Table For Ship Confirm
           "1" -> cSuppressErrorMessage
           VA evt_ErrorMessageReturned <- szErrorMessageReturned
           BF szOrderCompany -> szCompanyKeyOrderNo
           BF mnOrderNumber -> mnDocumentOrderInvoiceE
           BF szOrderType -> szOrderType
           BF mnLineNumber -> mnLineNumber
           VA evt_OrderSuffix <- szOrderSuffix
           VA evt_OriginalBranchPlant <- szCostCenter
           VA evt_Company_F4211 <- szCompany
           VA evt_P4312_OrderCompany <- szCompanyKeyRelated
           VA evt_P4312_RelatedPoNumber <- szRelatedPoSoNumber
           VA evt_P4312_OrderType <- szRelatedOrderType
           VA evt_P4312_POLineNumber <- mnRelatedPoSoLineNo
           VA evt_Sales_AgreementNum_DMCT <- szContractNumberDistributi
           VA evt_Sales_AgreementSuppy_DMCS <- mnContractSupplementDistri
           VA evt_SoldToTable <- mnAddressNumber
           VA evt_ShipTo_F4211 <- mnAddressNumberShipTo
           VA evt_ParentAddressNumbF4211_PAS <- mnAddressNumberParent
           VA evt_RequestedDate_F4211_DRQJ <- jdDateRequestedJulian
           VA evt_TransactionDateF4211 <- jdDateTransactionJulian
           VA evt_ScheduledPickDate4211_PDDJ <- jdScheduledPickDate
           VA evt_ShipDateF4211Table_ADDJ <- jdActualShipDate
           VA evt_jdCancelDate_CNDJ <- jdCancelDate
           VA evt_DateReleaseTable_RSDJ <- jdDateReleaseJulian
           VA evt_jdPriceEffectiveDate_PEFJ <- jdDatePriceEffectiveDate
           VA evt_DatePromisedPickF4211_PPDJ <- jdDatePromisedShipJu
           VA evt_ItemNumber <- mnIdentifierShortItem
           VA evt_szIdentifier2ndItem_LITM <- szIdentifier2ndItem
           VA evt_szIdentifier3rdItem_AITM <- szIdentifier3rdItem
           VA evt_OriginalLocation <- szLocation
           VA evt_OriginalLot <- szLot
           VA evt_LineType <- szLineType
           VA evt_NextStatus <- szStatusCodeNext
           VA evt_LastStatus <- szStatusCodeLast
           VA evt_RelatedItemNumber <- szItemNumberRelatedKit
           VA evt_LineNumberKitMaster <- mnLineNumberKitMaster
           VA evt_RelatedKitComponent <- mnRelatedKitComponent
           VA evt_PurchasingReportCode1_PRP1 <- szPurchasingReportCode1
           VA evt_OriginalOrderQuantity <- mnUnitsTransactionQty
           VA evt_OriginalShipQuantity <- mnUnitsQuantityShipped
           VA evt_OriginalBackorderQuantity <- mnUnitsQuanBackorHeld
           VA evt_OriginalCancelQuantity <- mnUnitsQuantityCanceled
           VA evt_CommitFlag <- cCommittedHS
           VA evt_OtherQuantityFlag <- cOtherQuantity12
           VA evt_UnitPrice <- mnAmtPricePerUnit2
           VA evt_ExtendedAmount <- mnAmountExtendedPrice
           VA evt_UnitCost <- mnAmountUnitCost
           VA evt_ExtendedCost <- mnAmountExtendedCost
           VA evt_CostOverrideFlag <- cCostOverrideCode
           VA evt_TransferUnitCost <- mnExtendedCostTransfer
           VA evt_szItemGroup_PRGR <- szPricingCategory
           VA evt_PickSlipNumberTable_PSN <- mnPickSlipNumber
           VA evt_SDAllowBackorders <- cBackordersAllowedYN
           VA evt_AllowPartialShipments <- cPartialShipmntsAllowY
           VA evt_CarrierID <- mnCarrier
           VA evt_ModeOfTransport_MOT <- szModeOfTransport
           VA evt_ContainerID <- szContainerID
           VA evt_FreightHandlingCodeF4211 <- szFreightHandlingCode
           VA evt_PrimaryUoM <- szUnitOfMeasurePrimary
           VA evt_PrimaryQtyOrderTable_PQOR <- mnUnitsPrimaryQtyOrder
           VA evt_OriginalSecondaryQuantity <- mnUnitsSecondaryQtyOr
           VA evt_PricingUoM <- szUnitOfMeasurePricing
           VA evt_ItemWeight <- mnAmountUnitWeight
           VA evt_WeightUoM <- szWeightUnitOfMeasure
           VA evt_ItemVolumeTable_ITVL <- mnAmountUnitVolume
           VA evt_VolumeUoM <- szVolumeUnitOfMeasure
           VA evt_GlCategory <- szGlClass
           VA evt_InterbranchOrderFlag <- cInterBranchSales
           VA evt_UpdateOnHandFlag <- cOnHandUpdated
           VA evt_InventoryCommitPref_SO06 <- cPreferenceCommitment
           VA evt_ShipDateOverridden_SO07 <- cShipdateOverridden
           VA evt_PriceAdjustLineFlag_SO08 <- cPriceAdjustmentLine
           VA evt_ProductAllocationFlag_SO10 <- cPreferenceProductAlloc
           VA evt_TransferDirectShipInterco <- cTransferDirectShipInter
           VA evt_szReasonCode_RCD <- szReasonCode
           VA evt_StatusInWarehouse <- cStatusInWarehouse
           VA evt_CurrencyCode <- szCurrencyCodeFrom
           VA evt_CurrencyConversionRate <- mnCurrencyConverRateOv
           VA evt_ForeignUnitPrice <- mnAmtForPricePerUnit
           VA evt_ForeignExtendedAmount <- mnAmountForeignExtPrice
           VA evt_ForeignUnitCost <- mnAmountForeignUnitCost
           VA evt_ForeignExtendedCost <- mnAmountForeignExtCost
           VA evt_mnReqDeliverTimeTable_DRQT <- mnRequestedDeliveryTime
           VA evt_mnActualShipTimeTable_ADTM <- mnActualShipmentTime
           VA evt_mnPromisedPickTimeTbl_PDTT <- mnPromisedPickTime
           VA evt_Tran_ShipmentNumber <- mnShipmentNumber
           VA evt_mnPromisedDlvrTimeTbl_RSDT <- mnPromisedDeliveryTime
0199    //
0200    // End SAR 7369599
0201    // End SAR 7445361
0202    //
0203    //      Save Commit Flag and original quantities from table
0204    VA evt_OriginalCommittedHS = VA evt_CommitFlag
0205    VA evt_TableQuantityOrdered = VA evt_OriginalOrderQuantity
0206    VA evt_TableQuantityShipped = VA evt_OriginalShipQuantity
0207    VA evt_TableSecondaryQuantity = VA evt_OriginalSecondaryQuantity
0208    // Original Secondary Qty to be assigned later based on flag value
0209    VA evt_AssignConvertedOrderQty = "2"
0210    //
0211    //  If this is a MultiLocation Split Parent Line - Update Original Order Quantit
0212    If BF cActionCode is equal to "P"
0213       VA evt_OrigShipQyB4MultSplit4Par = VA evt_OriginalShipQuantity
0214       VA evt_OriginalOrderQuantity = BF mnMultiLocParentOrderQuantity
0215       // DUAL UoM - set original order qty secondary = to order qty and
0216       // assign values of  secondary ship quantities
0217       VA evt_OriginalOrderQtySecondary = [BF mnMultiLocSecondaryOrderQty]
0218       VA evt_OriginalShipQuantity = BF mnEnteredShipQuantity
0219       VA evt_OriginalSecondaryQuantity = BF mnUnitsSecondaryQtyOr
0220       //
0221       // Assign proper value of AssignConverted OrderQty flag for
0222       // processing of Multi Location Parent Line. Value should equal '0' or blank.
0223       // When Multi-Location, do not use Table Sec Qty
0224       VA evt_AssignConvertedOrderQty = "0"
0225       //
0226    End If
0227 Else
0228    //  This is a Multi-Location Split Line - Child
0229    //
0230    // Change to Acknowledge Direct Shipment Agreements.
0231    // Retrieve value of SO11.
0232    // SAR 7369599 - Retrieve Price Effective Date
0233    // SAR 7379615 - Location Error in Ship Confirm - Changed line number variable
0234    // to BF mnOriginal_Linenumber_3
0235    // SAR 7445361 - STOT Intransit Accounting, backing out inital performance
0236    // enhancement changes. It will be revisited with more appropriate solution.
0237    // SAR 7398171 - Retrieve Price Effective Date
0238    //
0239    // SAR 7459720    MD5644340    02/14/2005
0240    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0241    // Improve performance by fetching only the F4211 columns you need
0242    // The data structure for this function (D4200791B) contains all the F4211
0243    // fields.  However, when you add or remove a field you will have to update
0244    // the functions internal data structure in B4200791.  The internal data
0245    // structure only contains the fields needed by P4205.
0246    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0247 !    Fetch F4211 Table For Ship Confirm
     !       "1" X cSuppressErrorMessage
     !       VA evt_ErrorMessageReturned X szErrorMessage
     !       BF mnOrderNumber -> mnOrderNumber
     !       BF szOrderType -> szOrderType
     !       BF szOrderCompany -> szOrderCompany
     !       BF mnOriginal_LineNumber_3 -> mnLineNumber
     !       VA evt_OrderSuffix <- szOrderSuffix
     !       VA evt_OriginalBranchPlant <- szBranchPlant
     !       VA evt_Company_F4211 <- szCompany
     !       VA evt_P4312_OrderCompany <- szCompanyKeyRelated
     !       VA evt_P4312_RelatedPoNumber <- szRelatedPoSoNumber
     !       VA evt_P4312_OrderType <- szRelatedOrderType
     !       VA evt_P4312_POLineNumber <- mnRelatedPoSoLineNo
     !       VA evt_Sales_AgreementNum_DMCT <- szContractNumberDistributi
     !       VA evt_Sales_AgreementSuppy_DMCS <- mnContractSupplementDistri
     !       VA evt_SoldToTable <- mnAddressNumber
     !       VA evt_ShipTo_F4211 <- mnAddressNumberShipTo
     !       VA evt_ParentAddressNumbF4211_PAS <- mnAddressNumberParent
     !       VA evt_RequestedDate_F4211_DRQJ <- jdDateRequestedJulian
     !       VA evt_TransactionDateF4211 <- jdDateTransactionJulian
     !       VA evt_ShipDateF4211Table_ADDJ <- jdActualShipDate
     !       VA evt_jdCancelDate_CNDJ <- jdCancelDate
     !       VA evt_DateReleaseTable_RSDJ <- jdDateReleaseJulian
     !       VA evt_jdPriceEffectiveDate_PEFJ <- jdDatePriceEffectiveDate
     !       VA evt_DatePromisedPickF4211_PPDJ <- jdDatePromisedShipJu
     !       VA evt_ItemNumber <- mnIdentifierShortItem
     !       VA evt_szIdentifier2ndItem_LITM <- szIdentifier2ndItem
     !       VA evt_szIdentifier3rdItem_AITM <- szIdentifier3rdItem
     !       VA evt_OriginalLocation <- szLocation
     !       VA evt_OriginalLot <- szLot
     !       VA evt_LineType <- szLineType
     !       VA evt_NextStatus <- szStatusCodeNext
     !       VA evt_LastStatus <- szStatusCodeLast
     !       VA evt_RelatedItemNumber <- szItemNumberRelatedKit
     !       VA evt_LineNumberKitMaster <- mnLineNumberKitMaster
     !       VA evt_RelatedKitComponent <- mnRelatedKitComponent
     !       VA evt_PurchasingReportCode1_PRP1 <- szPurchasingReportCode1
     !       VA evt_CommitFlag <- cCommittedHS
     !       VA evt_OtherQuantityFlag <- cOtherQuantity12
     !       VA evt_UnitPrice <- mnAmtPricePerUnit2
     !       VA evt_ExtendedAmount <- mnAmountExtendedPrice
     !       VA evt_UnitCost <- mnAmountUnitCost
     !       VA evt_ExtendedCost <- mnAmountExtendedCost
     !       VA evt_CostOverrideFlag <- cCostOverrideCode
     !       VA evt_TransferUnitCost <- mnExtendedCostTransfer
     !       VA evt_szItemGroup_PRGR <- szPricingCategory
     !       VA evt_PickSlipNumberTable_PSN <- mnPickSlipNumber
     !       VA evt_SDAllowBackorders <- cBackordersAllowedYN
     !       VA evt_AllowPartialShipments <- cPartialShipmntsAllowY
     !       VA evt_CarrierID <- mnCarrier
     !       VA evt_ModeOfTransport_MOT <- szModeOfTransport
     !       VA evt_ContainerID <- szContainerID
     !       VA evt_FreightHandlingCodeF4211 <- szFreightHandlingCode
     !       VA evt_PrimaryUoM <- szUnitOfMeasurePrimary
     !       VA evt_PricingUoM <- szUnitOfMeasurePricing
     !       VA evt_ItemWeight <- mnAmountUnitWeight
     !       VA evt_WeightUoM <- szWeightUnitOfMeasure
     !       VA evt_ItemVolumeTable_ITVL <- mnAmountUnitVolume
     !       VA evt_VolumeUoM <- szVolumeUnitOfMeasure
     !       VA evt_GlCategory <- szGlClass
     !       VA evt_InterbranchOrderFlag <- cInterBranchSales
     !       VA evt_UpdateOnHandFlag <- cOnHandUpdated
     !       VA evt_InventoryCommitPref_SO06 <- cPreferenceCommitment
     !       VA evt_ShipDateOverridden_SO07 <- cShipDateOverride
     !       VA evt_PriceAdjustLineFlag_SO08 <- cPriceAdjustmentLine
     !       VA evt_ProductAllocationFlag_SO10 <- cProductAllocation
     !       VA evt_TransferDirectShipInterco <- cTransferDirectIntercomp
     !       VA evt_szReasonCode_RCD <- szReasonCode
     !       VA evt_StatusInWarehouse <- cStatusInWarehouse
     !       VA evt_CurrencyCode <- szCurrencyCodeFrom
     !       VA evt_CurrencyConversionRate <- mnCurrencyConverRateOv
     !       VA evt_ForeignUnitPrice <- mnAmtForPricePerUnit
     !       VA evt_ForeignExtendedAmount <- mnAmountForeignExtPrice
     !       VA evt_ForeignUnitCost <- mnAmountForeignUnitCost
     !       VA evt_ForeignExtendedCost <- mnAmountForeignExtCost
     !       VA evt_mnReqDeliverTimeTable_DRQT <- mnRequestedDeliveryTime
     !       VA evt_mnActualShipTimeTable_ADTM <- mnActualShipmentTime
     !       VA evt_mnPromisedPickTimeTbl_PDTT <- mnPromisedPickTime
     !       VA evt_Tran_ShipmentNumber <- mnShipmentNumber
     !       VA evt_mnPromisedDlvrTimeTbl_RSDT <- mnPromisedDeliveryTime
0248    Fetch F4211 Table For Ship Confirm
           "1" -> cSuppressErrorMessage
           VA evt_ErrorMessageReturned <- szErrorMessageReturned
           BF szOrderCompany -> szCompanyKeyOrderNo
           BF mnOrderNumber -> mnDocumentOrderInvoiceE
           BF szOrderType -> szOrderType
           BF mnOriginal_LineNumber_3 -> mnLineNumber
           VA evt_OrderSuffix <- szOrderSuffix
           VA evt_OriginalBranchPlant <- szCostCenter
           VA evt_Company_F4211 <- szCompany
           VA evt_P4312_OrderCompany <- szCompanyKeyRelated
           VA evt_P4312_RelatedPoNumber <- szRelatedPoSoNumber
           VA evt_P4312_OrderType <- szRelatedOrderType
           VA evt_P4312_POLineNumber <- mnRelatedPoSoLineNo
           VA evt_Sales_AgreementNum_DMCT <- szContractNumberDistributi
           VA evt_Sales_AgreementSuppy_DMCS <- mnContractSupplementDistri
           VA evt_SoldToTable <- mnAddressNumber
           VA evt_ShipTo_F4211 <- mnAddressNumberShipTo
           VA evt_ParentAddressNumbF4211_PAS <- mnAddressNumberParent
           VA evt_RequestedDate_F4211_DRQJ <- jdDateRequestedJulian
           VA evt_TransactionDateF4211 <- jdDateTransactionJulian
           VA evt_ShipDateF4211Table_ADDJ <- jdActualShipDate
           VA evt_jdCancelDate_CNDJ <- jdCancelDate
           VA evt_DateReleaseTable_RSDJ <- jdDateReleaseJulian
           VA evt_jdPriceEffectiveDate_PEFJ <- jdDatePriceEffectiveDate
           VA evt_DatePromisedPickF4211_PPDJ <- jdDatePromisedShipJu
           VA evt_ItemNumber <- mnIdentifierShortItem
           VA evt_szIdentifier2ndItem_LITM <- szIdentifier2ndItem
           VA evt_szIdentifier3rdItem_AITM <- szIdentifier3rdItem
           VA evt_OriginalLocation <- szLocation
           VA evt_OriginalLot <- szLot
           VA evt_LineType <- szLineType
           VA evt_NextStatus <- szStatusCodeNext
           VA evt_LastStatus <- szStatusCodeLast
           VA evt_RelatedItemNumber <- szItemNumberRelatedKit
           VA evt_LineNumberKitMaster <- mnLineNumberKitMaster
           VA evt_RelatedKitComponent <- mnRelatedKitComponent
           VA evt_PurchasingReportCode1_PRP1 <- szPurchasingReportCode1
           VA evt_CommitFlag <- cCommittedHS
           VA evt_OtherQuantityFlag <- cOtherQuantity12
           VA evt_UnitPrice <- mnAmtPricePerUnit2
           VA evt_ExtendedAmount <- mnAmountExtendedPrice
           VA evt_UnitCost <- mnAmountUnitCost
           VA evt_ExtendedCost <- mnAmountExtendedCost
           VA evt_CostOverrideFlag <- cCostOverrideCode
           VA evt_TransferUnitCost <- mnExtendedCostTransfer
           VA evt_szItemGroup_PRGR <- szPricingCategory
           VA evt_PickSlipNumberTable_PSN <- mnPickSlipNumber
           VA evt_SDAllowBackorders <- cBackordersAllowedYN
           VA evt_AllowPartialShipments <- cPartialShipmntsAllowY
           VA evt_CarrierID <- mnCarrier
           VA evt_ModeOfTransport_MOT <- szModeOfTransport
           VA evt_ContainerID <- szContainerID
           VA evt_FreightHandlingCodeF4211 <- szFreightHandlingCode
           VA evt_PrimaryUoM <- szUnitOfMeasurePrimary
           VA evt_PricingUoM <- szUnitOfMeasurePricing
           VA evt_ItemWeight <- mnAmountUnitWeight
           VA evt_WeightUoM <- szWeightUnitOfMeasure
           VA evt_ItemVolumeTable_ITVL <- mnAmountUnitVolume
           VA evt_VolumeUoM <- szVolumeUnitOfMeasure
           VA evt_GlCategory <- szGlClass
           VA evt_InterbranchOrderFlag <- cInterBranchSales
           VA evt_UpdateOnHandFlag <- cOnHandUpdated
           VA evt_InventoryCommitPref_SO06 <- cPreferenceCommitment
           VA evt_ShipDateOverridden_SO07 <- cShipdateOverridden
           VA evt_PriceAdjustLineFlag_SO08 <- cPriceAdjustmentLine
           VA evt_ProductAllocationFlag_SO10 <- cPreferenceProductAlloc
           VA evt_TransferDirectShipInterco <- cTransferDirectShipInter
           VA evt_szReasonCode_RCD <- szReasonCode
           VA evt_StatusInWarehouse <- cStatusInWarehouse
           VA evt_CurrencyCode <- szCurrencyCodeFrom
           VA evt_CurrencyConversionRate <- mnCurrencyConverRateOv
           VA evt_ForeignUnitPrice <- mnAmtForPricePerUnit
           VA evt_ForeignExtendedAmount <- mnAmountForeignExtPrice
           VA evt_ForeignUnitCost <- mnAmountForeignUnitCost
           VA evt_ForeignExtendedCost <- mnAmountForeignExtCost
           VA evt_mnReqDeliverTimeTable_DRQT <- mnRequestedDeliveryTime
           VA evt_mnActualShipTimeTable_ADTM <- mnActualShipmentTime
           VA evt_mnPromisedPickTimeTbl_PDTT <- mnPromisedPickTime
           VA evt_Tran_ShipmentNumber <- mnShipmentNumber
           VA evt_mnPromisedDlvrTimeTbl_RSDT <- mnPromisedDeliveryTime
0249    //
0250    // End SAR 7369599
0251    // End SAR 7445361
0252    //
0253    //      Save Commit Flag and original quantities from table
0254    VA evt_OriginalCommittedHS = VA evt_CommitFlag
0255    VA evt_TableQuantityOrdered = VA evt_OriginalOrderQuantity
0256    VA evt_TableQuantityShipped = VA evt_OriginalShipQuantity
0257    VA evt_TableSecondaryQuantity = VA evt_OriginalSecondaryQuantity
0258    VA evt_OriginalShipQuantity = BF mnEnteredShipQuantity
0259    VA evt_OriginalOrderQuantity = BF mnEnteredShipQuantity
0260    //
0261    // DUAL UoM - set original order qty secondary = to order qty and
0262    // assign value of original secondary ship quantity
0263    //
0264    VA evt_AssignConvertedOrderQty = "1"
0265    VA evt_OriginalSecondaryQuantity = BF mnUnitsSecondaryQtyOr
0266    VA evt_OriginalBackorderQuantity = 0
0267    VA evt_OriginalCancelQuantity = 0
0268 End If
0269 // =============================================
0270 // Assign F4211 values to be written to cache for End Doc
0271 // =============================================
0272 VA evt_OnHandFlagF4211_SO02 = VA evt_UpdateOnHandFlag
0273 VA evt_UnitCostTable_UNCS = VA evt_UnitCost
0274 VA evt_CostExtendedTable_ECST = VA evt_ExtendedCost
0275 VA evt_ForeignUnitCostTable_FUC = VA evt_ForeignUnitCost
0276 VA evt_ForeignExtCostTable_FEC = VA evt_ForeignExtendedCost
0277 VA evt_ExtendedPriceTable_AEXP = VA evt_ExtendedAmount
0278 VA evt_ForeignExtPriceTable_FEA = VA evt_ForeignExtendedAmount
0279 VA evt_BackorderQtyTable_SOBK = VA evt_OriginalBackorderQuantity
0280 VA evt_CancelQtyTable_SOCN = VA evt_OriginalCancelQuantity
0281 // =============================================
0282 // End Assign F4211 values to be written to cache for End Doc
0283 // =============================================
0284 //
0285 // ===========================================================
0286 // If BranchPlant is different from Original Branch Plant, get Company.
0287 // ===========================================================
0288 //
0289 If BF szBranchPlant is not equal to VA evt_OriginalBranchPlant
0290    F0006 Get Company from Business Unit
           BF szBranchPlant -> szCostCenter
           VA evt_szCompany_Cache_CO <- szCompany
0291 Else
0292    VA evt_szCompany_Cache_CO = VA evt_Company_F4211
0293 End If
0294 // ===========================================================
0295 // Demand Scheduling - Validate Carton Status
0296 // ===========================================================
0297 If VA evt_cDemandSchedReleased_DSRFU is equal to "1"
0298    If VA evt_Tran_ShipmentNumber is greater than <Zero>
0299       If VA evt_cCalledByTMS_EV01 is equal to "1"
0300          If VA evt_szCnfrmtnCartonStatus_CRSS is not equal to <Null> And VA evt_szCnfrmtnCartonStatus_CRSS is not equal to <Blank>
0301             //
0302             // If Demand Scheduling has been released, if the Shipment Number is
0303             // populated, if Ship Confirm has been called independent of the
0304             // Transportation Confirmation applications (P49645 or P49640) and the
0305             // Confirmation Carton Status is populated check to see if this Shipment
0306             // Number has already been validated successfully.
0307             //
0308             Transportation Carton Status Cache
                    "1" -> szCacheActionCode
                    "2" -> mnNumberKeys
                    "1" -> cSuppressErrorMessage
                    VA evt_szCartonCacheErrMsgID_DTAI <- szErrorMessageID
                    UNDEFINED X idCacheCursor
                    BF mnJobnumberA -> mnTransportationJobNumber
                    VA evt_Tran_ShipmentNumber -> mnShipmentNumber
                    VA evt_cCartonStatusPassFail_QPF <- cPassFailPF
0309             //
0310             // If this Shipment Number has not already been validated successfully.
0311             // Validate the Carton Status.
0312             //
0313             If VA evt_cCartonStatusPassFail_QPF is not equal to "P"
0314                Validate Carton Status
                       VA evt_szCnfrmtnCartonStatus_CRSS -> szConfirmationCartonStatus
                       VA evt_Tran_ShipmentNumber -> mnShipmentNumber
                       "1" -> cSuppressErrorMessage
                       VA evt_szCartonStatusErrMsg_DTAI <- szErrorMessageID
                       VA evt_cCalledByTMS_EV01 -> cCalledByTransportation
                       BF szProgramID -> szProgramId
0315                //
0316                // If the Carton Status Validation fails, set the EditsProcessedFlag to 0 to
0317                // let Edit Line know it failed, set the CartonStatusPassFail flag to F to
0318                // record the failure in the Carton Status Cache, and set Error messages based
0319                // on being called in batch or interactive confirmation.
0320                //
0321                If VA evt_szCartonStatusErrMsg_DTAI is not equal to <Blank> And VA evt_szCartonStatusErrMsg_DTAI is not equal to <Null>
0322                   VA evt_EditsProcessedFlag = "0"
0323                   VA evt_cCartonStatusPassFail_QPF = "F"
0324                   //
0325                   If BF szProgramID is not equal to "R47500"
0326                      Invalid Carton Status - Shipment Confirmation - General
                             VA evt_szCnfrmtnCartonStatus_CRSS -> szCartonStatusCode
                             VA evt_Tran_ShipmentNumber -> mnShipmentNumber
0327                   End If
0328                Else
0329                   // If the Carton Status Validation passes, set the CartonStatusPassFail flag
0330                   // to P to record the success in the Carton Status Cache.
0331                   VA evt_cCartonStatusPassFail_QPF = "P"
0332                End If
0333                // Write the Carton Status Cache for the Shipment Number.
0334                If VA evt_cCartonStatusPassFail_QPF is not equal to "F"
0335                   Transportation Carton Status Cache
                          "7" -> szCacheActionCode
                          "2" -> mnNumberKeys
                          "1" -> cSuppressErrorMessage
                          UNDEFINED X szErrorMessageID
                          UNDEFINED X idCacheCursor
                          BF mnJobnumberA -> mnTransportationJobNumber
                          VA evt_Tran_ShipmentNumber -> mnShipmentNumber
                          VA evt_cCartonStatusPassFail_QPF -> cPassFailPF
0336                End If
0337             End If
0338          End If
0339       End If
0340    End If
0341 End If
0342 // ===========================================================
0343 // End Demand Scheduling - Validate Carton Status
0344 // ===========================================================
0345 //
0346 // ============================
0347 //   VALIDATE  -   SHIP TO ADDRESS
0348 // ============================
0349 //
0350 // Transportation EP49640 - Set Entered LineType&ShipToAddr  to F4211 values
0351 If BF szProgramID is equal to "EP49640"
0352    BF szEnteredLineType = VA evt_LineType
0353    BF mnAddressNumberShipTo = VA evt_ShipTo_F4211
0354 Else
0355    If BF mnAddressNumberShipTo is equal to <Zero>
        Or BF mnAddressNumberShipTo is equal to <Null>
0356       BF mnAddressNumberShipTo = VA evt_ShipTo_F4211
0357    End If
0358 End If
0359 //
0360 //   Check To See If Address Number Invalid
0361 If BF mnAddressNumberShipTo is not equal to VA evt_ShipTo_F4211
0362    F0101 Get Address Information for OP
           BF mnAddressNumberShipTo -> mnAddressNumber
           UNDEFINED X szAlphaName
           UNDEFINED X jdAddressEffectiveDate
           UNDEFINED X szTaxCertificate
           UNDEFINED X szCreditMessage
           UNDEFINED X mnRelatedAddress1
           UNDEFINED X mnRelatedAddress2
           UNDEFINED X mnRelatedAddress3
           UNDEFINED X mnRelatedAddress4
           UNDEFINED X mnRelatedAddress5
           UNDEFINED X mnRelatedAddress6
           UNDEFINED X szBranchPlant
           UNDEFINED X szLanguagePreference
           VA evt_ErrorMessage <- szErrorMessage
           "1" -> cSuppressError
           UNDEFINED X szTaxID
           UNDEFINED X cPersonCorporationCode
0363    If VA evt_ErrorMessage is greater than <Blank>
0364       Set NER Error("0037", BF mnAddressNumberShipTo)
0365       VA evt_EditsProcessedFlag = "0"
0366    End If
0367 End If
0368 //
0369 // =============================
0370 //  VALIDATE  -  ENTERED  LINE TYPE
0371 // =============================
0372 //
0373 // SAR 7459720    MD5644340    02/14/2005
0374 // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0375 // Improve performance by using cache to retrieve Line Type Constants
0376 // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0377 Ship Confirm Cache For Line Type
        "1" -> szCacheActionCode
        "3" -> mnNumberKeys
        BF mnJobnumberA -> mnJobnumberA
        BF szComputerID -> szComputerID
        BF szEnteredLineType -> szLineType
        VA evt_InventoryInterface <- cInvInterfaceFlag
        VA evt_TextLineYN <- cTextLineYN
        VA evt_GenerateWOFlag <- cGenerateWorkOrder
        "1" -> cSuppressErrorMessage
        VA evt_ErrorLineType <- cErrorCode
        VA evt_ErrorMessageReturned <- szErrorMessage
0378 //
0379 If VA evt_ErrorMessageReturned is not equal to <Blank> And VA evt_ErrorMessageReturned is not equal to <Null>
0380    F40205 Get Line Type Constants
           BF szEnteredLineType -> szLineType
           VA evt_InventoryInterface <- cInventoryInterface
           VA evt_TextLineYN <- cTextLine
           VA evt_GenerateWOFlag <- cGenerateWorkOrder
           "1" -> cSuppressErrorMessage
           VA evt_ErrorLineType <- cErrorCode
0381    Ship Confirm Cache For Line Type
           "7" -> szCacheActionCode
           "3" -> mnNumberKeys
           BF mnJobnumberA -> mnJobnumberA
           BF szComputerID -> szComputerID
           BF szEnteredLineType -> szLineType
           VA evt_InventoryInterface -> cInvInterfaceFlag
           VA evt_TextLineYN -> cTextLineYN
           VA evt_GenerateWOFlag -> cGenerateWorkOrder
           "1" -> cSuppressErrorMessage
           VA evt_ErrorLineType <- cErrorCode
           VA evt_ErrorMessageReturned <- szErrorMessage
0382 End If
0383 //
0384 If VA evt_ErrorLineType is equal to "1"
0385    // Set NER error 4150 (Invalid Line Type)
0386    Set NER Error("4150", BF szEnteredLineType)
0387    VA evt_EditsProcessedFlag = "0"
0388 End If
0389 //
0390 // Modifiy F4101 Get Item Master to be called for all records and
0391 // to return Dual UOM fields. add assignment of EnteredShipQuantity to use for
0392 // edits.
0393 //
0394 VA evt_ErrorMessage = ""
0395 F4101 Get Item Master Information
        VA evt_mnTempShortItem_ITM <- mnShortItemNumber
        VA evt_szItemNumberPrimary_UITM <- szPrimaryItemNumber
        VA evt_szIdentifier2ndItem_LITM -> szSecondItemNumber
        VA evt_szIdentifier3rdItem_AITM -> szThirdItemNumber
        VA evt_SecondaryPrimaryUoM <- szSecondaryUOM
        "1" -> cSuppressErrorMessage
        VA evt_ErrorMessage <- szErrorMessageID
        BF szBranchPlant -> szBranchPlant
        VA evt_IMBackFlag <- cBackOrdersAllowedYN
        VA evt_StockingType_F4101 <- cStockingType
        VA evt_F4101_BulkPackFlag <- cBulkPackedFlag
        VA evt_CostLevel <- cInventoryCostLevel
        VA evt_ItemMasterPriceLevel_PLEV <- cPriceLevel
        VA evt_StandardUOMConversion_TFLA <- szStandardUOMConversion
        VA evt_DualUnitOfMeasureItem <- cDualUnitOfMeasureItem
        VA evt_DualPickingProcessOption <- cDualPickingProcessOption
        VA evt_DualTolerance <- mnDualTolerance
0396 //
0397 //     If item doesn't exist in Item Master, Item Master & Item B/P B/O Flags =
0398 //     B/O or Cancel based on B/P Constants & Cust. Billing Instructions.
0399 //
0400 If VA evt_ErrorMessage is greater than <Blank>
0401    VA evt_ItemMasterExists = "N"
0402    VA evt_IMBackFlag = "Y"
0403    VA evt_IBBackFlag = "Y"
0404 Else
0405    VA evt_ItemMasterExists = "Y"
0406    If VA evt_LineType is equal to "N"
        And BF szEnteredLineType is not equal to "BN,N"
0407       If VA evt_StockingType_F4101 is equal to "S"
0408          VA evt_ItemNumber = VA evt_mnTempShortItem_ITM
0409       End If
0410    End If
0411    V4102AA.Fetch Single
           VA evt_ItemNumber =  TK Item Number - Short
           VA evt_OriginalBranchPlant =  TK Business Unit
           VA evt_CatagorySalesCode1 <- TK Sales Catalog Section
           VA evt_CheckAvailabilityFlag <- TK Check Availability Y/N
           VA evt_LotProcessingCode <- TK Layer Code - Source
           VA evt_PotencyControl <- TK Potency Control
           VA evt_StandardPotency <- TK Standard Potency
           VA evt_IBBackFlag <- TK Backorders Allowed (Y/N)
           VA evt_StockingType_F4102 <- TK Stocking Type
           VA evt_SerialNumberRequired <- TK Serial Number Required
           VA evt_MPSP_PlanFenceRule <- TK Planning Time Fence Rule
0412 End If
0413 VA evt_ErrorMessage = ""
0414 //
0415 // Change edit to list values of "1,2"
0416 If VA evt_DualUnitOfMeasureItem is equal to "1,2" And VA evt_DualPickingProcessOption is equal to "1"
0417    VA evt_EditingShippedQuantity = BF mnUnitsSecondaryQtyOr
0418    VA evt_EditingOriginalShippedQty = VA evt_OriginalSecondaryQuantity
0419    VA evt_EditingTableShipQuantity = VA evt_TableSecondaryQuantity
0420    VA evt_EditingCachedShippedQty = VA evt_CachedSecondaryQuantity
0421    VA evt_EditforDualUOM = "1"
0422 Else
0423    VA evt_EditingShippedQuantity = BF mnEnteredShipQuantity
0424    VA evt_EditingOriginalShippedQty = VA evt_OriginalShipQuantity
0425    VA evt_EditingTableShipQuantity = VA evt_TableQuantityShipped
0426    VA evt_EditingCachedShippedQty = VA evt_CachedQuantityShipped
0427    VA evt_EditforDualUOM = " "
0428 End If
0429 //
0430 //
0431 // Save Qty and Branch, if changed, update Agreements
0432 VA evt_SaveBranchPlant = BF szBranchPlant
0433 VA evt_SaveQuantity = VA evt_OriginalShipQuantity
0434 //
0435 // Bypass Record if ON HAND has already been committed.
0436 If VA evt_UpdateOnHandFlag is not equal to "1"
0437    //
0438    // ===============================================
0439    //      If called by INTERACTIVE Session (P4205) and line was de-selected
0440    //      for Ship Confirm Processing, bypass edits and update Cache record
0441    //      so it will not be processed by EndDoc.
0442    // ===============================================
0443    If BF cActionCode is equal to "D"
0444       VA evt_EditsProcessedFlag = "0"
0445    Else
0446       // =======================================
0447       //    Validate Reversal processing edits
0448       // =======================================
0449       // Replace existing variables with Dual UOM editing variables
0450       If VA evt_EditingShippedQuantity is less than <Zero>
           And VA evt_EditingTableShipQuantity is greater than <Zero>
0451          //
0452          // Multi Location
0453          //
0454          If BF cActionCode is not equal to "S"
0455             If BF cActionCode is not equal to "P"
0456                VA evt_CommitmentSignReversal = "1"
0457             Else
0458                // Replace existing variables with Dual UOM editing variables
0459                If VA evt_EditforDualUOM is equal to "1"
0460                   Set NER Error("155V", BF szUnitOfMeasureSecondary)
0461                Else
0462                   Set NER Error("155V", BF mnEnteredShipQuantity)
0463                End If
0464                VA evt_EditsProcessedFlag = "0"
0465             End If
0466          End If
0467       End If
0468       //
0469       // =============================
0470       //     Validate Carrier Number
0471       // =============================
0472       //
0473       If BF mnTRAN_ShipmentNumber is less than or equal to <Zero>
0474          //
0475          // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0476          // Try and retrieve Carrier Number from cache first
0477          // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0478          If BF mnCarrier is not equal to <Zero>
0479             Ship Confirm Cache For Address Book
                    "1" -> szCacheActionCode
                    "3" -> mnNumberKeys
                    BF mnJobnumberA -> mnJobnumberA
                    BF szComputerID -> szComputerID
                    BF mnCarrier -> mnAddressNumber
                    "1" -> cSuppressErrorMessage
                    VA evt_ErrorMessageReturned <- szErrorMessage
0480             //
0481             // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0482             // If fetch from cache was unsuccessful, fetch from the table and update cache
0483             // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
0484             If VA evt_ErrorMessageReturned is not equal to <Blank> And VA evt_ErrorMessageReturned is not equal to <Null>
0485                F0101 Get Address Information for OP
                       BF mnCarrier -> mnAddressNumber
                       UNDEFINED X szAlphaName
                       UNDEFINED X jdAddressEffectiveDate
                       UNDEFINED X szTaxCertificate
                       UNDEFINED X szCreditMessage
                       UNDEFINED X mnRelatedAddress1
                       UNDEFINED X mnRelatedAddress2
                       UNDEFINED X mnRelatedAddress3
                       UNDEFINED X mnRelatedAddress4
                       UNDEFINED X mnRelatedAddress5
                       UNDEFINED X mnRelatedAddress6
                       UNDEFINED X szBranchPlant
                       UNDEFINED X szLanguagePreference
                       VA evt_ErrorMessageReturned <- szErrorMessage
                       <Blank> -> cSuppressError
                       UNDEFINED X szTaxID
                       UNDEFINED X cPersonCorporationCode
0486                //
0487                If VA evt_ErrorMessageReturned is equal to <Blank> Or VA evt_ErrorMessageReturned is equal to <Null>
0488                   Ship Confirm Cache For Address Book
                          "7" -> szCacheActionCode
                          "3" -> mnNumberKeys
                          BF mnJobnumberA -> mnJobnumberA
                          BF szComputerID -> szComputerID
                          BF mnCarrier -> mnAddressNumber
                          "1" -> cSuppressErrorMessage
                          VA evt_ErrorMessageReturned <- szErrorMessage
0489                Else
0490                   Set NER Error("0037", BF mnCarrier)
0491                   VA evt_EditsProcessedFlag = "0"
0492                End If
0493                //
0494             End If
0495             //
0496          End If
0497          //
0498          // =============================
0499          //     Validate Free Good Line
0500          // =============================
0501          //
0502          If VA evt_PriceAdjustLineFlag_SO08 is equal to "3,5"
0503             // Replace existing variables with Dual UOM editing variables
0504             If VA evt_EditforDualUOM is equal to "1"
0505                Set NER Error("330R", BF szUnitOfMeasureSecondary)
0506             Else
0507                Set NER Error("330R", BF mnEnteredShipQuantity)
0508             End If
0509          End If
0510       End If
0511       //
0512       // =============================
0513       //      Validation for Overship Condition
0514       // =============================
0515       //
0516       If BF szProgramID is not equal to "EP49640"
0517          //    Overship validation for Dual Pick Processing item
0518          // Replace existing variables with Dual UOM editing variables
0519          If VA evt_EditingShippedQuantity is greater than VA evt_EditingOriginalShippedQty
              And VA evt_EditingOriginalShippedQty is greater than or equal to <Zero>
0520             VA evt_OverShipConditionFlag = "1"
0521          Else
0522             If VA evt_EditingShippedQuantity is less than VA evt_EditingOriginalShippedQty
                 And VA evt_EditingOriginalShippedQty is less than <Zero>
0523                VA evt_OverShipConditionFlag = "1"
0524             End If
0525          End If
0526          //
0527          If VA evt_PO_PreventOverShip is equal to "1"
              And VA evt_OverShipConditionFlag is equal to "1"
0528             If VA evt_EditforDualUOM is equal to "1"
0529                Set NER Error("2717", BF szUnitOfMeasureSecondary)
0530             Else
0531                Set NER Error("2717", BF mnEnteredShipQuantity)
0532             End If
0533             VA evt_EditsProcessedFlag = "0"
0534          End If
0535          //
0536          // Validation for all overship conditions where a record was created with a
0537          // Product Allocation Preference.
0538          //
0539          VA evt_387AWarningFlag = "0"
0540          IfVA evt_OverShipConditionFlagis equal to"1"AndVA evt_ProductAllocationFlag_SO10is equal to"1"
0541             VA evt_387AWarningFlag = "1"
0542             If VA evt_EditforDualUOM is equal to "1"
0543                Set NER Error("387A", BF mnUnitsSecondaryQtyOr)
0544             Else
0545                Set NER Error("387A", BF mnEnteredShipQuantity)
0546             End If
0547          End If
0548       End If
0549       //
0550       //
0551       IfVA evt_Sales_AgreementNum_DMCTis greater than<Blank>
0552          IfBF mnMultiLocQtyShipVarianceis not equal to<Zero>OrBF mnEnteredShipQuantityis not equal toVA evt_OriginalShipQuantity
0553             IfBF cActionCodeis equal to"P"
0554                VA evt_AgreementSrchQty_SOQS = [VA evt_OrigShipQyB4MultSplit4Par]+[BF mnMultiLocQtyShipVariance]
0555             Else
0556                VA evt_AgreementSrchQty_SOQS = BF mnEnteredShipQuantity
0557             End If
0558             VA evt_ErrorMsgAgreemtOvership = ""
0559             Agreement Quantity Search
                    UNDEFINED X cDueTo
                    UNDEFINED X mnIdentifierShortItem
                    VA evt_TransactionDateF4211 -> jdDate
                    UNDEFINED X mnQuantity2
                    UNDEFINED X mnProductSource
                    UNDEFINED X szProductSourceType
                    UNDEFINED X szDestinationType
                    BF szUnitOfMeasureAsInput -> szUnitOfMeasure1
                    UNDEFINED X szUnitOfMeasure2
                    UNDEFINED X mnSequenceNumber
                    BF szOrderCompany -> szOrderCompany
                    BF mnOriginal_OrderNumber -> mnOrderNumber
                    BF szOrderType -> szOrderType
                    BF mnLineNumber -> mnLineNumber
                    UNDEFINED X szAgreementNumber
                    UNDEFINED X mnAgreementSupplement
                    UNDEFINED X mnAmountField
                    VA evt_ErrorMsgAgreemtOvership <- szErrorMessage
                    UNDEFINED X szUnitOfMeasurePricing
                    "1" -> cSuppressError
                    VA evt_AgreementSrchQty_SOQS -> mnQuantity1
                    UNDEFINED X szDestination
0560             IfVA evt_ErrorMsgAgreemtOvershipis greater than<Zero>
0561                Set NER Error(VA evt_ErrorMsgAgreemtOvership, BF mnEnteredShipQuantity)
0562             End If
0563          End If
0564       End If
0565       //
0566       // =================================
0567       //      If this is a stock item, perform stock item processing.
0568       // =================================
0569       If VA evt_TextLineYN is not equal to "Y"
0570          //
0571          // ======================================
0572          // Ship Ascending Dates - Pinnacle
0573          // ======================================
0574          //
0575          VA evt_F49211FetchedFlag_EV01 = "0"
0576          VA evt_UpdateLastShipmentTableYN = "N"
0577          If BF cShipAscendingDateFlag is equal to "1"
0578             V49211C.Fetch Single
                    BF mnOrderNumber =  TK Document (Order No, Invoice, etc.)
                    BF szOrderType =  TK Order Type
                    BF szOrderCompany =  TK Order Company (Order Number)
                    BF mnLineNumber =  TK Line Number
                    VA evt_PriceAmbientStandardF49211 <- TK Price at Ambient/Standard/Weight (A,S,W)
                    BF cCheckSellByDate <- TK Check Sell By Date
                    BF cCheckExpirationDate <- TK Check Expiration Date
                    VA evt_CommitmentDateMethod_CMDM <- TK Commitment Date Method
                    BF cCheckBestBeforeDate <- TK Check Best Before Date
0579             VA evt_F49211FetchedFlag_EV01 = "1"
0580             If BF cCheckBestBeforeDate is equal to "1"
                 Or BF cCheckExpirationDate is equal to "1"
                 Or BF cCheckSellByDate is equal to "1"
0581                If BF szLot is greater than <Blank>
0582                   VA evt_ShipAscendError_DTAI = "0"
0583                   Edit Ship Ascending Dates
                          VA evt_ItemNumber -> mnShortItemNumber_ITM
                          BF szLot -> szLotNumber_LOTN
                          BF szBranchPlant -> szBusinessUnit_MCU
                          BF mnAddressNumberShipTo -> mnShipToAddressNumber_SHAN
                          UNDEFINED X idLotMasterPTR_GENLNG
                          BF cCheckExpirationDate -> cCheckExpirationDate_EDCK
                          BF cCheckSellByDate -> cCheckSellByDate_SBCK
                          BF cCheckBestBeforeDate -> cCheckBestBeforeDate_BBCK
                          VA evt_CommitmentDateMethod_CMDM -> cOverrideCommitDateMethod_CMDM
                          VA evt_ShipAscendError_DTAI <- szErrorMessageID_DTAI
                          VA evt_PO_SADWarningError_EV01 -> cOnlyIssueWarning_EV01
0584                   If VA evt_ShipAscendError_DTAI is greater than <Zero>
0585                      Set NER Error(VA evt_ShipAscendError_DTAI, BF szLot)
0586                      If VA evt_ShipAscendError_DTAI is equal to "250A,250C,250E"
0587                         VA evt_EditsProcessedFlag = "0"
0588                      Else
0589                         VA evt_UpdateLastShipmentTableYN = "Y"
0590                      End If
0591                   Else
0592                      VA evt_UpdateLastShipmentTableYN = "Y"
0593                   End If
0594                End If
0595             End If
0596          End If
0597          // ======================================
0598          // End Ship Ascending Dates - Pinnacle
0599          // ======================================
0600          //
0601          // =============================
0602          //  BULK ITEM PREP
0603          // =============================
0604          //
0605          VA evt_Bulk_FromToFlag = " "
0606          If VA evt_F4101_BulkPackFlag is equal to "B" And VA evt_BulkUseManagementFlag is equal to "1" And BF mnEnteredShipQuantity is not equal to <Zero>
0607             //
0608             // Set FromToFlag = 'S' telling Bulk Server this is a record from ship confirm
0609             //
0610             VA evt_Bulk_FromToFlag = "S"
0611             //  Get STUM from F49211 - Only read if not already read by ship ascending dates
0612             If VA evt_F49211FetchedFlag_EV01 is not equal to "1"
0613                V49211C.Fetch Single
                       BF mnOrderNumber =  TK Document (Order No, Invoice, etc.)
                       BF szOrderType =  TK Order Type
                       BF szOrderCompany =  TK Order Company (Order Number)
                       BF mnLineNumber =  TK Line Number
                       VA evt_PriceAmbientStandardF49211 <- TK Price at Ambient/Standard/Weight (A,S,W)
0614             End If
0615             //
0616             //  For Bulk Items, ensure it has have a reading time value.
0617             If BF mnBULK_TransactionTime is equal to <Zero>
0618                BF mnBULK_TransactionTime = BF mnTRAN_TimeLoad
0619             End If
0620             //
0621             //  Get new Bulk Quantities when Transaction Quantity changes:
0622             If BF mnEnteredShipQuantity is not equal to VA evt_OriginalShipQuantity
0623                //
0624                // Do not call function when N4200790 called by transportation w/compartments
0625                // and in-transit.
0626                If BF cTRAN_InventoryAffectFlag is not equal to "3"
0627                   Determine Which Bulk Quantity to Load From Trans Qty
                          BF mnEnteredShipQuantity <> mnQuantityTransaction
                          BF szUnitOfMeasureAsInput <> szUnitOfMeasureAsInput
                          BF mnBULK_AmbientQtyEntered <> mnAmbientResult
                          BF szBULK_AmbientQtyEnteredUOM <> szUnitofMeasure3
                          BF mnBULK_StandardQtyEntered <> mnStockTotalVolume
                          BF szBULK_StandardQtyEnteredUOM <> szUnitofMeasure4
                          BF mnBULK_WeightQtyEntered <> mnWeightResult
                          BF szBULK_WeightQtyEnteredUOM <> szUnitofMeasure5
                          VA evt_PO_BulkTransactVolFlagEV01 -> cAmbientOrStandard
0628                End If
0629                //
0630             End If
0631             // Need to call Verify and Get Bulk Info if a bulk item to get primary qty.  Eve
0632             // call if already have ambient , Standard, and Weight where as we used to only
0633             // call if ship qty changed.
0634             //
0635             VA evt_QuantityShipReversed = [BF mnEnteredShipQuantity]*-1
0636             VA evt_Bulk_StdQtyEnteredReversed = [BF mnBULK_StandardQtyEntered]*-1
0637             VA evt_AmbientVolumeReversed_AMBR = [BF mnBULK_AmbientQtyEntered]*-1
0638             VA evt_WeightQuantityReverse_WGTR = [BF mnBULK_WeightQtyEntered]*-1
0639             Verify and Get Bulk Information
                    "1" -> cCalculateQuantities
                    "1" -> cValidateInformation
                    <Zero> -> cWriteF41511Cache
                    UNDEFINED X szReturnErrorMessage
                    BF szBranchPlant -> szBranchPlant
                    UNDEFINED X szTankID
                    UNDEFINED X mnOwner
                    VA evt_ItemNumber -> mnIdentifierShortItem
                    "S" -> cRecordType
                    UNDEFINED X szMeterNumber
                    BF mnBULK_TransactionTime -> mnReadingTime
                    BF jdActualDeliveryDate -> jdReadingDate
                    BF mnBULK_Temperature <> mnTemperature
                    UNDEFINED X jdUserReservedDate
                    UNDEFINED X szUserReservedReference
                    UNDEFINED X mnUserReservedNumber
                    UNDEFINED X mnUserReservedAmount
                    UNDEFINED X szUserReservedCode
                    UNDEFINED X mnGainLossRecordNumber
                    UNDEFINED X cProgramStatus
                    UNDEFINED X mnCompartmentNumber
                    UNDEFINED X mnTripNumber
                    UNDEFINED X szCostCenterTrip
                    UNDEFINED X szVehicleId
                    UNDEFINED X mnContractSupplementDistri
                    UNDEFINED X szContractNumberDistributi
                    UNDEFINED X szExplanationTransaction
                    UNDEFINED X mnAmountExtendedCost
                    UNDEFINED X mnAmountUnitCost
                    UNDEFINED X jdDateLayerExpiration
                    UNDEFINED X cLotStatusCode
                    UNDEFINED X szLot
                    UNDEFINED X cUpdateControlFlag
                    UNDEFINED X szReasonCode
                    UNDEFINED X mnTransactionLineNr
                    UNDEFINED X mnBatchNumber
                    BF jdActualDeliveryDate -> jdDateTransactionJulian
                    UNDEFINED X jdDtForGLAndVouch1
                    UNDEFINED X mnNoOfLinesOnOrder
                    UNDEFINED X mnLineNumber
                    UNDEFINED X szCompanyKeyOrderNo
                    UNDEFINED X szOrderType
                    UNDEFINED X mnDocumentOrderInvoiceE
                    UNDEFINED X mnJournalEntryLineNo
                    UNDEFINED X szCompanyKey
                    UNDEFINED X szDocumentType
                    UNDEFINED X mnDocVoucherInvoiceE
                    UNDEFINED X cReconciliationStatus
                    UNDEFINED X mnReconciliationStatusLast
                    UNDEFINED X jdOperationalReconciledDat
                    UNDEFINED X jdThroughputReconciledDate
                    UNDEFINED X mnWeightAfterLoading
                    UNDEFINED X szUnitofMeasureWeighbridge
                    UNDEFINED X mnWeightBeforeLoading
                    UNDEFINED X mnUnitsNewTotalThroughputQ
                    UNDEFINED X mnUnitsBeginingThroughputQ
                    UNDEFINED X szUnitofMeasureA
                    UNDEFINED X mnOtherVolume
                    UNDEFINED X szUnitofMeasure8
                    UNDEFINED X mnLiquidVolume
                    UNDEFINED X szUnitofMeasure7
                    UNDEFINED X mnLiquidWeight
                    UNDEFINED X szUnitofMeasure9
                    UNDEFINED X mnVapourVolume
                    UNDEFINED X szUnitofMeasure10
                    UNDEFINED X mnVapourWeight
                    UNDEFINED X cSlipTubeReadingType
                    UNDEFINED X cTemperatureUnitLPGVapour
                    UNDEFINED X mnLPGVapourTemperature
                    UNDEFINED X szPressureUnitofMeasure
                    UNDEFINED X mnVapourPressure
                    UNDEFINED X mnWaterDip
                    UNDEFINED X mnGrossDip
                    UNDEFINED X cGaugingMethod
                    UNDEFINED X cDipType
                    UNDEFINED X cHydrometerCorrection
                    UNDEFINED X cAirCorrectYN
                    VA evt_PrimaryUoM <> szUnitofMeasure6
                    VA evt_BULK_PrimaryQtyReversed <- mnStockTotalinPrimaryUOM
                    BF szBULK_WeightQtyEnteredUOM <> szUnitofMeasure5
                    VA evt_WeightQuantityReverse_WGTR <> mnWeightResult
                    BF szBULK_StandardQtyEnteredUOM <> szUnitofMeasure4
                    VA evt_Bulk_StdQtyEnteredReversed <> mnStockTotalVolume
                    UNDEFINED X szUnitofMeasureAmbientVolu
                    UNDEFINED X mnVolumeAmbientInInventory
                    BF szBULK_AmbientQtyEnteredUOM <> szUnitofMeasure3
                    VA evt_AmbientVolumeReversed_AMBR <> mnAmbientResult
                    UNDEFINED X mnVolumeCorrectionFactors
                    BF cBULK_DensityTemperatureType <> cDensityTemperatureUnit
                    BF mnBULK_DensityTemperature <> mnDensityTemperature
                    BF cBULK_ProductDensityType <> cDensityTypeAtStandardTem
                    BF mnBULK_ProductDensity <> mnDisplayDensity
                    UNDEFINED X cStrappingTemperatureUnit
                    BF szLocation -> szLocation
                    UNDEFINED X szUserId
                    UNDEFINED X szProgramId
                    UNDEFINED X szWorkStationId_2
                    UNDEFINED X jdDateUpdated
                    UNDEFINED X mnTimeOfDay
                    UNDEFINED X SuppressErrorMessages
                    UNDEFINED X cSuppressLowLevelWarning
                    UNDEFINED X szReadingHeightUSGross
                    UNDEFINED X szReadingHeightUSWater
                    UNDEFINED X mnJobNumberForCache
                    UNDEFINED X mnUniqueKeyIDInternal
                    UNDEFINED X mnRowIdentifier
                    UNDEFINED X szFileLocation
                    UNDEFINED X mnAlternateFromAAI
                    UNDEFINED X szGainLossLocation
                    UNDEFINED X cReversalFlag
                    UNDEFINED X szVersion
                    VA evt_Pointer <- idPointerToItemMasterRecord
                    VA evt_ItemBranchPtr_GENLNG <- idPointerToItemBranchRecord
                    VA evt_QuantityShipReversed <> mnQuantityTransaction
                    BF szUnitOfMeasureAsInput -> szUnitOfMeasureTransaction
                    UNDEFINED X mnShipmentNumberB73
                    UNDEFINED X szAlternateFromAccountID
                    VA evt_BranchPlantConstPtr_GENLNG <- idBranchPlantConstantRecord
                    UNDEFINED X cBulkGainLossTransaction
                    UNDEFINED X cErrorCode
                    UNDEFINED X mnMeterRowNum
                    VA evt_PO_BulkTransactVolFlagEV01 -> cBulkTransportationVolumeFlag
                    UNDEFINED X cBulkStandardQuantitiesFlag
                    UNDEFINED X szOrderSuffix
0640             If VA evt_Pointer is not equal to <Null>
0641                Memory, Free Ptr To Data Structure
                       VA evt_Pointer <> idGenericLong
0642             End If
0643             If VA evt_BranchPlantConstPtr_GENLNG is not equal to <Null>
0644                Memory, Free Ptr To Data Structure
                       VA evt_BranchPlantConstPtr_GENLNG <> idGenericLong
0645             End If
0646             If VA evt_ItemBranchPtr_GENLNG is not equal to <Null>
0647                Memory, Free Ptr To Data Structure
                       VA evt_ItemBranchPtr_GENLNG <> idGenericLong
0648             End If
0649             BF mnBULK_StandardQtyEntered = [VA evt_Bulk_StdQtyEnteredReversed]*-1
0650             BF mnBULK_AmbientQtyEntered = [VA evt_AmbientVolumeReversed_AMBR]*-1
0651             BF mnBULK_WeightQtyEntered = [VA evt_WeightQuantityReverse_WGTR]*-1
0652             VA evt_BULK_PrimaryQty_STUM = [VA evt_BULK_PrimaryQtyReversed]*-1
0653             BF mnEnteredShipQuantity = [VA evt_QuantityShipReversed]*-1
0654             //
0655          End If
0656          //
0657          // Only convert Secondary Unit of Measure if non Dual UOM item
0658          //
0659          // Change edit to list values of "1,2"
0660          If VA evt_DualUnitOfMeasureItem is not equal to "1,2"
0661             VA evt_ConvertNonDualItem = "1"
0662          End If
0663          //
0664          //   UOM:  Convert to other units of measure and get pricing unit of measure.
0665          //   (change for nonstock lines):  Pass ItemMasterExist flag in place of
0666          //    Inventory Interface flag.  This change needed to prevent F41002 Get UOM
0667          //
0668          // In the Get Item UoM Conversion function if the potency mode is equal to
0669          // either a 'S', or a 'K', then the standard potency is used, otherwise the
0670          // lot potency is retrieved.  We want to make sure that if the commit flag is
0671          // currently an 'S' then we check the lot potency.  Therefore, if the commit
0672          // flag is an 'S' then we change the potency mode to an 'H', otherwise we set
0673          // the potency mode equal to the commit flag.
0674          If VA evt_CommitFlag is equal to "S"
0675             VA evt_cPotencyMode_EV01 = "H"
0676          Else
0677             VA evt_cPotencyMode_EV01 = VA evt_CommitFlag
0678          End If
0679          //
0680          F41002 Get Item UoM Conversion
                 BF szBranchPlant -> szBranchPlant
                 BF szUnitOfMeasureAsInput -> szFromUnitOfMeasure
                 VA evt_PricingUoM -> szToUnitOfMeasure
                 BF mnEnteredShipQuantity -> mnQuantityToConvert
                 VA evt_ItemMasterExists -> cInventoryInterfaceFlag
                 VA evt_ConversionFactor <- mnConversionFactorFromToPrim
                 VA evt_ConvFactPricToPrim <- mnConversionFactorTo_to_Primar
                 VA evt_PrimaryShipQuantity <- mnQuantityConvertedToPrimary
                 VA evt_ConvertNonDualItem -> cConvertToSecondary
                 VA evt_NonDualSecondaryQty <- mnQuantityConvertedToSecondary
                 "1" -> cConvertToWeight
                 VA evt_UnitWeight <- mnQuantityConvertedToWeight
                 "1" -> cConvertToVolume
                 VA evt_UnitVolume <- mnQuantityConvertedToVolume
                 VA evt_cPotencyMode_EV01 -> cPotencyMode
                 BF szLot -> szLotNumber
                 VA evt_PotencyControl -> cPotencyControl
                 VA evt_StandardPotency -> mnStandardPotency
                 "1" -> cSuppressErrorMsg
                 VA evt_ItemNumber -> mnShortItemNumber
                 VA evt_PrimaryUoM -> szUOMToPrimary
                 VA evt_SecondaryPrimaryUoM -> szUOMToSecondary
                 VA evt_PricingUoM -> szUOMToPricing
                 VA evt_WeightUoM -> szUOMToWeight
                 VA evt_VolumeUoM -> szUOMToVolume
                 VA evt_StandardUoMConversion -> szStandardUOMConversion
0681          VA evt_mnOriginalConvFactor_CNV1 = VA evt_ConversionFactor
0682          //
0683          // If this is a potency item, AND the lot or branch plant has changed then
0684          // retrieve the conversion factor for the original lot or branch plant.  This
0685          // conversion faqctor is needed to reverse the original inventory commitments.
0686          If VA evt_PotencyControl is equal to "Y"
0687             If VA evt_OriginalLot is not equal to BF szLot Or VA evt_OriginalBranchPlant is not equal to BF szBranchPlant
0688                If VA evt_OriginalLot is not equal to <Blank> And VA evt_OriginalLot is not equal to <Null> Or BF szLot is not equal to <Blank> And BF szLot is not equal to <Null>
0689                   F41002 Get Item UoM Conversion
                          VA evt_OriginalBranchPlant -> szBranchPlant
                          BF szUnitOfMeasureAsInput -> szFromUnitOfMeasure
                          VA evt_PricingUoM -> szToUnitOfMeasure
                          BF mnEnteredShipQuantity -> mnQuantityToConvert
                          VA evt_ItemMasterExists -> cInventoryInterfaceFlag
                          VA evt_mnOriginalConvFactor_CNV1 <- mnConversionFactorFromToPrim
                          VA evt_cPotencyMode_EV01 -> cPotencyMode
                          VA evt_OriginalLot -> szLotNumber
                          VA evt_PotencyControl -> cPotencyControl
                          VA evt_StandardPotency -> mnStandardPotency
                          "1" -> cSuppressErrorMsg
                          VA evt_ItemNumber -> mnShortItemNumber
                          VA evt_PrimaryUoM -> szUOMToPrimary
                          VA evt_StandardUoMConversion -> szStandardUOMConversion
0690                End If
0691             End If
0692          End If
0693          //
0694          // Retain value of weight if from F4211 for Configured Items
0695          IfVA evt_CommitFlagis equal to"H"OrVA evt_CommitFlagis equal to"K"
0696             IfVA evt_StockingType_F4102is equal to"C"
0697                VA evt_UnitWeight = VA evt_ItemWeight
0698             End If
0699          End If
0700          // Retain value of ITVL when full quantity is shipped
0701          IfBF cActionCodeis not equal to"S"
0702             IfVA evt_EditforDualUOMis not equal to"1"AndBF mnEnteredShipQuantityis equal toVA evt_TableQuantityShipped
0703                VA evt_UnitWeight = VA evt_ItemWeight
0704                VA evt_UnitVolume = VA evt_ItemVolumeTable_ITVL
0705             Else
0706                IfBF mnUnitsSecondaryQtyOris equal toVA evt_TableSecondaryQuantityAndVA evt_EditforDualUOMis equal to"1"
0707                   VA evt_UnitWeight = VA evt_ItemWeight
0708                   VA evt_UnitVolume = VA evt_ItemVolumeTable_ITVL
0709                End If
0710             End If
0711          End If
0712          //
0713          // round Primary Ship Quantiy to UOM decimal precision used by PQOH.
0714          Get Data Dictionary Definition
                 "PQOH" -> szDataDictionaryItem
                 "1" -> cSuppressErrorMessage
                 VA evt_mnDecimalsforRounding_PQOH <- mnDisplayDecimals
0715          VA evt_PrimaryShipQuantity = round([VA evt_PrimaryShipQuantity],[VA evt_mnDecimalsforRounding_PQOH])
0716          //
0717          // If Dual UOM is active, get conversion factors required for Dual
0718          // UOM processing, and convert secondary quantity into transaction UOM.
0719          //
0720          // Change edit to list values of "1,2"
0721          If VA evt_DualUnitOfMeasureItem is equal to "1,2"
0722             Compute Dual Unit of Measure Converion Factors
                    BF szUnitOfMeasureAsInput -> szTransactionUnitOfMeasure
                    VA evt_PrimaryUoM -> szTransactionUOMPrimary
                    BF szUnitOfMeasureSecondary -> szSecondaryUnitOfMeasure
                    VA evt_SecondaryPrimaryUoM -> szSecondaryUOMPrimary
                    VA evt_ConversionFactor -> mnInputConvFactorTranstoPrim
                    VA evt_ConvFactorSecondarytoTrans <- mnConvFactorSecondarytoTrans
                    VA evt_ConvFactorTranstoSecondary <- mnConvFactorTranstoSecondary
                    VA evt_ConvFactorSecndtoScndPrime <- mnConvFactorSecndtoScndPrime
                    BF mnUnitsSecondaryQtyOr -> mnSecondaryShipQuantity
                    BF szBranchPlant -> szBranchPlant
                    VA evt_ItemMasterExists -> cItemMasterExists
                    VA evt_ItemNumber -> mnIdentifierShortItem
                    VA evt_StandardUoMConversion -> szStandardUOMConversion
                    VA evt_PrimaryScndryShipQuantity <- mnScndryPrimaryShipQuantity
                    VA evt_ConvertedSecondaryQuantity <- mnScndryShipQuantityinTransUOM
                    "1" -> cSuppressErrorMessage
                    VA evt_ErrorMessageReturned <- szErrorMessageID
                    VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                    VA evt_DecimalsforRounding_SQOR <- mnDecimalsforRounding_SQOR
                    VA evt_DecimalsforRounding_SOQS <- mnDecimalsforRounding_SOQS
0723             //
0724             // round Primary Secondary Ship Quantiy to UOM decimal precision used by PQOH.
0725             VA evt_PrimaryScndryShipQuantity = round([VA evt_PrimaryScndryShipQuantity],[VA evt_mnDecimalsforRounding_PQOH])
0726             //
0727             If VA evt_ErrorMessageReturned is greater than <Blank>
0728                Retrieve F9207 Info for Error Messages
                       VA evt_ErrorMessageReturned -> szDataItem
                       VA evt_ErrorLevel <- cErrorLevel
                       UNDEFINED X idDataStructureTemplateID
                       UNDEFINED X szDataStructureObjectName
                       UNDEFINED X idDataDictionaryID
0729                If VA evt_ErrorLevel is equal to "1"
0730                   VA evt_EditsProcessedFlag = "0"
0731                   // Correct assignment of error message ID
0732                   Set NER Error("170K", BF szUnitOfMeasureSecondary)
0733                End If
0734             End If
0735             If VA evt_AssignConvertedOrderQty is equal to "1"
0736                VA evt_OriginalOrderQtySecondary = VA evt_ConvertedSecondaryQuantity
0737                // Compute Original Order Seconary Qty for non multi-location line
0738             Else
0739                IfVA evt_AssignConvertedOrderQtyis equal to"2"
0740                   VA evt_OriginalOrderQtySecondary = [VA evt_TableSecondaryQuantity]*[VA evt_ConvFactorSecondarytoTrans]
0741                   VA evt_OriginalOrderQtySecondary = round([VA evt_OriginalOrderQtySecondary],[VA evt_DecimalsforRounding_SOQS])
0742                   // Construct secondary quantities for Multi Location parent line
0743                   // processing. The adjustment quantities account for rounding associated with
0744                   // Calculate New Quantities processing.
0745                   // --------------------------------
0746                   // SAR 7135266 - Qty must balance error w/ b/o qty
0747                   VA evt_OriginalOrderQtySecondary = ([VA evt_OriginalOrderQtySecondary]+[VA evt_OriginalBackorderQuantity])+[VA evt_OriginalCancelQuantity]
0748                   // End SAR 7135266
0749                   // --------------------------------
0750                Else
0751                   If VA evt_AssignConvertedOrderQty is equal to "0"
0752                      VA evt_OriginalOrderQtySecondary = [VA evt_OriginalOrderQtySecondary]*[VA evt_ConvFactorSecondarytoTrans]
0753                      VA evt_OriginalOrderQtySecondary = round([VA evt_OriginalOrderQtySecondary],[VA evt_DecimalsforRounding_SOQS])
0754                      //
0755                      VA evt_mnMultiLocDualAdjQty_SQOR = [BF mnMultiLocSecondaryOrderQty]-([VA evt_OriginalOrderQtySecondary]*[VA evt_ConvFactorTranstoSecondary])
0756                      VA evt_mnMultiLocDualAdjQty_SQOR = round([VA evt_mnMultiLocDualAdjQty_SQOR],[VA evt_DecimalsforRounding_SQOR])
0757                      //
0758                      // The values for Multi Loc Diff Adj needs to be rounded after each conversion
0759                      // to simulate the rounding that would occur during processing of the related
0760                      // quantities whose value this will adjust. The MOD operation was not used
0761                      // because of multi decimal considerations.
0762                      //
0763                      VA evt_mnMultiLocDiffAdjQty_SQOR = [BF mnMultiLocSecondaryQtyShipVar]*[VA evt_ConvFactorSecondarytoTrans]
0764                      VA evt_mnMultiLocDiffAdjQty_SQOR = round([VA evt_mnMultiLocDiffAdjQty_SQOR],[VA evt_DecimalsforRounding_SOQS])
0765                      VA evt_mnMultiLocDiffAdjQty_SQOR = [BF mnMultiLocSecondaryQtyShipVar]-([VA evt_mnMultiLocDiffAdjQty_SQOR]*[VA evt_ConvFactorTranstoSecondary])
0766                      VA evt_mnMultiLocDiffAdjQty_SQOR = round([VA evt_mnMultiLocDiffAdjQty_SQOR],[VA evt_DecimalsforRounding_SQOR])
0767                      //
0768                   End If
0769                End If
0770             End If
0771          Else
0772             // retain secondary UOM and quantity values for users not using UOM and needing
0773             // secondary UOM and quantity retained.
0774             //
0775             IfBF mnEnteredShipQuantityis not equal toVA evt_TableQuantityShippedOrBF cActionCodeis equal to"S"
0776                BF szUnitOfMeasureSecondary = VA evt_SecondaryPrimaryUoM
0777                BF mnUnitsSecondaryQtyOr = VA evt_NonDualSecondaryQty
0778             End If
0779          End If
0780          //
0781       End If
0782       // =================================
0783       //      END TEXT LINE CHECK/ STOCK PROCESSING
0784       // =================================
0785       If VA evt_EditforDualUOM is equal to "1"
0786          VA evt_newPrimaryShipQuantity = [VA evt_ConvertedSecondaryQuantity]*[VA evt_ConversionFactor]
0787       Else
0788          VA evt_newPrimaryShipQuantity = VA evt_PrimaryShipQuantity
0789       End If
0790       //
0791       //   Get Selling Company and Backorder Allow Flag from F4201 (MCU)
0792       V4201J.Fetch Single
              BF szOriginal_CompanyKeyOrderNo =  TK Order Company (Order Number)
              BF mnOrderNumber =  TK Document (Order No, Invoice, etc.)
              BF szOrderType =  TK Order Type
              VA evt_BranchPlant_F4201 <- TK Business Unit
              VA evt_SHBackFlag <- TK Backorders Allowed (Y/N)
0793       //      If PO does not have a B/P set for agreements
0794       //           If PO set to use default B/P, get default B/P from F40095
0795       If VA evt_PO_AgreementDestination is equal to <Blank>
           Or VA evt_PO_AgreementDestination is equal to <Null>
0796          If VA evt_PO_AgreementBPFlag is equal to "2"
0797             //
0798             // Get default branch from F40095 Get Default Branch
0799             F40095 Get Default Branch
                    VA evt_PO_AgreementDestination <- szBranch
                    UNDEFINED X szApprovalRouteCode
0800             VA evt_DestinationType1 = "CC"
0801          Else
0802             VA evt_PO_AgreementDestination = "*ANY"
0803             VA evt_DestinationType1 = "*A"
0804          End If
0805       Else
0806          VA evt_DestinationType1 = "CC"
0807       End If
0808       //
0809       // Read F41001 to retrieve following info:
0810       //      B/P foreign depot flag
0811       //      Inventory Lot Creation Allowed
0812       //      Warehouse turned on flag
0813       //      Agreement Destination Address
0814       //      CIBackorder Flag
0815       //      Quality Control Y/N flag
0816       //      Quantity Soft Commited To SO/WO Subtract From Availability
0817       //
0818       VA evt_SystemCodeBPSearch = " "
0819       VA evt_ForeignBPInventoryRelief = " "
0820       F41001.Fetch Single
              VA evt_AN8AgreementDestination <- TK Address Number
              VA evt_CIBackAllowed_BACK <- TK Backorders Allowed (Y/N)
              VA evt_QtySoftCommitSO_WO_Flag <- TK Quantity Soft Committed to SO & WO
              VA evt_WarehouseOnFlag_WCTL <- TK Control Code - Warehouse Management
              VA evt_ForeignDepot <- TK Foreign Depot
              VA evt_cQualityControlYN_OT4Y <- TK Quality Management
              VA evt_SystemCodeBPSearch =  TK Product Code
              BF szBranchPlant =  TK Business Unit
              VA evt_F41001InvLotCreation_OT6Y <- TK Inventory Lot Creation Y/N
0821       If VA evt_PO_OverrideRelieveOnHand is not equal to "1"
0822          If VA evt_ForeignDepot is equal to "Y"
              Or VA evt_ForeignDepot is equal to "1"
0823             VA evt_ForeignDepot = "1"
0824             VA evt_ForeignBPInventoryRelief = "1"
0825             If VA evt_PO_AgreementSearchFlag is equal to <Blank>
                 Or VA evt_PO_AgreementSearchFlag is equal to <Null>
0826                VA evt_PO_AgreementSearchFlag = "3"
0827             End If
0828             VA evt_CurrToConvert_Agreements = " "
0829             F0010 Get Company Currency Code
                    BF szOrderCompany -> szCompany
                    VA evt_BaseCurrenyCode_Agreement <- szCurrencyCode
                    UNDEFINED X cDetailedCurrencyRestatement
                    UNDEFINED X cPostByCurrency
0830             If VA evt_BaseCurrenyCode_Agreement is not equal to VA evt_CurrencyCode
0831                VA evt_CurrToConvert_Agreements = "1"
0832             End If
0833             If BF szContractNumberDistributi is equal to <Blank>
                 Or BF szContractNumberDistributi is equal to <Null>
0834                F38010 Agreement Search
                       "C" -> cDueTo
                       VA evt_ItemNumber -> mnIdentifierShortItem
                       BF szBranchPlant -> szSource1
                       "CC" -> szSourceType1
                       UNDEFINED X szSource2
                       UNDEFINED X szSourceType2
                       VA evt_PO_AgreementDestination -> szDestination1
                       VA evt_DestinationType1 -> szDestinationType1
                       UNDEFINED X szDestination2
                       UNDEFINED X szDestinationType2
                       VA evt_RequestedDate_F4211_DRQJ -> jdDate
                       BF mnEnteredShipQuantity -> mnQuantity1
                       UNDEFINED X mnQuantity2
                       BF szUnitOfMeasureAsInput -> szUnitOfMeasure1
                       UNDEFINED X szUnitOfMeasure2
                       VA evt_PO_AgreementSearchFlag -> cAgreementSearchMethod
                       BF mnOrderNumber -> mnOrderNumber
                       BF szOrderType -> szOrderType
                       BF szOrderCompany -> szOrderCompany
                       BF mnLineNumber -> mnLineNumber
                       VA evt_BorrowSourceAgreement <- szProductSource
                       VA evt_BorrowSourceTypeAgreement <- szProductSourceType
                       BF szContractNumberDistributi <- szAgreementNumber
                       BF mnContractSupplementDistri <- mnAgreementSupplement
                       VA evt_BorrowSequenceAgreement <- mnSequenceNumber
                       VA evt_AgreementsFound <- mnAgreementsFound
                       UNDEFINED X cSuppressError
                       BF mnJobnumberA -> mnJobnumberA
                       BF szComputerID -> szComputerID
                       VA evt_BaseCurrenyCode_Agreement -> szBaseCurrencyCode
                       VA evt_CurrencyCode -> szForeignCurrencyCode
                       UNDEFINED X mnAmountField
                       UNDEFINED X szOrderSuffix
                       UNDEFINED X szErrorMessage
                       UNDEFINED X cAccommodations
                       UNDEFINED X cUpdateAmbStdWgt
                       UNDEFINED X mnUnitPrice
                       UNDEFINED X szPriceSchedule
                       UNDEFINED X cAgreementType
                       UNDEFINED X mnPartner
                       UNDEFINED X cCommingled
                       UNDEFINED X szUnitOfMeasurePricing
                       UNDEFINED X mnForeignUnitPrice
                       UNDEFINED X szCostCenter
                       UNDEFINED X cAccommodationAgreeOnly
                       VA evt_CurrToConvert_Agreements -> cCurrencyToConvert
                       UNDEFINED X mnExchangeRate
0835                If VA evt_PO_AgreementSearchFlag is equal to "1"
                    Or VA evt_PO_AgreementSearchFlag is equal to "2"
0836                   If VA evt_AgreementsFound is not equal to "1"
                       Or BF szContractNumberDistributi is equal to <Blank>
                       Or BF mnContractSupplementDistri is equal to <Null>
0837                      Set NER Error(009U, BF szContractNumberDistributi)
0838                      VA evt_EditsProcessedFlag = "0"
0839                   End If
0840                End If
0841             Else
0842                VA evt_ErrorMessageAgreements = "    "
0843                F38010 Full Edit Mode
                       "2" -> cModeProcessing
                       "C" -> cDueTo
                       VA evt_ItemNumber -> mnIdentifierShortItem
                       BF szBranchPlant -> szSource1
                       "CC" -> szSourceType1
                       UNDEFINED X szSource2
                       UNDEFINED X szSourceType2
                       VA evt_PO_AgreementDestination -> szDestination1
                       VA evt_DestinationType1 -> szDestinationType1
                       UNDEFINED X szDestination2
                       UNDEFINED X szDestinationType2
                       VA evt_RequestedDate_F4211_DRQJ -> jdDate
                       BF mnEnteredShipQuantity -> mnQuantity1
                       UNDEFINED X mnQuantity2
                       BF szUnitOfMeasureAsInput -> szUnitOfMeasure1
                       UNDEFINED X szUnitOfMeasure2
                       VA evt_PO_AgreementSearchFlag -> cAgreementSearchMethod
                       BF szContractNumberDistributi -> szAgreementNumber
                       BF mnContractSupplementDistri -> mnAgreementSupplement
                       VA evt_BorrowSequenceAgreement <- mnSequenceNumber
                       VA evt_BorrowSourceAgreement <- szProductSource
                       VA evt_BorrowSourceTypeAgreement <- szProductSourceType
                       BF mnOrderNumber -> mnOrderNumber
                       BF szOrderType -> szOrderType
                       BF szOrderCompany -> szOrderCompany
                       BF mnLineNumber -> mnLineNumber
                       BF mnUnitPrice -> mnUnitPrice
                       UNDEFINED X cAgreementType
                       UNDEFINED X szUnitOfMeasurePricing
                       UNDEFINED X mnAmountField
                       VA evt_BaseCurrenyCode_Agreement -> szBaseCurrencyCode
                       VA evt_CurrencyCode -> szForeignCurrencyCode
                       UNDEFINED X mnForeignPrice
                       BF szBranchPlant -> szDepot
                       UNDEFINED X mnAgreementsFound
                       UNDEFINED X szPriceAdjustmentScheduleN
                       BF mnJobnumberA -> mnJobnumberA
                       BF szComputerID -> szComputerID
                       UNDEFINED X szOrderSuffix
                       VA evt_ErrorMessageAgreements <- szErrorMessage
                       VA evt_UpdateGL_Accomadations <- cAccommodations
                       UNDEFINED X cUpdateAmbStdWgt
                       UNDEFINED X mnPartner
                       UNDEFINED X cCommingled
                       UNDEFINED X cAccommodationAgreeOnly
                       UNDEFINED X cSuppressError
                       VA evt_CurrToConvert_Agreements -> cCurrencyToConvert
                       UNDEFINED X mnExchangeRate
0844                If VA evt_ErrorMessageAgreements is not equal to <Blank>
                    And VA evt_ErrorMessageAgreements is not equal to <Null>
0845                   Set NER Error(009U, BF szContractNumberDistributi)
0846                End If
0847             End If
0848          End If
0849       End If
0850       // ======================================
0851       // Validate Status-In Warehouse
0852       // ======================================
0853       If VA evt_StatusInWarehouse is equal to "I"
0854          Set NER Error("3558", BF mnLineNumber)
0855          VA evt_EditsProcessedFlag = "0"
0856       End If
0857       //
0858       //  Perform Inventory & Location Validations if Inventory Interface = Y
0859       //  and this is not a Text Line.
0860       If VA evt_InventoryInterface is equal to "Y"
           And VA evt_TextLineYN is not equal to "Y"
           And VA evt_ForeignBPInventoryRelief is not equal to "1"
0861          // ====================================
0862          //   PARTIAL EDIT MODE   (Edit Mode = 2),
0863          //   Don't perform Inventory, Location, Lot Validations if Editing Mode = 2
0864          // ====================================
0865          If BF cModeProcessing is not equal to "2"
0866             //
0867             // =================================
0868             //     ITEM LOCATION VALIDTATION.
0869             // =================================
0870             //
0871             // Always try to format the location that is passed into edit line.
0872             // change Format Location to validate Location when Location
0873             // Control is set on in Branch Plant Constants
0874             F4100 Format Location With Template
                    "2" -> cMode
                    "1" -> cValidate
                    UNDEFINED X idBranchConstantRecord
                    BF szBranchPlant -> szCostCenter
                    BF szLocation -> szDisplayFormatLocation
                    VA evt_LocationCache <- szFileFormatLocation
                    UNDEFINED X szAisle
                    UNDEFINED X szBin
                    UNDEFINED X szLocation3
                    UNDEFINED X szLocation4
                    UNDEFINED X szLocation5
                    UNDEFINED X szLocation6
                    UNDEFINED X szLocation7
                    UNDEFINED X szLocation8
                    UNDEFINED X szLocation9
                    UNDEFINED X szLocation10
                    UNDEFINED X cAddF4100Record
                    <Blank> -> cSuppressErrorMessage
                    VA evt_ErrorMessage <- szErrorMessageID
                    UNDEFINED X cLocationSegmentControl
0875             If VA evt_ErrorMessage is greater than <Blank>
0876                // Location not valid for Credit Order assignment
0877                VA evt_EditsProcessedFlag = "0"
0878             End If
0879             //
0880             // Replace existing variables with Dual UOM editing variables
0881             If VA evt_EditingShippedQuantity is not equal to <Zero>
0882                // =================================
0883                //   LOT PROCESSING:   If lot processing is on, lot must be entered.
0884                // =================================
0885                If VA evt_LotProcessingCode is equal to "1"
                    Or VA evt_LotProcessingCode is equal to "2"
                    Or VA evt_LotProcessingCode is equal to "3"
0886                   If BF szLot is equal to <Blank>
                       And VA evt_OriginalShipQuantity is not equal to  <Zero>
                       And VA evt_CommitFlag is not equal to "K"
0887                      Set NER Error("0642", BF szLot)
0888                      VA evt_EditsProcessedFlag = "0"
0889                      //
0890                      // Configured Items must also have a Lot Number assigned.
0891                   Else
0892                      If BF szLot is equal to <Blank>
                          And VA evt_OriginalShipQuantity is not equal to <Zero>
                          And VA evt_StockingType_F4102 is equal to "C"
0893                         Set NER Error("0642", BF szLot)
0894                         VA evt_EditsProcessedFlag = "0"
0895                      End If
0896                   End If
0897                End If
0898                //
0899                // =================================
0900                //     ITEM LOCATION VALIDTATION.
0901                // =================================
0902                If VA evt_CommitFlag is not equal to "K"
                    Or VA evt_StockingType_F4102 is equal to "C"
0903                   // =================================
0904                   // LPN - Get LP Switch Status
0905                   VA evt_cLPSwitch_EV01 = ""
0906                   Get F46L001 Records
                          BF szBranchPlant <> szCostCenter
                          VA evt_cLPSwitch_EV01 <- cLPNMasterSwitch
0907                   // =================================
0908                   F41021 Get Item Location Row
                          BF szBranchPlant -> szBranchPlant
                          VA evt_ItemNumber -> mnShortItemNumber
                          VA evt_LocationCache -> szLocation
                          BF szLot -> szLotNumber
                          "1" -> mnIndex
                          "4" -> mnKeys
                          "1" -> cCallType
                          "1" -> cReturnRecord
                          VA evt_Pointer <- idItemLocationRecord
                          "1" -> cSuppressErrorMessages
                          VA evt_ErrorMessageReturned <- szErrorMessageID
                          VA evt_cLPSwitch_EV01 -> cLPSwitch
                          VA evt_cLPExist_EV01 <- cLPExist
0909                   If VA evt_ErrorMessageReturned is not equal to <Blank>
0910                      //
0911                      Memory, Free Ptr To Data Structure
                             VA evt_Pointer <> idGenericLong
0912                      //
0913                      // Validate location only when not a Credit Order or Serial
0914                      // Number processing is not set on when prior retrieval is a warning.
0915                      //
0916                      Retrieve F9207 Info for Error Messages
                             VA evt_ErrorMessageReturned -> szDataItem
                             VA evt_ErrorLevel <- cErrorLevel
                             UNDEFINED X idDataStructureTemplateID
                             UNDEFINED X szDataStructureObjectName
                             UNDEFINED X idDataDictionaryID
0917                      If VA evt_ErrorLevel is equal to "2"
0918                         // Replace existing variables with Dual UOM editing variables
0919                         If VA evt_EditingShippedQuantity is greater than <Zero>
                             And VA evt_LotProcessingCode is not equal to "4"
0920                            //   Location not set up in Item Location File
0921                            Set NER Error("3690", BF szLocation)
0922                            VA evt_EditsProcessedFlag = "0"
0923                         Else
0924                            // Credit Lot Errors/Warnings Setup
0925                            VA evt_CreditOrderLotValid_EV01 = "1"
0926                            VA evt_CreditOrderNoHdComXT4111Z1 = "0"
0927                            //
0928                            // ===========================================
0929                            // Pinnacle - Lot Enhancement
0930                            // ===========================================
0931                            //
0932                            If BF szLot is greater than <Blank>
0933                               If VA evt_PO_AllowNewLot4CreditOrder is not equal to "1"
0934                                  // Retain Lot Status Code when creating new Locations in F41021
0935                                  V4108G.Fetch Single
                                         BF szLot =  TK Lot/Serial Number
                                         BF szBranchPlant =  TK Business Unit
                                         VA evt_ItemNumber =  TK Item Number - Short
                                         VA evt_LotStatusCode_F4108 <- TK Lot Status Code
0936                                  If SV File_IO_Status is not equal to CO SUCCESS
0937                                     VA evt_CreditOrderLotValid_EV01 = "0"
0938                                  End If
0939                               Else
0940                                  If VA evt_PO_AllowNewLot4CreditOrder is equal to "1"
                                      And VA evt_F41001InvLotCreation_OT6Y is equal to "Y"
0941                                     Set NER Error("857A", BF szLot)
0942                                     VA evt_CreditOrderLotValid_EV01 = "1"
0943                                  Else
0944                                     If VA evt_F41001InvLotCreation_OT6Y is not equal to "Y"
0945                                        Set NER Error("045U", BF szLot)
0946                                        VA evt_EditsProcessedFlag = "0"
0947                                     End If
0948                                  End If
0949                               End If
0950                            End If
0951                            //
0952                            //  If invalid Lot, set on an error.  Otherwise set on a warning for Location
0953                            //
0954                            If VA evt_CreditOrderLotValid_EV01 is equal to "1"
0955                               VA evt_CreditOrderNoHdComXT4111Z1 = "1"
0956                               Set NER Error("0678", BF szLocation)
0957                               // Retain Lot Status Code when creating new Locations in F41021
0958                               VA evt_LotStatusCode_NewLoc = VA evt_LotStatusCode_F4108
0959                               VA evt_LotStatusCode1_NewLoc = VA evt_LotStatusCode_F4108
0960                            Else
0961                               Set NER Error("022N", BF szLot)
0962                               VA evt_EditsProcessedFlag = "0"
0963                            End If
0964                         End If
0965                      Else
0966                         //   Location not set up in Item Location File
0967                         Set NER Error("3690", BF szLocation)
0968                         VA evt_EditsProcessedFlag = "0"
0969                      End If
0970                      //
0971                   Else
0972                      // =======================================
0973                      //  LOT HOLD VALIDATION
0974                      // Retrieve the lot status from this location.  If lot on hold, issue error.
0975                      // =======================================
0976                      F41021 Get Item Location Quantities
                             VA evt_Pointer -> idF41021Pointer
                             VA evt_LotStatus <- cLotStatusCode
                             VA evt_QuantityOnHand <- mnQtyOnHand
                             VA evt_szF41021GlCategory_GLPT <- szGlCategory
                             VA evt_SecondaryQtyOnHand <- mnSecondaryQtyOnHand
0977                      Memory, Free Ptr To Data Structure
                             VA evt_Pointer <> idGenericLong
0978                      If VA evt_LotStatus is not equal to <Blank> And VA evt_PO_ErrorLocationOnHold is equal to "1" And VA evt_PO_LotGroupName_LOTGRP is greater than <Blank>
0979                         //
0980                         //     Validate Lot Staus against F41081 to process Allowed Lot Status
0981                         Verify Allowed Lot Status
                                "1" -> cSuppressErrorMessage
                                VA evt_LotStatus -> cLotStatusCode
                                VA evt_PO_LotGroupName_LOTGRP -> szLotGroup
                                BF szBranchPlant -> szBranchPlant
                                BF szOrderType -> szOrderType
                                VA evt_cAllowedLotStatusCode_EV01 <- cValidationResult
0982                      Else
0983                         VA evt_cAllowedLotStatusCode_EV01 = "0"
0984                      End If
0985                      If VA evt_LotStatus is not equal to <Blank> And VA evt_PO_ErrorLocationOnHold is equal to "1" And VA evt_cAllowedLotStatusCode_EV01 is not equal to "1"
0986                         //   Item Location for this lot is on Hold
0987                         Set NER Error("0520", BF szLocation)
0988                         VA evt_EditsProcessedFlag = "0"
0989                      Else
0990                         //   Do not check the expiration date if this is a Credit Order
0991                         //
0992                         // Replace existing variables with Dual UOM editing variables
0993                         If BF szLot is greater than <Blank>
                             And VA evt_EditingShippedQuantity is greater than <Zero>
0994                            VA evt_DateLayerExpiration = " "
0995                            V4108G.Fetch Single
                                   BF szLot =  TK Lot/Serial Number
                                   BF szBranchPlant =  TK Business Unit
                                   VA evt_ItemNumber =  TK Item Number - Short
                                   VA evt_DateLayerExpiration <- TK Date - Lot Expiration
                                   VA evt_VendorLotNumber <- TK Supplier Lot Number
                                   VA evt_MemoLotField1_LOT1 <- TK Memo Lot 1
                                   VA evt_MemoLotField2_LOT2 <- TK Memo Lot 2
                                   VA evt_MemoLotField3_LOT3 <- TK Memo Lot 3
0996                            If VA evt_DateLayerExpiration is less than BF jdActualDeliveryDate
0997                               Set NER Error("4788", BF szLot)
0998                               VA evt_EditsProcessedFlag = "0"
0999                            End If
1000                         End If
1001                      End If
1002                      VA evt_c109YWarningFlag_EV01 = "0"
1003                      If VA evt_cQualityMgmtInstalled_EV01 is equal to "1"
                          And VA evt_cQualityControlYN_OT4Y is equal to "Y"
                          And VA evt_cPO_QMReEvalTestRslts_EV01 is equal to "1"
1004                         Get P3711 Processing Options
                                UNDEFINED X cScreenFormat_EV01
                                UNDEFINED X mnAddressNumber_AN8
                                VA evt_cUsePrefMinMax_EV01 <- cUsePreferred_EV05
                                UNDEFINED X cDisplaySampleNumber_EV06
                                UNDEFINED X cCopyGenericText_EV01
                                UNDEFINED X cPreferenceProfiles_EV09
                                UNDEFINED X cNonconforming_EV08
                                UNDEFINED X cProtectDateTime_EV03
                                UNDEFINED X cProtectTester_EV04
                                UNDEFINED X cFailedLotStatus_LOTS
                                UNDEFINED X cPassingLotStatus_LOTS
                                UNDEFINED X cUpdateStatusSelection_EV07
                                UNDEFINED X szProductTestReport_VERS
                                UNDEFINED X szCOA_VERS
                                UNDEFINED X szTraceTestResults_VERS
                                "1" -> cSuppressErrorMessage_SUPPS
                                UNDEFINED X cErrorCode_ERRC
                                VA evt_TestResultsVersion -> szP3711Version_VERS
                                UNDEFINED X szErrorMessageID
                                UNDEFINED X cSystemSampleNumbering_EV01
1005                         Evaluate Test Results for Quality Management
                                VA evt_ItemNumber -> mnItemNum
                                VA evt_ShipTo_F4211 -> mnShipToAddressNum
                                VA evt_SoldToTable -> mnSoldToAddressNum
                                UNDEFINED X mnParentAddressNum
                                UNDEFINED X jdDateRequested
                                UNDEFINED X mnOrderQuantity
                                UNDEFINED X szUnitOfMeasure
                                BF szBranchPlant -> szBranchPlant
                                BF szLot -> szLotNum
                                VA evt_LocationCache -> szLotLocation
                                UNDEFINED X mnDocumentNum
                                UNDEFINED X szDocumentType
                                UNDEFINED X szKeyCompany
                                UNDEFINED X mnLineNum
                                UNDEFINED X mnTripNum
                                UNDEFINED X mnTripLegNum
                                UNDEFINED X mnLogicalCompartmentNum
                                UNDEFINED X szVehicleID
                                BF szComputerID -> szComputerID
                                BF mnJobnumberA -> mnJobnumber
                                UNDEFINED X cErrorCode
                                UNDEFINED X szErrorMessageID
                                "2" -> cProcessingMode
                                VA evt_cUsePrefMinMax_EV01 -> cUsePrefMinMax
                                VA evt_cQMPassFail_EV01 <- cPassFailFlag
                                VA evt_cQMTestResultStatus_EV01 <- cTestResultsStatus
                                UNDEFINED X szCostCenterTrip
                                SL DateToday                       -> jdTransactionDate
1006                         If VA evt_cQMTestResultStatus_EV01 is equal to "1"
1007                            If VA evt_cQMPassFail_EV01 is equal to "F,I,N"
1008                               Set NER Error("109W", BF szLot)
1009                               VA evt_EditsProcessedFlag = "0"
1010                            End If
1011                         Else
1012                            If VA evt_cQMTestResultStatus_EV01 is equal to "2"
1013                               If VA evt_cQMPassFail_EV01 is equal to "I,N"
1014                                  Set NER Error("109Y", BF szLot)
1015                                  VA evt_c109YWarningFlag_EV01 = "1"
1016                               Else
1017                                  If VA evt_cQMPassFail_EV01 is equal to "F"
1018                                     Set NER Error("109X", BF szLot)
1019                                     VA evt_EditsProcessedFlag = "0"
1020                                  End If
1021                               End If
1022                            End If
1023                         End If
1024                      End If
1025                      //
1026                      // If Location, Lot, or Branch has changed, replace GLCategory from F4211 with
1027                      // GLCategory from F41021
1028                      //
1029                      If VA evt_LocationCache is equal to VA evt_OriginalLocation And BF szLot is equal to VA evt_OriginalLot And BF szBranchPlant is equal to VA evt_OriginalBranchPlant
1030                         VA evt_szGlCategory_Cache_GLPT = VA evt_GlCategory
1031                      Else
1032                         VA evt_szGlCategory_Cache_GLPT = VA evt_szF41021GlCategory_GLPT
1033                      End If
1034                      //
1035                      //  Ensure Ship Quantity > 0.  This condition is to ensure On Hand and
1036                      //  availability edits do not prevent Credits from being confirmed.
1037                      // Replace existing variables with Dual UOM editing variables
1038                      If VA evt_EditingShippedQuantity is greater than <Zero>
1039                         //
1040                         // ***********************************************
1041                         //  INVENTORY AVAILABILITY VALIDATION
1042                         //      Perform availability checking if specified in processing option and
1043                         //       allowed for this item, as well as this line has not been hard committed
1044                         //       Return the quantity available in the line item's Primary Uom.
1045                         //
1046                         // Modify edit for Availability
1047                         // ====================================
1048                         //    GET ON HAND AND AVAILABILITY AMOUNTS
1049                         // ====================================
1050                         If VA evt_PO_CheckAvailability is equal to "1"
                             Or VA evt_PO_PreventNegOnHand is equal to "1"
1051                            If VA evt_EditforDualUOM is equal to "1"
1052                               F41021 Calculate Quantity Available Shell
                                      VA evt_ItemNumber -> mnShortItemNumber
                                      BF szBranchPlant -> szBranchPlant
                                      VA evt_LocationCache -> szLocation
                                      BF szLot -> szLotNumber
                                      VA evt_SecondaryPrimaryUoM -> szPrimaryUOM
                                      VA evt_SecondaryPrimaryUoM -> szSecondaryUOM
                                      <Blank> -> cSuppressErrorMessages
                                      VA evt_QuantityAvailable <- mnQuantityAvailable
                                      "1" -> mnIndex
                                      VA evt_QtySoftCommitSO_WO_Flag <- cUDQtySoftCommit
                                      VA evt_QuantityOnHand <- mnQtyOnHand
                                      "4" -> mnKeys
                                      VA evt_PO_LotGroupName_LOTGRP -> szLotGroup
                                      BF szOrderType -> szOrderType
                                      VA evt_cLPExist_EV01 -> cLPExist
                                      VA evt_mnPrimaryQtyOnLP_MATH01 <- mnQuantityOnLP
                                      VA evt_mnSecondaryQtyOnLP_MATH01 <- mnDualQuantityOnLP
1053                               // LPN - Reduce the On-Hand by the Quantity on LP
1054                               VA evt_QuantityOnHand = [VA evt_QuantityOnHand]-[VA evt_mnSecondaryQtyOnLP_MATH01]
1055                            Else
1056                               F41021 Calculate Quantity Available Shell
                                      VA evt_ItemNumber -> mnShortItemNumber
                                      BF szBranchPlant -> szBranchPlant
                                      VA evt_LocationCache -> szLocation
                                      BF szLot -> szLotNumber
                                      VA evt_PrimaryUoM -> szPrimaryUOM
                                      VA evt_PrimaryUoM -> szSecondaryUOM
                                      <Blank> -> cSuppressErrorMessages
                                      VA evt_QuantityAvailable <- mnQuantityAvailable
                                      "1" -> mnIndex
                                      VA evt_QtySoftCommitSO_WO_Flag <- cUDQtySoftCommit
                                      VA evt_QuantityOnHand <- mnQtyOnHand
                                      "4" -> mnKeys
                                      VA evt_PO_LotGroupName_LOTGRP -> szLotGroup
                                      BF szOrderType -> szOrderType
                                      VA evt_cLPExist_EV01 -> cLPExist
                                      VA evt_mnPrimaryQtyOnLP_MATH01 <- mnQuantityOnLP
                                      VA evt_mnSecondaryQtyOnLP_MATH01 <- mnDualQuantityOnLP
1057                               VA evt_QuantityOnHand = [VA evt_QuantityOnHand]-[VA evt_mnPrimaryQtyOnLP_MATH01]
1058                            End If
1059                         End If
1060                         //
1061                         //        INVENTORY ON HAND VALIDATION.
1062                         // If On Hand is zero or negative & PO Option to prevent this is on, issue error
1063                         //
1064                         If VA evt_QuantityOnHand is less than or equal to <Zero>
                             And VA evt_PO_PreventNegOnHand is equal to "1"
1065                            // Quantity on Hand is Negative
1066                            // Replace existing variables with Dual UOM editing variables
1067                            If VA evt_EditforDualUOM is equal to "1"
1068                               Set NER Error("3011", BF szUnitOfMeasureSecondary)
1069                            Else
1070                               Set NER Error("3011", BF mnEnteredShipQuantity)
1071                            End If
1072                            VA evt_EditsProcessedFlag = "0"
1073                            //
1074                         Else
1075                            //     If confirmation will drive qty on hand negative and specified to
1076                            //      disallow in processing option, issue error.
1077                            //
1078                            // Replace existing variables with Dual UOM editing variables
1079                            If VA evt_EditforDualUOM is equal to "1"
1080                               VA evt_GenericQuantity = [VA evt_QuantityOnHand]-[VA evt_PrimaryScndryShipQuantity]
1081                            Else
1082                               VA evt_GenericQuantity = [VA evt_QuantityOnHand]-[VA evt_PrimaryShipQuantity]
1083                            End If
1084                            //
1085                            If VA evt_GenericQuantity is less than <Zero>
                                And VA evt_PO_PreventNegOnHand is equal to "1"
1086                               If VA evt_EditforDualUOM is equal to "1"
1087                                  Set NER Error("3015", BF szUnitOfMeasureSecondary)
1088                               Else
1089                                  Set NER Error("3015", BF mnEnteredShipQuantity)
1090                               End If
1091                               VA evt_EditsProcessedFlag = "0"
1092                            End If
1093                            //
1094                            //     Give an Error if  Lot Processing = 7 (serial number assigned manually)
1095                            //     and availability is Negative
1096                            //
1097                            If VA evt_LotProcessingCode is equal to "7"
                                And VA evt_QuantityAvailable is less than <Zero>
1098                               // Replace existing variables with Dual UOM editing variables
1099                               If VA evt_EditforDualUOM is equal to "1"
1100                                  Set NER Error("3011", BF szUnitOfMeasureSecondary)
1101                               Else
1102                                  Set NER Error("3011", BF mnEnteredShipQuantity)
1103                               End If
1104                            End If
1105                         End If
1106                         // =======================================
1107                         //       AVAILABILITY VALIDATION
1108                         // =======================================
1109                         If VA evt_PO_CheckAvailability is equal to "1"
                             And VA evt_CommitFlag is not equal to "H"
                             And VA evt_CommitFlag is not equal to "C"
                             And VA evt_OriginalOrderQuantity is greater than <Zero>
                             And VA evt_CheckAvailabilityFlag is equal to "Y"
                             And BF cActionCode is not equal to "S"
1110                            //
1111                            If VA evt_QtySoftCommitSO_WO_Flag is equal to "-"
1112                               VA evt_QuantityAvailable = [VA evt_QuantityAvailable]+[VA evt_PrimaryShipQuantity]
1113                            End If
1114                            //
1115                            //     If not enough available to ship the entire ship quantity and specified
1116                            //      to issue warning in processing option, set warning.
1117                            // Replace existing variables with Dual UOM editing variables
1118                            If VA evt_EditingShippedQuantity is greater than <Zero>
                                And VA evt_PrimaryShipQuantity is greater than VA evt_QuantityAvailable
1119                               VA evt_2716WarningFlag = "1"
1120                               If VA evt_EditforDualUOM is equal to "1"
1121                                  Set NER Error("2716", BF szUnitOfMeasureSecondary)
1122                               Else
1123                                  Set NER Error("2716", BF mnEnteredShipQuantity)
1124                               End If
1125                            End If
1126                            //
1127                         End If
1128                         // End - Availability Checking
1129                      End If
1130                      //  End - Ship Quantity > 0
1131                   End If
1132                   // End - Location Verification
1133                   //
1134                End If
1135                // End - Kit Check
1136                // Remove Lot Processing  = 4, 5, 6, or 7 from conditional statement
1137                If BF cActionCode is not equal to "P,S"
1138                   // If passed in Memo Lot fields are blank, override with F4108 values
1139                   If BF szMemoLotField1 is less than or equal to <Blank>
1140                      BF szMemoLotField1 = VA evt_MemoLotField1_LOT1
1141                   End If
1142                   If BF szMemoLotField2 is less than or equal to <Blank>
1143                      BF szMemoLotField2 = VA evt_MemoLotField2_LOT2
1144                   End If
1145                   If BF szVendorLotNumber is less than or equal to <Blank>
1146                      BF szVendorLotNumber = VA evt_VendorLotNumber
1147                   End If
1148                   //
1149                   If VA evt_EditingShippedQuantity is less than <Zero>
                       And VA evt_EditingOriginalShippedQty is less than <Zero>
1150                      VA evt_CallingAppToB4201210_EV01 = "D"
1151                   Else
1152                      VA evt_CallingAppToB4201210_EV01 = "C"
1153                   End If
1154                   // Change SSN edits for Dual UOM processing
1155                   If VA evt_EditforDualUOM is equal to "1"
1156                      Serial Number Processing Edits
                             VA evt_ItemNumber -> mnIdentifierShortItem
                             BF szBranchPlant -> szCostCenter
                             BF szLocation -> szLocation
                             BF szLot -> szLot
                             BF szMemoLotField1 -> szMemoLotField1
                             BF szMemoLotField2 -> szMemoLotField2
                             BF szVendorLotNumber -> szVendorLotNumber
                             BF mnUnitsSecondaryQtyOr -> mnQuantityTransaction
                             BF szUnitOfMeasureSecondary -> szTransactionUnitOfMeasure
                             VA evt_SecondaryPrimaryUoM -> szPriamaryUnitOfMeasure
                             VA evt_LotProcessingCode -> cLotProcessType
                             VA evt_SerialNumberRequired -> cSerialNumberRequired
                             VA evt_CallingAppToB4201210_EV01 -> cCallingApplication
                             UNDEFINED X idF41021Pointer
                             VA evt_SerialNumberEditError <- cErrorCode
                             UNDEFINED X szErrorMessage
                             UNDEFINED X szLotFrom
1157                   Else
1158                      Serial Number Processing Edits
                             VA evt_ItemNumber -> mnIdentifierShortItem
                             BF szBranchPlant -> szCostCenter
                             BF szLocation -> szLocation
                             BF szLot -> szLot
                             BF szMemoLotField1 -> szMemoLotField1
                             BF szMemoLotField2 -> szMemoLotField2
                             BF szVendorLotNumber -> szVendorLotNumber
                             BF mnEnteredShipQuantity -> mnQuantityTransaction
                             BF szUnitOfMeasureAsInput -> szTransactionUnitOfMeasure
                             VA evt_PrimaryUoM -> szPriamaryUnitOfMeasure
                             VA evt_LotProcessingCode -> cLotProcessType
                             VA evt_SerialNumberRequired -> cSerialNumberRequired
                             VA evt_CallingAppToB4201210_EV01 -> cCallingApplication
                             UNDEFINED X idF41021Pointer
                             VA evt_SerialNumberEditError <- cErrorCode
                             UNDEFINED X szErrorMessage
                             UNDEFINED X szLotFrom
1159                   End If
1160                End If
1161             End If
1162             //  End - Zero Ship Quantity Check
1163          End If
1164          //  End - Partial Edit Mode Verification
1165       Else
1166          //
1167          // To retain current GL Class on Sales Order line (F4211)
1168          VA evt_szGlCategory_Cache_GLPT = VA evt_GlCategory
1169       End If
1170       //
1171       //   Inventory Interface Check
1172       //
1173       // Add logic to process Ship Difference for Dual UOM processing
1174       // SET SHIP QUANTITY DIFFERENCE
1175       If BF cActionCode is equal to "P"
1176          //   MultiLocation Parent - ShipDifference passed in
1177          If VA evt_EditforDualUOM is equal to "1"
1178             VA evt_ShipQuantityDifference = 0
1179             If VA evt_OriginalOrderQtySecondary is equal to VA evt_CachedQuantityOrdered
                 And BF mnEnteredShipQuantity is not equal to VA evt_CachedQuantityShipped
                 Or VA evt_OriginalOrderQtySecondary is equal to VA evt_CachedQuantityOrdered
                 And BF mnUnitsSecondaryQtyOr is not equal to VA evt_CachedSecondaryQuantity
1180                // Calculate difference in Secondary Unit of Measure
1181                // Construct secondary quantities for Multi Location parent.
1182                // Adjust quantity to account for rounding of previous Order Quantity. Without
1183                // the adjustment, backorders or cancels of previously processed parent lines
1184                // may fail due to propagated rounding errors.
1185                //
1186                VA evt_SecondaryShipQtyDifference = ((([VA evt_CachedQuantityOrdered]-([BF mnEnteredBackorderQuantity]+[BF mnEnteredCancelQuantity]))*[VA evt_ConvFactorTranstoSecondary])-[BF mnUnitsSecondaryQtyOr])+[VA evt_mnMultiLocDiffAdjQty_SQOR]
1187             Else
1188                // Calculate difference in Secondary Unit of Measure
1189                //
1190                VA evt_SecondaryShipQtyDifference = 0-[BF mnMultiLocSecondaryQtyShipVar]
1191             End If
1192          Else
1193             VA evt_SecondaryShipQtyDifference = 0
1194             If VA evt_OriginalOrderQuantity is equal to VA evt_CachedQuantityOrdered
                 And BF mnEnteredShipQuantity is not equal to VA evt_CachedQuantityShipped
1195                VA evt_ShipQuantityDifference = [VA evt_CachedQuantityOrdered]-(([BF mnEnteredShipQuantity]+[BF mnEnteredBackorderQuantity])+[BF mnEnteredCancelQuantity])
1196             Else
1197                VA evt_ShipQuantityDifference = 0-[BF mnMultiLocQtyShipVariance]
1198             End If
1199          End If
1200       Else
1201          //
1202          // To be able to perform negative shipment in partial ships
1203          //
1204          If VA evt_EditingShippedQuantity is less than <Zero>
1205             If VA evt_EditingOriginalShippedQty is less than <Zero>
1206                //
1207                // For Credit Order
1208                //
1209                VA evt_ShipQuantityDifference = [VA evt_OriginalShipQuantity]-[BF mnEnteredShipQuantity]
1210                // Set qty used for Dual UOM price extension edits
1211                VA evt_SecondaryQtyPriceDiff_SQOR = [BF mnUnitsSecondaryQtyOr]-[VA evt_TableSecondaryQuantity]
1212                //
1213                If VA evt_EditforDualUOM is equal to "1"
1214                   // Calculate difference in Secondary Unit of Measure
1215                   VA evt_SecondaryShipQtyDifference = ([VA evt_OriginalShipQuantity]*[VA evt_ConvFactorTranstoSecondary])-[BF mnUnitsSecondaryQtyOr]
1216                End If
1217             Else
1218                //
1219                // For regular order with negative shipment
1220                //
1221                VA evt_ShipQuantityDifference = [BF mnEnteredShipQuantity]-[VA evt_OriginalShipQuantity]
1222                // Set qty used for Dual UOM price extension edits
1223                VA evt_SecondaryQtyPriceDiff_SQOR = [BF mnUnitsSecondaryQtyOr]-[VA evt_TableSecondaryQuantity]
1224                //
1225                If VA evt_EditforDualUOM is equal to "1"
1226                   // Calculate difference in Secondary Unit of Measure
1227                   VA evt_SecondaryShipQtyDifference = [BF mnUnitsSecondaryQtyOr]-([VA evt_OriginalShipQuantity]*[VA evt_ConvFactorTranstoSecondary])
1228                End If
1229             End If
1230          Else
1231             VA evt_ShipQuantityDifference = [VA evt_OriginalShipQuantity]-[BF mnEnteredShipQuantity]
1232             // Set qty used for Dual UOM price extension edits
1233             VA evt_SecondaryQtyPriceDiff_SQOR = [BF mnUnitsSecondaryQtyOr]-[VA evt_TableSecondaryQuantity]
1234             //
1235             If VA evt_EditforDualUOM is equal to "1"
1236                // Calculate difference in Secondary Unit of Measure
1237                VA evt_SecondaryShipQtyDifference = [VA evt_OriginalSecondaryQuantity]-[BF mnUnitsSecondaryQtyOr]
1238             End If
1239          End If
1240       End If
1241       // ====================================
1242       // CALCULATE QUANTITIES
1243       // ====================================
1244       // Prior to calculating qtys, if partial shipping kit components while processin
1245       // processing the entire kit, use the kit parent to see if cancel & b/o allowed.
1246       //
1247       If VA evt_PO_DisplayKitItems is not equal to "1"
           And VA evt_LineNumberKitMaster is greater than <Zero>
           And VA evt_RelatedKitComponent is less than or equal to <Zero>
1248          Process Kit Parent Line Cache
                 BF mnJobnumberA -> mnKitParentJobNumber
                 BF szComputerID -> szComputerID
                 BF mnOrderNumber -> mnDocumentOrderInvoiceE
                 BF szOrderType -> szOrderType
                 BF szOrderCompany -> szCompanyKeyOrderNo
                 VA evt_LineNumberKitMaster -> mnLineNumber
                 "1" -> szCacheActionCode
                 UNDEFINED X idCacheCursor
                 "6" -> mnNumberKeys
                 "1" -> cSuppressErrorMessage
                 VA evt_ErrorMessageKits <- szErrorMessageID
                 VA evt_SDAllowBackordersParent <- cSDAllowBackorders
                 VA evt_IBBackFlagParent <- cIBBackordersFlag
                 VA evt_IMBackFlagParent <- cIMBackordersFlag
1249          If VA evt_ErrorMessageKits is less than or equal to <Blank>
1250             VA evt_IMBackFlag = VA evt_IMBackFlagParent
1251             VA evt_IBBackFlag = VA evt_IBBackFlagParent
1252             VA evt_SDAllowBackorders = VA evt_SDAllowBackordersParent
1253          End If
1254       End If
1255       //
1256       // Prior to calculating qtys, if line is for a Configured Item or its component,
1257       // set on a flag.  This flag is used by Calulate New Qtys to not allow b/o.
1258       //
1259       If VA evt_RelatedKitComponent is greater than <Zero>
           And VA evt_LineNumberKitMaster is greater than <Zero>
1260          VA evt_ConfiguredItemFlag = "1"
1261       Else
1262          If VA evt_CommitFlag is equal to "K"
              Or VA evt_CommitFlag is equal to "H"
1263             If VA evt_StockingType_F4102 is equal to "C"
1264                VA evt_ConfiguredItemFlag = "1"
1265             End If
1266          End If
1267       End If
1268       //
1269       //     TRANSPORTATION Override Leave Shippable
1270       //     1 == all remaining quantities will be shippable when it becomes available
1271       //     2 == cancel quantities that are not shipped
1272       //
1273       If BF cTRAN_OverrideLeaveShippable is equal to "1"
1274          VA evt_PO_BackCancelRemainQty = " "
1275       Else
1276          If BF cTRAN_OverrideLeaveShippable is equal to "2"
1277             // If processing a credit order, just set the flag to be = 1.  Calculate New
1278             // Quantities will cancel the reamaining shippable since b/o for credit orders
1279             // aren't allowed.
1280             If BF mnEnteredShipQuantity is less than <Zero> And VA evt_OriginalShipQuantity is less than <Zero>
1281                VA evt_PO_BackCancelRemainQty = "1"
1282             Else
1283                VA evt_PO_BackCancelRemainQty = "2"
1284             End If
1285          End If
1286       End If
1287       //
1288       // Assign Commit Qty Difference the value of Ship Difference, & pass it in and
1289       // out of Calculate New Qtys.
1290       //
1291       VA evt_CommitQuantityDifference = VA evt_ShipQuantityDifference
1292       //
1293       // Add quantity processing for Dual UOM. Secondary Ship Quantity
1294       // Difference is in Transaction UOM when passed in to the function and is
1295       // converted back to Secondary Unit of Measure prior to exiting the function.
1296       //
1297       VA evt_CommitScndryQtyDifference = VA evt_SecondaryShipQtyDifference
1298       // Retain errors reported in Calculate New Quantities
1299       Calculate New Quantities
              BF mnOrderNumber -> mnOrderNumber
              BF szOrderType -> szOrderType
              BF szOrderCompany -> szOrderCompany
              VA evt_OriginalShipQuantity -> mnOriginalShipQuantity
              BF mnEnteredShipQuantity <> mnEnteredShipQuantity
              VA evt_OriginalBackorderQuantity -> mnOriginalBackorderQuantity
              BF mnEnteredBackorderQuantity <> mnEnteredBackorderQuantity
              VA evt_OriginalCancelQuantity -> mnOriginalCancelQuantity
              VA evt_PO_BackCancelRemainQty -> cAutoBOCancel
              VA evt_IMBackFlag -> cIMBackAllowed
              VA evt_IBBackFlag -> cIBBackAllowed
              VA evt_SDAllowBackorders -> cSDBackAllowed
              VA evt_AllowPartialShipments -> cPartialShipFlag
              VA evt_PO_PreventOverShip -> cPreventOvership
              BF mnEnteredCancelQuantity <> mnEnteredCancelQuantity
              VA evt_OriginalOrderQuantity <> mnOrderQuantity
              VA evt_CommitQuantityDifference <> mnShipQuantityDifference
              VA evt_SHBackFlag <> cSHBackAllowed
              BF szBranchPlant -> szCostCenter
              VA evt_ConfiguredItemFlag -> cConfiguredItemFlag
              VA evt_OriginalSecondaryQuantity -> mnOriginalSecondaryQuantity
              BF mnUnitsSecondaryQtyOr <> mnEnteredSecondaryQuantity
              VA evt_CommitScndryQtyDifference <> mnSecondaryShipQtyDifference
              VA evt_DualPickingProcessOption -> cDualPickingProcessOption
              VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
              VA evt_ConvertedSecondaryQuantity <> mnConvertedSecondaryQuantity
              VA evt_ConvFactorTranstoSecondary -> mnConvFactorTranstoSecondary
              VA evt_OriginalOrderQtySecondary <> mnSecondaryOrderQuantity
              VA evt_DecimalsforRounding_SQOR -> mnDecimalsforRounding_SQOR
              VA evt_DecimalsforRounding_SOQS -> mnDecimalsforRounding_SOQS
              VA evt_CIBackAllowed_BACK -> cCIBackAllowed
              VA evt_ErrorMessageReturned <- szErrorMessageID
              VA evt_ConvFactorSecondarytoTrans -> mnConvFactorSecondarytoTrans
1300       IfVA evt_ErrorMessageReturnedis greater than<Blank>
1301          VA evt_EditsProcessedFlag = "0"
1302       End If
1303       // ===================================
1304       // PARTIAL SHIP EDIT.
1305       // ===================================
1306       // Replace existing variables with Dual UOM editing variables
1307       If VA evt_EditingShippedQuantity is greater than <Zero>
1308          If VA evt_PO_BackCancelRemainQty is not equal to "1"
              And VA evt_AllowPartialShipments is equal to "N"
              And VA evt_TextLineYN is not equal to "Y"
1309             If VA evt_EditforDualUOM is not equal to "1"
                 And VA evt_ShipQuantityDifference is greater than <Zero>
1310                Set NER Error("2802", BF mnEnteredShipQuantity)
1311                VA evt_EditsProcessedFlag = "0"
1312             Else
1313                If VA evt_EditforDualUOM is equal to "1"
                    And VA evt_SecondaryShipQtyDifference is greater than <Zero>
1314                   Set NER Error("2802", BF szUnitOfMeasureSecondary)
1315                   VA evt_EditsProcessedFlag = "0"
1316                End If
1317             End If
1318          End If
1319       End If
1320       // =================================
1321       // VALIDATE STATUS CODES
1322       // =================================
1323       VA evt_NextStatusTable = VA evt_NextStatus
1324       // Retain Last Status if greater than '900'
1325       VA evt_LastStatus_saved = VA evt_LastStatus
1326       //   Determine override status.
1327       If BF szTRAN_OverrideNextStatus is greater than <Blank>
1328          VA evt_NextStatusOverride = BF szTRAN_OverrideNextStatus
1329       Else
1330          If VA evt_PO_NextStatusConfirm is greater than <Blank>
1331             VA evt_NextStatusOverride = VA evt_PO_NextStatusConfirm
1332          End If
1333       End If
1334       //
1335       // ===========================================================
1336       // Demand Scheduling - Bypass Invoice
1337       // ===========================================================
1338       If VA evt_cDemandSchedulingReleased is equal to "1"
1339          If VA evt_cUseNextOrderStsPref_UNOP is equal to "1"
1340             //
1341             // If the Next Order Status has not been overridden then check to see if there
1342             // is an Advanced Preference for Next Status.
1343             //
1344             If VA evt_NextStatusOverride is equal to <Blank> Or VA evt_NextStatusOverride is equal to <Null>
1345                Transportation Get Next Status Adv Pref
                       UNDEFINED X szPreferenceSchedule
                       UNDEFINED X szAdvancedPreferenceType
                       BF szComputerID -> szComputerID
                       BF mnOrderNumber -> mnDocumentOrderInvoiceE
                       BF szOrderType -> szOrderType
                       BF szOrderCompany -> szCompanyKeyOrderNo
                       BF mnLineNumber -> mnLineNumber
                       VA evt_LineType -> szLineType
                       VA evt_SoldToTable -> mnSoldToAddressNumber
                       VA evt_ShipTo_F4211 -> mnShipToAddressNumber
                       VA evt_ParentAddressNumbF4211_PAS -> mnParentAddressNumber
                       BF mnEnteredShipQuantity -> mnUnitsQuantityShipped
                       BF szUnitOfMeasureAsInput -> szUnitOfMeasure
                       VA evt_NextStatus -> szStatusCodeLast
                       BF szBranchPlant -> szCostCenter
                       VA evt_TransactionDateF4211 -> jdTransactionDate
                       VA evt_PrimaryUoM -> szPrimaryUOM
                       VA evt_PricingUoM -> szPricingUOM
                       VA evt_ItemWeight -> mnItemWeight
                       VA evt_WeightUoM -> szWeightUOM
                       VA evt_DateReleaseTable_RSDJ -> jdDeliveryDate
                       VA evt_szItemGroup_PRGR -> szItemGroup
                       UNDEFINED X szSoldToCustomerGroup
                       VA evt_NextStatusOverride <- szStatusCodeNext
                       UNDEFINED X cSuppressErrorMessage
                       UNDEFINED X szErrorMessageID
                       VA evt_ItemNumber -> mnShortItemNumber
                       UNDEFINED X <UNKNOWN MEMBER>
                       UNDEFINED X <UNKNOWN MEMBER>
                       UNDEFINED X <UNKNOWN MEMBER>
                       UNDEFINED X <UNKNOWN MEMBER>
                       UNDEFINED X <UNKNOWN MEMBER>
                       UNDEFINED X <UNKNOWN MEMBER>
                       UNDEFINED X <UNKNOWN MEMBER>
                       UNDEFINED X <UNKNOWN MEMBER>
1346             End If
1347          End If
1348       End If
1349       // ===========================================================
1350       // End Demand Scheduling - Bypass Invoice
1351       // ===========================================================
1352       //
1353       // Change process to call validate with correct input fields.
1354       If VA evt_EditforDualUOM is equal to "1"
1355          Validate Status Codes
                 BF mnOrderNumber -> mnOrderNumber
                 BF szOrderType -> szOrderType
                 BF szOrderCompany -> szOrderCompany
                 BF szEnteredLineType -> szLineType
                 VA evt_NextStatus <> szNextStatus
                 BF mnUnitsSecondaryQtyOr -> mnEnteredShipQuantity
                 VA evt_OriginalSecondaryQuantity -> mnOriginalShipQuantity
                 BF mnEnteredBackorderQuantity -> mnEnteredBackorderQty
                 BF mnEnteredCancelQuantity -> mnEnteredCancelQuantity
                 VA evt_NextStatusOverride -> szConfirmedNextStatus
                 VA evt_PO_NextStatusBackOrder -> szBOCanNextStatus
                 VA evt_LastStatus <> szLastStatus
                 UNDEFINED X cInventoryInterface
                 VA evt_SecondaryShipQtyDifference -> mnShipQuantityDifference
                 VA evt_NextStatusSplit <- szNextStatusSplitLine
                 VA evt_OverShipConditionFlag -> cOverShipConditionFlag
                 VA evt_WriteLedgerFlag <- cFlagWriteLedgerRecrd
                 VA evt_OrderStatusValidateFlag <- cStatusCodeValidation01
1356       Else
1357          Validate Status Codes
                 BF mnOrderNumber -> mnOrderNumber
                 BF szOrderType -> szOrderType
                 BF szOrderCompany -> szOrderCompany
                 BF szEnteredLineType -> szLineType
                 VA evt_NextStatus <> szNextStatus
                 BF mnEnteredShipQuantity -> mnEnteredShipQuantity
                 VA evt_OriginalShipQuantity -> mnOriginalShipQuantity
                 BF mnEnteredBackorderQuantity -> mnEnteredBackorderQty
                 BF mnEnteredCancelQuantity -> mnEnteredCancelQuantity
                 VA evt_NextStatusOverride -> szConfirmedNextStatus
                 VA evt_PO_NextStatusBackOrder -> szBOCanNextStatus
                 VA evt_LastStatus <> szLastStatus
                 UNDEFINED X cInventoryInterface
                 VA evt_ShipQuantityDifference -> mnShipQuantityDifference
                 VA evt_NextStatusSplit <- szNextStatusSplitLine
                 VA evt_OverShipConditionFlag -> cOverShipConditionFlag
                 VA evt_WriteLedgerFlag <- cFlagWriteLedgerRecrd
                 VA evt_OrderStatusValidateFlag <- cStatusCodeValidation01
1358       End If
1359       // Check if the validation of next order status passed or failed.
1360       If VA evt_OrderStatusValidateFlag is equal to <Zero>
1361          VA evt_EditsProcessedFlag = "0"
1362          // Retain Last Status if greater than or equal to '900'
1363       Else
1364          IfVA evt_LastStatus_savedis greater than or equal to"900"
1365             VA evt_LastStatus = VA evt_LastStatus_saved
1366          End If
1367       End If
1368       // =====================================
1369       // VALIDATE SETTLED PREPAYMENT LINES
1370       // =====================================
1371       // If the prepayment is at a settled status, do not allow user to change
1372       // quantities
1373       //
1374       // Change calculation of NewShipQty_Org based upon pricing UOM if
1375       // Dual UOM is active and Backorder and Cancel Quantities not changed.
1376       //
1377       If VA evt_EditforDualUOM is equal to "1"
           And BF mnEnteredBackorderQuantity is equal to VA evt_OriginalBackorderQuantity
           And BF mnEnteredCancelQuantity is equal to VA evt_OriginalCancelQuantity
1378          Verify Dual Unit of Measure
                 "1" -> cRelatedToSecondaryUoM
                 VA evt_PricingUoM -> szUnitOfMeasureAsInput
                 BF szUnitOfMeasureSecondary -> szUnitOfMeasureSecondary
                 "1" -> cSuppressErrorMessage
                 VA evt_ErrorMessage <- szErrorMessageID
                 UNDEFINED X cErrorCode
1379          If VA evt_ErrorMessage is less than or equal to <Blank>
1380             // Adjust calculation to convert secondary ship variance from
1381             // secondary to transaction quantity.
1382             VA evt_mnNewShipQty_UORG = ([VA evt_OriginalSecondaryQuantity]+[BF mnMultiLocSecondaryQtyShipVar])*[VA evt_ConvFactorSecondarytoTrans]
1383          Else
1384             VA evt_mnNewShipQty_UORG = [VA evt_OriginalShipQuantity]+[BF mnMultiLocQtyShipVariance]
1385          End If
1386       Else
1387          VA evt_mnNewShipQty_UORG = [VA evt_OriginalShipQuantity]+[BF mnMultiLocQtyShipVariance]
1388       End If
1389       If VA evt_mnNewShipQty_UORG is not equal to VA evt_EditingShippedQuantity
           Or VA evt_OriginalBackorderQuantity is not equal to BF mnEnteredBackorderQuantity
           Or VA evt_OriginalCancelQuantity is not equal to BF mnEnteredCancelQuantity
1390          VA evt_Prepay_SequenceNumber_SEQ = "0"
1391          VA evt_Prepay_SuffixNumber_SFXO = "000"
1392          VA evt_Prepay_OriginationFlag_POF = "01"
1393          F004201.Fetch Single
                 BF mnOrderNumber =  TK Document (Order No, Invoice, etc.)
                 BF szOrderType =  TK Order Type
                 BF szOrderCompany =  TK Order Company (Order Number)
                 VA evt_Prepay_SuffixNumber_SFXO =  TK Order Suffix
                 BF mnLineNumber =  TK Line Number
                 VA evt_Prepay_SequenceNumber_SEQ =  TK Sequence Number
                 VA evt_Prepay_OriginationFlag_POF =  TK PrepaymentOriginationFlag
                 VA evt_Prepay_TransactStatus_ATS <- TK Prepayment Transaction Status
1394          If SV File_IO_Status is equal to CO SUCCESS
1395             If VA evt_Prepay_TransactStatus_ATS is equal to "05"
1396                If VA evt_EditingShippedQuantity is not equal to VA evt_mnNewShipQty_UORG
1397                   If VA evt_EditforDualUOM is equal to "1"
1398                      Set NER Error("141P", BF szUnitOfMeasureSecondary)
1399                   Else
1400                      Set NER Error("141P", BF mnEnteredShipQuantity)
1401                   End If
1402                Else
1403                   If BF mnEnteredBackorderQuantity is not equal to VA evt_OriginalBackorderQuantity
1404                      Set NER Error(141P, BF mnEnteredBackorderQuantity)
1405                   Else
1406                      If BF mnEnteredCancelQuantity is not equal to VA evt_OriginalCancelQuantity
1407                         Set NER Error(141P, BF mnEnteredCancelQuantity)
1408                      End If
1409                   End If
1410                End If
1411             End If
1412          End If
1413       End If
1414       //
1415       // If this is a parent of a multi-location split and it's being completely
1416       // backordered then we want to re-extend price and cost.  The reason that we
1417       // need to do this is because the extended price and cost will be retrieved
1418       // from the original F4211 line which is not based on the quantity backordered
1419       // on this line, they are based on the original ship quantity.  If we use
1420       // these incorrect extended price and cost values the order total will be
1421       // wrong.
1422       If BF cActionCode is equal to "P" And VA evt_EditingShippedQuantity is equal to <Zero> And BF mnEnteredBackorderQuantity is not equal to <Zero>
1423          VA evt_cExtendPCforNoShipQty_EV01 = "1"
1424       End If
1425       //
1426       // =====================================
1427       // PROCESS LINE FOR CONFIRMATION if NOT in PRE-EDIT MODE.
1428       // =====================================
1429       If BF cModeProcessing is not equal to "2"
           And VA evt_TextLineYN is not equal to "Y"
1430          If VA evt_EditsProcessedFlag is equal to "1"
1431             //
1432             // Do Not Extend Cost and Price when Entered Ship Quantity is Zero.
1433             //
1434             // Records with a related item number need unit cost, but don't extend cost
1435             // Replace existing variables with Dual UOM editing variables
1436             //
1437             // Extend Price and Cost if this is a multi-location parent and we are
1438             // backordering the whole line.
1439             //
1440             If VA evt_EditingShippedQuantity is not equal to <Zero> Or VA evt_cExtendPCforNoShipQty_EV01 is equal to "1"
1441                //
1442                // ===========================
1443                // Retrieve Currency Codes and Exchange Rates
1444                // ===========================
1445                //
1446                // Logic to Retrieve Currency Codes and Exchange Rates moved outside of Unit
1447                // Cost conditional statement.
1448                //
1449                // Perform this logic for any order where the b/p may be different, not only
1450                // when the Interbranch flag is turned on in some way.
1451                //
1452                // To be able to assign the system CurrencyProcess to the variable
1453                // This variable maybe overridden if there is a Triangulation and/or
1454                // GetExchangeRate function return the different CurrencyProcessing constant.
1455                //
1456                VA evt_CurrencyConvMethod_GetExch = SL CurrencyProcessing
1457                //
1458                // Use variable TranCostInterBPMode_SO01 to pass mode to the Calculate
1459                // Transfer Cost Function.  This is done because this code can now be executed
1460                // even when the Interbranch Order Flag is not populated.  Do a blind
1461                // assignment of the Interbranch flag to the new variable.  Once it goes
1462                // through the IF conditions and determines that the interbranch flag is not
1463                // populated, need to assign the new variable the value of  '1' so that basic
1464                // unit cost functionality is performed by Calculate Transfer Cost.
1465                //
1466                If VA evt_InterbranchOrderFlag is equal to "1,2,3,4"
1467                   VA evt_TranCostInterBPMode_SO01 = VA evt_InterbranchOrderFlag
1468                Else
1469                   VA evt_TranCostInterBPMode_SO01 = "1"
1470                End If
1471                // Use Price Effective Date to calculate cost for Selling Branch Plant
1472                If VA evt_TranCostInterBPMode_SO01 is equal to "1,2,3,4"
1473                   If VA evt_cPricingBasedOnDate_CP01 is equal to "4"
1474                      VA evt_jdPriceEffectiveDate_PEFJ = BF jdActualDeliveryDate
1475                   End If
1476                Else
1477                   VA evt_jdPriceEffectiveDate_PEFJ = VA evt_TransactionDateF4211
1478                End If
1479                //  Compare Detail Company (Shipping Co.)  to Key Company (Seller Co.)
1480                If VA evt_szCompany_Cache_CO is equal to BF szOriginal_CompanyKeyOrderNo
1481                   VA evt_RateMultiplier_String = "1"
1482                   VA evt_RateDivisor = 1
1483                   //   Get Currency Control for Selling Branch (To Currency Code)
1484                   // Fix currency processing for interbranch
1485                   IfSL CurrencyProcessingis not equal to"N"
1486                      F0010 Get Company Currency Code
                             BF szOrderCompany -> szCompany
                             VA evt_CurrencyCodeSellingBranch <- szCurrencyCode
                             UNDEFINED X cDetailedCurrencyRestatement
                             UNDEFINED X cPostByCurrency
1487                      VA evt_CurrencyCodeShipBranch = VA evt_CurrencyCodeSellingBranch
1488                   End If
1489                   //
1490                Else
1491                   //    Currency Exchange:
1492                   If SL CurrencyProcessing is not equal to "N"
1493                      //
1494                      //   Get Currency Control for Selling Branch (To Currency Code)
1495                      F0010 Get Company Currency Code
                             BF szOrderCompany -> szCompany
                             VA evt_CurrencyCodeSellingBranch <- szCurrencyCode
                             UNDEFINED X cDetailedCurrencyRestatement
                             UNDEFINED X cPostByCurrency
1496                      //
1497                      //   Get Currency Code for Shipping Branch  (From Currency Code)
1498                      F0010 Get Company Currency Code
                             VA evt_szCompany_Cache_CO -> szCompany
                             VA evt_CurrencyCodeShipBranch <- szCurrencyCode
1499                      //
1500                      //   Get Exchange Rate
1501                      // ****************
1502                      If VA evt_CurrencyCodeSellingBranch is not equal to VA evt_CurrencyCodeShipBranch
1503                         //
1504                         // InterbranchOrderFlag 4 = Base Price Intercompany
1505                         // InterbranchOrderFlag 3 = Base Price Interbranch
1506                         // InterbranchOrderFlag 2 = Unit Cost Intercompany
1507                         // InterbranchOrderFlag 1 = Unit Cost Intercompany
1508                         // InterbranchOrderFlag <> 1,2,3,4 = Unit Cost
1509                         // (Set Flag For Calc Tran Cost =1)
1510                         // Pass in ShipBranch & SellingBranch opposite on calls to Get Xch Rate
1511                         // based on the OrderFlag because in the B4200710, BasePrice(3,4) order
1512                         // will call B420070 to get the price correctly from appropriate places.
1513                         //
1514                         // For Base Price Order
1515                         //
1516                         If VA evt_InterbranchOrderFlag is equal to "3,4"
1517                            F0015 Get Exchange Rate
                                   VA evt_CurrencyCodeSellingBranch -> szCurrencyCodeFrom
                                   VA evt_CurrencyCodeShipBranch -> szCurrencyCodeTo
                                   VA evt_SoldToTable -> mnAddressNumber
                                   VA evt_jdPriceEffectiveDate_PEFJ -> jdTransactionDate
                                   VA evt_RateMultiplier <- mnCurrConvRateMult
                                   VA evt_RateDivisor <- mnCurrConvRateDiv
                                   VA evt_jdPriceEffectiveDate_PEFJ -> jdDateEffectiveRates
                                   VA evt_Triangulation1_FromCurr <- mnTriangulationRate1
                                   VA evt_Triangulation2_ToCurr <- mnTriangulationRate2
                                   VA evt_CurrencyConvMethod_GetExch <- cConversionMethod
1518                         Else
1519                            //
1520                            // For Unit Cost Order
1521                            //
1522                            F0015 Get Exchange Rate
                                   VA evt_CurrencyCodeShipBranch -> szCurrencyCodeFrom
                                   VA evt_CurrencyCodeSellingBranch -> szCurrencyCodeTo
                                   VA evt_SoldToTable -> mnAddressNumber
                                   VA evt_jdPriceEffectiveDate_PEFJ -> jdTransactionDate
                                   VA evt_RateMultiplier <- mnCurrConvRateMult
                                   VA evt_RateDivisor <- mnCurrConvRateDiv
                                   VA evt_jdPriceEffectiveDate_PEFJ -> jdDateEffectiveRates
                                   VA evt_Triangulation1_FromCurr <- mnTriangulationRate1
                                   VA evt_Triangulation2_ToCurr <- mnTriangulationRate2
                                   VA evt_CurrencyConvMethod_GetExch <- cConversionMethod
1523                         End If
1524                         Math Numeric to String, Convert
                                VA evt_RateMultiplier -> mnMathNumeric01
                                VA evt_RateMultiplier_String <- szVideoConstant30A
1525                      Else
1526                         VA evt_RateMultiplier_String = "1"
1527                         VA evt_RateDivisor = 1
1528                         // ****************
1529                      End If
1530                   End If
1531                End If
1532                //
1533                // ===========================
1534                //    RETRIEVE COST:
1535                //    Retrieve the most current cost from F4105.
1536                // ===========================
1537                If VA evt_InventoryInterface is equal to "Y"
                    And VA evt_CommitFlag is not equal to "K"
                    And VA evt_CostOverrideFlag is not equal to "1"
1538                   // Use Transportation Cost if passed in.
1539                   If BF mnTRAN_UnitCostOverride is not equal to <Zero>
1540                      VA evt_UnitCost = [BF mnTRAN_UnitCostOverride]
1541                      VA evt_RetrieveCostFlag = "Y"
1542                   Else
1543                      //  Retrieve latest cost.
1544                      Shipment Confirmation Get Item Cost
                             VA evt_ItemNumber -> mnItemNumberShort
                             BF szBranchPlant -> szBranchPlant
                             VA evt_LocationCache -> szInventoryLocation
                             BF szLot -> szInventoryLot
                             VA evt_CostLevel -> cCostLevel
                             VA evt_UnitCost <- mnUnitCost
                             "1" -> cSuppressErrorMessage
                             VA evt_ErrorCode <- cErrorCode
1545                      If VA evt_ErrorCode is not equal to "1"
1546                         //
1547                         // Assign cost of detail branch to Transfer Cost
1548                         //
1549                         VA evt_TransferUnitCost = VA evt_UnitCost
1550                         VA evt_RetrieveCostFlag = "Y"
1551                      End If
1552                      // ===========================
1553                      //  TRANSFER UNIT COST
1554                      // ===========================
1555                      //
1556                      // Logic to Retrieve Currency Codes and Exchange Rates moved outside of Unit
1557                      // Cost conditional statement.
1558                      //
1559                      //   SAR# 7495931 - Insert condition to bypass transfer order cost calculation
1560                      //   for configured items.
1561                      //
1562                      If VA evt_StockingType_F4102 is equal to "C"
1563                         //
1564                         //   To prevent the unit cost from getting overridden during End Doc
1565                         //   reset the variable to the current value in the table, which should
1566                         //   contain the value calculated by configurator during order entry.
1567                         //
1568                         VA evt_UnitCost = VA evt_UnitCostTable_UNCS
1569                      Else
1570                         Transfer Cost, Calculate for Sales Order
                                VA evt_TranCostInterBPMode_SO01 -> cInterbranchSales
                                <Blank> -> cStockingType
                                VA evt_InventoryInterface -> cInventoryInterface
                                BF szBranchPlant -> szFromBranch
                                VA evt_ItemNumber -> mnItemNumber
                                VA evt_CatagorySalesCode1 -> szCategoryCode1
                                VA evt_jdPriceEffectiveDate_PEFJ -> jdEffectiveDate
                                VA evt_CurrencyConvMethod_GetExch -> cCurrencyControl
                                VA evt_RateMultiplier_String -> szXchgRateMultiplier
                                VA evt_RateDivisor -> mnXchgRateDivisor
                                VA evt_UnitCost <> mnUnitCost
                                VA evt_BranchPlant_F4201 -> szToBranch
                                VA evt_Triangulation1_FromCurr -> mnTriangulationRate1
                                VA evt_Triangulation2_ToCurr -> mnTriangulationRate2
                                VA evt_CurrencyCodeShipBranch -> szFromBranchCurrencyCode
                                BF szUnitOfMeasureAsInput -> szUnitOfMeasureAsInput
                                VA evt_PrimaryUoM -> szUnitOfMeasurePrimary
                                VA evt_ItemMasterPriceLevel_PLEV -> cPriceLevel
                                VA evt_CurrencyCodeSellingBranch -> szToBranchCurrencyCode
                                VA evt_PricingUoM -> szUnitOfMeasurePricing
                                BF szLot -> szLot
                                VA evt_szFileFormatLocation_LOCN -> szLocation
1571                      End If
1572                   End If
1573                End If
1574                // =========================
1575                //    RE-EXTEND COST
1576                // =========================
1577                If VA evt_ShipQuantityDifference is not equal to <Zero>
                    Or BF cActionCode is equal to "P"
                    Or BF cActionCode is equal to "S"
                    Or VA evt_RetrieveCostFlag is equal to "Y"
1578                   //
1579                   //     The Flag show whether Foreign Cost should be extended or not
1580                   //
1581                   VA evt_cForeignCostFlag_EV01 = "0"
1582                   //
1583                   If VA evt_ForeignUnitCost is not equal to <Zero>
1584                      VA evt_cForeignCostFlag_EV01 = "1"
1585                   Else
1586                      If VA evt_ForeignUnitCost is equal to <Zero>
                          And VA evt_CurrencyConversionRate is not equal to <Zero>
1587                         VA evt_cForeignCostFlag_EV01 = "1"
1588                      End If
1589                   End If
1590                   If VA evt_cForeignCostFlag_EV01 is equal to "1"
1591                      //
1592                      VA evt_ForeignUnitCost = 0
1593                      //  Get Selling Company Currency Code if it has not already been retrieved for
1594                      //   Interbranch Order processing.
1595                      If VA evt_InterbranchOrderFlag is not equal to "1"
                          And VA evt_InterbranchOrderFlag is not equal to "2"
                          And VA evt_InterbranchOrderFlag is not equal to "3"
                          And VA evt_InterbranchOrderFlag is not equal to "4"
1596                         F0010 Get Company Currency Code
                                BF szOrderCompany -> szCompany
                                VA evt_CurrencyCodeSellingBranch <- szCurrencyCode
                                UNDEFINED X cDetailedCurrencyRestatement
                                UNDEFINED X cPostByCurrency
1597                      End If
1598                      // Get Exchange Rate:  (From) Customer,   (To) SellingBranch
1599                      //
1600                      //   If Currency Rate was entered in SOE use that rate otherwise use the rate
1601                      //   from the F0015
1602                      //
1603                      If VA evt_CurrencyConversionRate is not equal to <Zero>
1604                         VA evt_Triangulation1_FromCurr = "0"
1605                         VA evt_Triangulation2_ToCurr = "0"
1606                         F0015 Get Exchange Rate
                                VA evt_CurrencyCode -> szCurrencyCodeFrom
                                VA evt_CurrencyCodeSellingBranch -> szCurrencyCodeTo
                                VA evt_jdPriceEffectiveDate_PEFJ -> jdTransactionDate
                                VA evt_jdPriceEffectiveDate_PEFJ -> jdDateEffectiveRates
                                VA evt_CurrencyConvMethod_GetExch <- cConversionMethod
1607                      Else
1608                         F0015 Get Exchange Rate
                                VA evt_CurrencyCode -> szCurrencyCodeFrom
                                VA evt_CurrencyCodeSellingBranch -> szCurrencyCodeTo
                                VA evt_jdPriceEffectiveDate_PEFJ -> jdTransactionDate
                                VA evt_jdPriceEffectiveDate_PEFJ -> jdDateEffectiveRates
                                VA evt_Triangulation1_FromCurr <- mnTriangulationRate1
                                VA evt_Triangulation2_ToCurr <- mnTriangulationRate2
                                VA evt_CurrencyConvMethod_GetExch <- cConversionMethod
1609                      End If
1610                      //
1611                      // Only call the currency conversion if the Domestic Unit Cost not = zero
1612                      //
1613                      If VA evt_UnitCost is not equal to <Zero>
1614                         Currency Conversion, Calculate
                                VA evt_CurrencyConversionRate -> mnCurrencyConverRate
                                VA evt_UnitCost -> mnDomesticAmount
                                VA evt_ForeignUnitCost <> mnForeignAmount
                                VA evt_Triangulation1_FromCurr -> mnTriangulationRate1
                                VA evt_Triangulation2_ToCurr -> mnTriangulationRate2
                                VA evt_CurrencyConvMethod_GetExch -> cCurrencyConversionMethod
                                VA evt_jdPriceEffectiveDate_PEFJ -> jdTransactionDate
1615                      End If
1616                      //
1617                      // FOREIGN EXTENSION OF COST
1618                      // Calculate bulk extended cost using Standard Qty rather than Ship Qty.
1619                      // Don't re-extend cost for records with a related item number
1620                      // If it does have one, zero out the extended cost.
1621                      // Modify edit to recognize and allow processing for Configured
1622                      // item components using Relate Kit Component
1623                      IfVA evt_RelatedItemNumberis less than or equal to<Blank>OrVA evt_RelatedKitComponentis greater than<Zero>
1624                         If VA evt_F4101_BulkPackFlag is equal to "B"
                             And VA evt_BulkUseManagementFlag is equal to "1"
1625                            Orders, Calculate Unit or Extended Amount
                                   VA evt_BULK_PrimaryQty_STUM -> mnQuantityTransactionUM
                                   "1.0000000" -> mnConvFctrFromTrnToPrimary
                                   UNDEFINED X mnQuantityInPrimaryUOM
                                   VA evt_ForeignUnitCost -> mnUnitPricePricingUM
                                   "1" -> mnConvFctrFromPricingToPrimary
                                   UNDEFINED X mnUnitPricePrimaryUM
                                   VA evt_ForeignExtendedCost <- mnExtendedAmountPrimaryUM
                                   "2" -> cModeOfProcessing
                                   "1" -> cSuppressError01
                                   UNDEFINED X cErrorCode01
                                   UNDEFINED X szErrorMessageCode
1626                         Else
1627                            Orders, Calculate Unit or Extended Amount
                                   BF mnEnteredShipQuantity -> mnQuantityTransactionUM
                                   VA evt_ConversionFactor -> mnConvFctrFromTrnToPrimary
                                   UNDEFINED X mnQuantityInPrimaryUOM
                                   VA evt_ForeignUnitCost -> mnUnitPricePricingUM
                                   "1" -> mnConvFctrFromPricingToPrimary
                                   UNDEFINED X mnUnitPricePrimaryUM
                                   VA evt_ForeignExtendedCost <- mnExtendedAmountPrimaryUM
                                   "2" -> cModeOfProcessing
                                   "1" -> cSuppressError01
                                   UNDEFINED X cErrorCode01
                                   UNDEFINED X szErrorMessageCode
1628                         End If
1629                      Else
1630                         VA evt_ForeignExtendedCost = "0"
1631                      End If
1632                   End If
1633                   //
1634                   // DOMESTIC EXTENSION OF COST
1635                   // Don't re-extend cost for records with a related item number
1636                   // If it does have one, zero out the extended cost.
1637                   //
1638                   // Modify edit to recognize and allow processing for Configured
1639                   // item components using Relate Kit Component
1640                   IfVA evt_RelatedItemNumberis less than or equal to<Blank>OrVA evt_RelatedKitComponentis greater than<Zero>
1641                      If VA evt_F4101_BulkPackFlag is equal to "B"
                          And VA evt_BulkUseManagementFlag is equal to "1"
1642                         Orders, Calculate Unit or Extended Amount
                                VA evt_BULK_PrimaryQty_STUM -> mnQuantityTransactionUM
                                "1.0000000" -> mnConvFctrFromTrnToPrimary
                                UNDEFINED X mnQuantityInPrimaryUOM
                                VA evt_UnitCost -> mnUnitPricePricingUM
                                "1" -> mnConvFctrFromPricingToPrimary
                                UNDEFINED X mnUnitPricePrimaryUM
                                VA evt_ExtendedCost <- mnExtendedAmountPrimaryUM
                                "2" -> cModeOfProcessing
                                "1" -> cSuppressError01
                                UNDEFINED X cErrorCode01
                                UNDEFINED X szErrorMessageCode
1643                      Else
1644                         Orders, Calculate Unit or Extended Amount
                                BF mnEnteredShipQuantity -> mnQuantityTransactionUM
                                VA evt_ConversionFactor -> mnConvFctrFromTrnToPrimary
                                UNDEFINED X mnQuantityInPrimaryUOM
                                VA evt_UnitCost -> mnUnitPricePricingUM
                                "1" -> mnConvFctrFromPricingToPrimary
                                UNDEFINED X mnUnitPricePrimaryUM
                                VA evt_ExtendedCost <- mnExtendedAmountPrimaryUM
                                "2" -> cModeOfProcessing
                                "1" -> cSuppressError01
                                UNDEFINED X cErrorCode01
                                UNDEFINED X szErrorMessageCode
1645                      End If
1646                   Else
1647                      VA evt_ExtendedCost = "0"
1648                   End If
1649                End If
1650                //
1651                //    RE-EXTEND PRICE
1652                // Don't re-extend records with a related item number
1653                // If it does have one, zero out the extended price.
1654                // Modify edit to recognize and allow processing for Configured
1655                // item components using Relate Kit Component
1656                IfVA evt_RelatedItemNumberis less than or equal to<Blank>OrVA evt_RelatedKitComponentis greater than<Zero>
1657                   If VA evt_F4101_BulkPackFlag is equal to "B"
                       And VA evt_BulkUseManagementFlag is equal to "1"
1658                      //  Extend Price for Bulk Products.
1659                      //
1660                      // Foreign Extended Price for Bulk
1661                      //
1662                      If VA evt_ForeignUnitPrice is not equal to  <Zero>
1663                         Calculate Extended Price for Bulk Orders
                                VA evt_PriceAmbientStandardF49211 -> cPriceatAmbiantorStandard
                                BF mnBULK_StandardQtyEntered -> mnStockTotalVolume
                                BF szBULK_StandardQtyEnteredUOM -> szUnitofMeasure4
                                BF mnBULK_AmbientQtyEntered -> mnAmbientResult
                                BF szBULK_AmbientQtyEnteredUOM -> szUnitofMeasure3
                                BF mnBULK_WeightQtyEntered -> mnWeightResult
                                BF szBULK_WeightQtyEnteredUOM -> szUnitofMeasure5
                                VA evt_ForeignUnitPrice -> mnAmtPricePerUnit2
                                VA evt_PricingUoM -> szUnitOfMeasurePricing
                                VA evt_ForeignExtendedAmount <- mnAmountExtendedPrice
1664                      End If
1665                      //
1666                      // Domestic Extended Price for Bulk
1667                      //
1668                      Calculate Extended Price for Bulk Orders
                             VA evt_PriceAmbientStandardF49211 -> cPriceatAmbiantorStandard
                             BF mnBULK_StandardQtyEntered -> mnStockTotalVolume
                             BF szBULK_StandardQtyEnteredUOM -> szUnitofMeasure4
                             BF mnBULK_AmbientQtyEntered -> mnAmbientResult
                             BF szBULK_AmbientQtyEnteredUOM -> szUnitofMeasure3
                             BF mnBULK_WeightQtyEntered -> mnWeightResult
                             BF szBULK_WeightQtyEnteredUOM -> szUnitofMeasure5
                             VA evt_UnitPrice -> mnAmtPricePerUnit2
                             VA evt_PricingUoM -> szUnitOfMeasurePricing
                             VA evt_ExtendedAmount <- mnAmountExtendedPrice
1669                   Else
1670                      // Add logic to extend price for Dual UOM Items, not including
1671                      // bulk items for this modification.
1672                      //
1673                      // Extend Price for Non-Bulk Products.
1674                      // Change edit to list values of "1,2"
1675                      If VA evt_DualUnitOfMeasureItem is equal to "1,2"
1676                         VA evt_CalculateForeignExtendedPr = " "
1677                         // Set qty used for Dual UOM price extension edits
1678                         If VA evt_SecondaryQtyPriceDiff_SQOR is not equal to <Zero> And BF mnUnitsSecondaryQtyOr is not equal to <Zero> Or BF cActionCode is equal to "S" Or BF cActionCode is equal to "P" Or VA evt_OverShipConditionFlag is equal to "1"
1679                            //
1680                            VA evt_Dual_ExtendPriceYesOrNo = "1"
1681                            If VA evt_ForeignUnitPrice is not equal to  <Zero>
1682                               VA evt_CalculateForeignExtendedPr = "1"
1683                            End If
1684                            //
1685                         Else
1686                            If VA evt_ShipQuantityDifference is not equal to <Zero> And BF mnEnteredShipQuantity is not equal to <Zero>
1687                               VA evt_Dual_ExtendPriceYesOrNo = "1"
1688                               If VA evt_ForeignUnitPrice is not equal to <Zero>
1689                                  VA evt_CalculateForeignExtendedPr = "1"
1690                               End If
1691                            End If
1692                         End If
1693                         If VA evt_Dual_ExtendPriceYesOrNo is equal to "1"
1694                            Dual Unit of Measure Extended Price
                                   <Blank> -> cSuppressErrorMessage
                                   UNDEFINED X szErrorMessageID
                                   BF szBranchPlant -> szBranchPlant
                                   VA evt_ItemNumber -> mnIdentifierShortItem
                                   BF szUnitOfMeasureSecondary -> szUnitOfMeasureSecondary
                                   VA evt_PricingUoM -> szUnitOfMeasurePricing
                                   "1" -> cCalculateExtendedPrice
                                   VA evt_UnitPrice -> mnAmountUnitPrice
                                   VA evt_CalculateForeignExtendedPr -> cCalculateExtendedPriceForeign
                                   VA evt_ForeignUnitPrice -> mnAmountUnitPriceForeign
                                   BF mnEnteredShipQuantity -> mnQuantityTransaction
                                   BF szUnitOfMeasureAsInput -> szUnitOfMeasureAsInput
                                   BF mnUnitsSecondaryQtyOr -> mnQuantitySecondary
                                   BF szUnitOfMeasureSecondary -> szUnitOfMeasureSecondAsInput
                                   VA evt_ExtendedAmount <- mnAmountExtendedPrice
                                   VA evt_ForeignExtendedAmount <- mnAmountForeignExtPrice
1695                         End If
1696                      Else
1697                         If VA evt_ShipQuantityDifference is not equal to <Zero> And BF mnEnteredShipQuantity is not equal to <Zero> Or BF cActionCode is equal to "S" Or BF cActionCode is equal to "P" Or VA evt_OverShipConditionFlag is equal to "1"
1698                            If VA evt_ForeignUnitPrice is not equal to  <Zero>
1699                               Orders, Calculate Unit or Extended Amount
                                      BF mnEnteredShipQuantity -> mnQuantityTransactionUM
                                      VA evt_ConversionFactor -> mnConvFctrFromTrnToPrimary
                                      UNDEFINED X mnQuantityInPrimaryUOM
                                      VA evt_ForeignUnitPrice -> mnUnitPricePricingUM
                                      VA evt_ConvFactPricToPrim -> mnConvFctrFromPricingToPrimary
                                      UNDEFINED X mnUnitPricePrimaryUM
                                      VA evt_ForeignExtendedAmount <- mnExtendedAmountPrimaryUM
                                      "2" -> cModeOfProcessing
                                      "1" -> cSuppressError01
                                      UNDEFINED X cErrorCode01
                                      UNDEFINED X szErrorMessageCode
1700                            End If
1701                            Orders, Calculate Unit or Extended Amount
                                   BF mnEnteredShipQuantity -> mnQuantityTransactionUM
                                   VA evt_ConversionFactor -> mnConvFctrFromTrnToPrimary
                                   UNDEFINED X mnQuantityInPrimaryUOM
                                   VA evt_UnitPrice -> mnUnitPricePricingUM
                                   VA evt_ConvFactPricToPrim -> mnConvFctrFromPricingToPrimary
                                   UNDEFINED X mnUnitPricePrimaryUM
                                   VA evt_ExtendedAmount <- mnExtendedAmountPrimaryUM
                                   "2" -> cModeOfProcessing
                                   "1" -> cSuppressError01
                                   UNDEFINED X cErrorCode01
                                   UNDEFINED X szErrorMessageCode
1702                         End If
1703                      End If
1704                      If SL CurrencyProcessing is not equal to "N"
1705                         If VA evt_CurrencyCodeSellingBranch is less than or equal to <Blank>
                             And VA evt_BaseCurrenyCode_Agreement is less than or equal to <Blank>
1706                            F0010 Get Company Currency Code
                                   BF szOrderCompany -> szCompany
                                   VA evt_CurrencyCodeSellingBranch <- szCurrencyCode
                                   UNDEFINED X cDetailedCurrencyRestatement
                                   UNDEFINED X cPostByCurrency
1707                         Else
1708                            If VA evt_CurrencyCodeSellingBranch is less than or equal to <Blank>
1709                               VA evt_CurrencyCodeSellingBranch = VA evt_BaseCurrenyCode_Agreement
1710                            End If
1711                         End If
1712                         F0013 Get Currency Decimals
                                VA evt_CurrencyCodeSellingBranch -> szCurrencyCode
                                VA evt_cNumRoundDecAEXP_CDEC <- cDataDisplayDecimals
1713                         VA evt_ExtendedAmount = round([VA evt_ExtendedAmount],[VA evt_cNumRoundDecAEXP_CDEC])
1714                      End If
1715                   End If
1716                Else
1717                   VA evt_ExtendedAmount = "0"
1718                   VA evt_ForeignExtendedAmount = "0"
1719                End If
1720                //
1721             Else
1722                // If a line being processed has a zero quantity and it is an order level price
1723                // adjustment line (SO08 = 1) & Ship Qty is Zero, do not zero out the extended
1724                // amounts.  The ship Qty = Zero is for Kit and Confiured Items which run throug
1725                // this part of the code since their KTLN, RITM & etc are not <blank>.
1726                //
1727                // Replace existing variables with Dual UOM editing variables
1728                If VA evt_PriceAdjustLineFlag_SO08 is not equal to "1"
                    And VA evt_EditingShippedQuantity is equal to <Zero>
1729                   // Ship Quantity is Zero.
1730                   //
1731                   // If this is a backorder only line we want the extended amount to be included
1732                   // in the order total calculation.  If this isnt a backorder only line, then
1733                   // zero out the price amounts.
1734                   If BF mnEnteredBackorderQuantity is equal to <Zero>
1735                      VA evt_ExtendedAmount = 0
1736                      VA evt_ForeignExtendedAmount = 0
1737                      VA evt_ExtendedCost = 0
1738                      VA evt_ForeignExtendedCost = 0
1739                   End If
1740                End If
1741             End If
1742             //
1743             //    Update the last and/or next status if the ship quantity is zero
1744             //
1745             // If it is a non inventory line, we do not want to cancel the line even if the
1746             // ship qty is a zero.
1747             //
1748             // Replace existing variables with Dual UOM editing variables
1749             If VA evt_EditingShippedQuantity is equal to <Zero>
1750                If BF mnEnteredBackorderQuantity is equal to <Zero>
1751                   If VA evt_InventoryInterface is not equal to "N"
                       Or BF mnEnteredCancelQuantity is not equal to <Zero>
1752                      VA evt_LastStatus = "984"
1753                      VA evt_NextStatus = "999"
1754                      VA evt_ExtendedAmount = "0"
1755                      VA evt_ExtendedCost = "0"
1756                      VA evt_ForeignExtendedAmount = "0"
1757                      VA evt_ForeignExtendedCost = "0"
1758                   End If
1759                Else
1760                   VA evt_LastStatus = "904"
1761                   If VA evt_PO_NextStatusBackOrder is not equal to <Blank>
1762                      VA evt_NextStatus = VA evt_PO_NextStatusBackOrder
1763                   Else
1764                      VA evt_NextStatus = VA evt_NextStatusTable
1765                   End If
1766                End If
1767             Else
1768                // Don't hard commit the line if it's a non-stock line.
1769                If VA evt_CommitFlag is equal to "S" And VA evt_InventoryInterface is not equal to "N"
1770                   VA evt_CommitFlag = "H"
1771                End If
1772             End If
1773             //
1774             // ***************************************************
1775             // CALL KIT PROCESSING TO BALANCE THE KIT ORDER BASED ON
1776             // THE AVAILABILITY OF THE KIT COMPONENTS.
1777             // ***************************************************
1778             If VA evt_PO_DisplayKitItems is not equal to "1"
                 And VA evt_CommitFlag is equal to "K"
                 And VA evt_StockingType_F4102 is not equal to "C"
1779                // Kit Order
1780                Kit Processing for Shipment Confirmation
                       BF mnJobnumberA -> mnJobnumber
                       BF mnOrderNumber -> mnDocumentOrderNumber
                       BF szOrderType -> szOrderType
                       BF szOrderCompany -> szCompanyKeyOrderNo
                       BF mnLineNumber -> mnLineNumberOfKitParent
                       VA evt_SDAllowBackorders -> cBackordersAllowedYN
                       VA evt_AllowPartialShipments -> cPartialShipmntsAllow
                       VA evt_CheckAvailabilityFlag -> cCheckAvailabilityYN
                       VA evt_PO_PreventNegOnHand -> cPO_PreventNegativeOnHand
                       VA evt_PO_ErrorLocationOnHold -> cPO_ErrorOnHeldLocations
                       BF mnEnteredShipQuantity -> mnQuantityShippedParent
                       BF mnEnteredBackorderQuantity -> mnQuantityBackorderedParent
                       BF mnEnteredCancelQuantity -> mnQuantityCanceledParent
                       VA evt_GENLNG_CursorB4200810 <> idShipConfirmCacheCursor
                       BF cModeProcessing -> cModeProcessing
                       VA evt_ErrorMessageKits <- szErrorMessageID
                       <Blank> -> cSuppressErrorMessage
                       VA evt_ItemNumber -> mnParentItemNumber
                       BF szBranchPlant -> szBranchPlant
                       BF szUnitOfMeasureAsInput -> szUnitOfMeasureAsInput
                       VA evt_OriginalOrderQuantity <> mnQuantityOrderedParent
                       BF szComputerID -> szComputerID
                       BF cActionCode -> cActionCode
                       BF szVersion -> szVersion
                       BF cUpdateWrite -> cUpdateWrite
                       VA evt_Save_RecordWritten -> cRecordWritten
                       BF cWriteIfWarning -> cWriteifWarning
                       VA evt_SDAllowBackorders -> cSDAllowBackorder
                       VA evt_IBBackFlag -> cIBBackorderFlag
                       VA evt_IMBackFlag -> cIMBackorderFlag
                       BF jdActualDeliveryDate -> jdActualDeliveryDate
                       VA evt_PO_OverrideRelieveOnHand -> cPO_OverrideRelieveOnHand
                       BF mnTRAN_ShipmentNumber -> mnTran_ShipmentNumber
                       BF jdTRAN_DeliveryDate -> jdTran_DeliveryDate
                       BF cTRAN_InventoryAffectFlag -> cTran_InventoryAffectFlag
                       BF mnTRAN_OverrideInventoryDocNum -> mnTran_OverrideInventoryDONUM
                       BF szTRAN_OverrideNextStatus -> szTran_OverrideNextStatus
                       BF cTRAN_OverrideLeaveShippable -> cTran_OverrideLeaveShippable
                       BF szTRAN_PrimaryVehicleId -> szTrans_PrimaryVehicleId
                       BF szTRAN_RegistrationLicenseNum -> szTran_RegistrationLicenseNum
                       BF mnTRAN_UnitCostOverride -> mnTran_UnitCostOverride
                       BF szTRAN_DocumentCompany -> szTran_DocumentCompany
                       BF jdTRAN_LoadConfirmDate -> jdTran_LoadConfirmDate
                       BF mnTRAN_TimeLoad -> mnjdTran_TimeLoad
                       BF szTRAN_OverrideDocumentType -> szTran_OverrideDocumentType
                       BF mnCarrier -> mnCarrier
                       VA evt_PO_LotGroupName_LOTGRP -> szLotGroup
1781                If VA evt_ErrorMessageKits is greater than <Blank>
1782                   VA evt_EditsProcessedFlag = "0"
1783                End If
1784             Else
1785                // ***************************************************
1786                // CALL F4211 EDIT  WORK ORDER COMPONENTS TO
1787                // TO PROCESS THE RELATED TEXT LINES
1788                // ***************************************************
1789                If VA evt_CommitFlag is equal to "K"
                    Or VA evt_CommitFlag is equal to "H"
1790                   If VA evt_GenerateWOFlag is equal to "Y"
                       And VA evt_StockingType_F4102 is equal to "C"
1791                      F4211 Edit Work Order Components
                             BF mnJobnumberA -> mnJobnumber
                             BF szComputerID -> szComputerID
                             BF mnOrderNumber -> mnDocumentOrderInvoiceE
                             BF szOrderType -> szOrderType
                             BF szOrderCompany -> szCompanyKey
                             BF mnLineNumber -> mnLineNumber
                             BF cActionCode -> cActionCode
                             <Blank> -> cSuppressErrorMessage
                             VA evt_ErrorMessageKits <- szErrorMessageID
                             BF cModeProcessing -> cModeProcessing
                             VA evt_NextStatusOverride -> szShipConfirmNextStatus
                             VA evt_OriginalShipQuantity -> mnOriginalQuantityShipped
                             BF mnEnteredShipQuantity -> mnEnteredQuantityShipped
1792                      If VA evt_ErrorMessageKits is greater than <Blank>
1793                         VA evt_EditsProcessedFlag = "0"
1794                      End If
1795                   End If
1796                End If
1797             End If
1798             //
1799             // **************************************************************
1800             // RELIEVE ON HAND  or  INSERT ADDITIONAL LINE ITEM
1801             // **************************************************************
1802             // Change to also acknowledge Direct Ships w/ Agreements
1803             IfVA evt_TransferDirectShipIntercois equal to"2"
1804                IfBF szContractNumberDistributiis greater than<Blank>OrVA evt_Sales_AgreementNum_DMCTis greater than<Blank>
1805                   VA evt_DirectShipAgreementExists = "1"
1806                End If
1807             End If
1808             //
1809             // Run if Direct Shipment Agreement exists regardless of Inventory
1810             // Interface flag's value
1811             IfVA evt_InventoryInterfaceis equal to"Y"OrVA evt_DirectShipAgreementExistsis equal to"1"
1812                //
1813                If BF cTRAN_InventoryAffectFlag is not equal to "3"
1814                   //
1815                   // If PO Override Relief of Inventory is on
1816                   //    Turn off Relieve OH flag
1817                   // Else
1818                   //     Determine whether inventory will be relieved.
1819                   If VA evt_PO_OverrideRelieveOnHand is equal to "1"
1820                      VA evt_UpdateOnHandFlag = "0"
1821                   Else
1822                      // GET UDC 40/IU - INVENTORY RELIEF AT SHIP CONFIRM
1823                      Get UDC
                             UNDEFINED X szDataDictionaryItem
                             "40" -> szSystemCode
                             "IU" -> szRecordTypeCode
                             BF szOrderType -> szUserDefinedCode
                             "2.00" -> mnKeyFieldLength
                             UNDEFINED X szLanguagePreference
                             UNDEFINED X szDescription001
                             UNDEFINED X szDescription002
                             UNDEFINED X szSpecialHandlingCode
                             UNDEFINED X cUdcOwnershipFlag
                             UNDEFINED X cHardCodedYn
                             "1" -> cSuppressErrorMessage
                             VA evt_ErrorMessage <- szErrorMessageId
                             UNDEFINED X cUDCOne
1824                      //
1825                      // Process both types of agreements for a single record or do not update the SO0
1826                      // so that Sales Update will process both types of agreements for a record.
1827                      //
1828                      If VA evt_ErrorMessage is equal to <Blank>
                          Or BF cTRAN_InventoryAffectFlag is equal to "2"
1829                         VA evt_UpdateOnHandFlag = "1"
1830                      Else
1831                         If VA evt_ForeignBPInventoryRelief is equal to "1"
                             And VA evt_AgreementsFound is equal to "1"
1832                            VA evt_UpdateOnHandFlag = "1"
1833                         Else
1834                            // Change to acknowledge Direct Ships w/ Agreements
1835                            IfVA evt_DirectShipAgreementExistsis equal to"1"
1836                               VA evt_UpdateOnHandFlag = "1"
1837                            Else
1838                               VA evt_UpdateOnHandFlag = "0"
1839                            End If
1840                         End If
1841                      End If
1842                   End If
1843                   //
1844                   // ***************************************************************************
1845                   // IN-TRANSIT ACCOUNTING ENHANCEMENT
1846                   // SAR 7445361
1847                   // ***************************************************************************
1848                   // Execute in-transit accounting if following conditions are true
1849                   // 1. Not an in-transit load. This includes non-load based ship confirm
1850                   // 2. Transfer Order (ST/OT)
1851                   // 3. The In-transit Accounting processing option is ON
1852                   // ***************************************************************************
1853                   If BF cTRAN_InventoryAffectFlag is less than "2" And VA evt_TransferDirectShipInterco is equal to "1" And VA evt_PO_Intransit_Accounting is equal to "1"
1854                      Intransit Accounting Cache Init
                             BF mnJobnumberA -> mnJobNumber
                             BF szComputerID -> szComputerID
1855                      Intransit Accounting Cache
                             BF mnJobnumberA -> mnJobNumber
                             BF szComputerID -> szComputerID
                             "R" -> cActionCode
                             VA evt_P4312_F4312ErrorID <- szErrorID
                             VA evt_P4312_POJobNumber <- mnPOJobNumber
                             VA evt_P4312_InvJobNumber <- mnInvJobNumber
                             VA evt_P4312_GLJobNumber <- mnGLJobNumber
                             VA evt_P4312_LCJobNumber <- mnLCJobNumber
                             VA evt_P4312_LCGLJobNumber <- mnLCGLJobNumber
                             VA evt_P4312_F4311JobNumber <- mnF4311JobNumber
                             VA evt_P4312_TMSJobNumber <- mnTMSJobNumber
                             VA evt_P4312_BatchNumber <- mnBatchNumber
                             VA evt_P4312_BatchType <- szBatchType
                             VA evt_P4312_BatchStatus <- cBatchStatus
                             VA evt_P4312_ProgramStatus <- cProgramStatus
                             VA evt_P4312_GLDate <- jdGLDate
                             VA evt_P4312_ReceiptDate <- jdReceiptDate
                             VA evt_P4312_LastJELine <- mnLastJELine
                             VA evt_P4312_OrderHoldCode <- szOrderHoldCode
                             VA evt_P4312_CurrencyProcessing <- cCurrencyProcessing
                             VA evt_P4312_CurrencyMode <- cCurrencyMode
                             VA evt_P4312_CurrencyCodeFrom <- szCurrencyCodeFrom
                             VA evt_P4312_ExchangeRate <- mnExchangeRate
                             VA evt_P4312_Supplier <- mnSupplier
1856                      // ***************************************************************************
1857                      // Continue if no error was issued from previous run
1858                      // ***************************************************************************
1859                      If VA evt_P4312_F4312ErrorID is equal to or empty <Blank>
1860                         Convert String to Math Numeric
                                VA evt_P4312_RelatedPoNumber -> szInputString
                                VA evt_P4312_OrderNumber <- mnOutputMathNumeric
1861                         VA evt_P4312_OrderSuffix = VA evt_OrderSuffix
1862                         // ***************************************************************************
1863                         // Run PO Receipt Begin Doc if it is first time
1864                         // ***************************************************************************
1865                         If VA evt_P4312_POJobNumber is less than or equal to <Zero>
1866                            VA evt_P4312_TriangRateFrom = "0"
1867                            VA evt_P4312_TriangRateTo = "0"
1868                            VA evt_P4312_CurrencyConvMethod = " "
1869                            F4301.Fetch Single
                                   VA evt_P4312_OrderCompany =  TK Order Company (Order Number)
                                   VA evt_P4312_OrderNumber =  TK Document (Order No, Invoice, etc.)
                                   VA evt_P4312_OrderType =  TK Order Type
                                   VA evt_P4312_OrderSuffix =  TK Order Suffix
                                   VA evt_P4312_Supplier <- TK Address Number
                                   VA evt_P4312_OrderHoldCode <- TK Hold Orders Code
                                   VA evt_P4312_CurrencyMode <- TK Currency Mode-Foreign or Domestic Entry
                                   VA evt_P4312_CurrencyCodeFrom <- TK Currency Code - From
                                   VA evt_P4312_ExchangeRate <- TK Currency Conversion Rate - Spot Rate
1870                            VA evt_P4312_BatchDate = VA evt_TodaysDate
1871                            VA evt_P4312_BatchType = "O"
1872                            F0011 Open Batch
                                   VA evt_P4312_BatchType -> szBatchtype
                                   VA evt_P4312_BatchNumber <- mnBatchnumber
                                   VA evt_P4312_BatchDate <> jdBatchDate
1873                            F43121 Begin Document
                                   VA evt_P4312_POJobNumber <> mnJobNumber
                                   BF szComputerID -> szComputerID
                                   "1" -> cActionCode
                                   "1" -> cProcessEdits
                                   "EP4312" -> szProgramID
                                   VA evt_P4312_CurrencyProcessing <> cCurrencyProcessingFlag
                                   VA evt_P4312_OrderNumber -> mnOrderNumber
                                   VA evt_P4312_OrderType -> szOrderType
                                   VA evt_P4312_OrderCompany -> szOrderCompany
                                   VA evt_P4312_OrderSuffix -> szOrderSuffix
                                   VA evt_P4312_CurrencyMode <> cCurrencyMode
                                   VA evt_P4312_Supplier <> mnSupplier
                                   VA evt_P4312_BaseCurrency <> szBaseCurrency
                                   VA evt_P4312_CurrencyCodeFrom <> szPOCurrency
                                   VA evt_P4312_ExchangeRate <> mnExchangeRate
                                   VA evt_P4312_ReceiptDate <> jdReceiptDate
                                   VA evt_P4312_GLDate <> jdGLDate
                                   VA evt_P4312_OrderHoldCode <> szHoldCode
                                   VA evt_UserId -> szUserID
                                   VA evt_PO_P4312Version -> szPOVersion
                                   VA evt_P4312_BatchNumber <> mnBatchNumber
                                   VA evt_P4312_BatchStatus <> cBatchStatus
                                   VA evt_P4312_BatchDate <> jdBatchDate
                                   "1" -> cReceiptsByPO
                                   VA evt_P4312_TriangRateFrom <> mnTriangulationRateFromCurrenc
                                   VA evt_P4312_TriangRateTo <> mnTriangulationRateToCurrency
                                   VA evt_P4312_CurrencyConvMethod <> cCurrencyConversionMethod
1874                         End If
1875                         // Continue if no error was issued from F43121 Begin Doc
1876                         If SV Error_Status is equal to CO SUCCESS
1877                            F4311.Fetch Single
                                   VA evt_P4312_OrderCompany =  TK Order Company (Order Number)
                                   VA evt_P4312_OrderNumber =  TK Document (Order No, Invoice, etc.)
                                   VA evt_P4312_OrderType =  TK Order Type
                                   VA evt_P4312_OrderSuffix =  TK Order Suffix
                                   VA evt_P4312_POLineNumber =  TK Line Number
                                   VA evt_P4312_ReceiptBranch <- TK Business Unit
                                   VA evt_P4312_Supplier <- TK Address Number
                                   VA evt_P4312_Location <- TK Location
                                   VA evt_P4312_Lot <- TK Lot/Serial Number
1878                            F43121 Edit Line
                                   VA evt_P4312_POJobNumber -> mnJobNumber
                                   BF szComputerID -> szComputerID
                                   "1" -> cActionCode
                                   "1" -> cProcessEdits
                                   "EP4312" -> szProgramID
                                   VA evt_P4312_CurrencyProcessing -> cCurrencyProcessingFlag
                                   VA evt_P4312_OrderNumber -> mnOrderNumber
                                   VA evt_P4312_OrderType -> szOrderType
                                   VA evt_P4312_OrderCompany -> szOrderKeyCompany
                                   VA evt_P4312_OrderSuffix -> szOrderSuffix
                                   VA evt_P4312_POLineNumber -> mnLineNumber
                                   "1" -> cOption
                                   VA evt_PO_P4312Version -> szPOVersion
                                   BF mnEnteredShipQuantity -> mnQuantityReceived
                                   BF szUnitOfMeasureAsInput -> szReceiptUOM
                                   VA evt_P4312_ReceiptBranch -> szReceiptBranch
                                   VA evt_P4312_Location -> szLocationDatabase
                                   VA evt_P4312_Lot -> szLotNumber
                                   BF szLot -> szSupplierLot
                                   VA evt_P4312_GLDate <> jdGLDate
                                   VA evt_P4312_ReceiptDate <> jdReceiptDate
                                   VA evt_P4312_BaseCurrency <> szDomesticCurrencyCode
                                   VA evt_P4312_CurrencyCodeFrom <> szPOCurrencyCode
                                   VA evt_P4312_ExchangeRate <> mnExchangeRate
                                   VA evt_P4312_CurrencyMode <> cCurrencyMode
                                   VA evt_P4312_BatchNumber -> mnBatchNumber
                                   VA evt_P4312_BatchType -> szBatchType
                                   VA evt_P4312_BatchDate -> jdBatchDate
                                   VA evt_P4312_Supplier -> mnSupplier
                                   "Y" -> cInventoryInterface
                                   "Y" -> cGLInterface
                                   VA evt_P4312_InvJobNumber <> mnF4111JobNumber
                                   VA evt_P4312_GLJobNumber <> mnF0911JobNumber
                                   VA evt_P4312_LastJELine <> mnLastJELine
                                   VA evt_P4312_F4311JobNumber <> mnF4311JobNumber
                                   VA evt_P4312_LCJobNumber <> mnLandedCJobNo
                                   VA evt_P4312_TriangRateFrom <> mnTriangulationRateFromCurrenc
                                   VA evt_P4312_TriangRateTo <> mnTriangulationRateToCurrency
                                   VA evt_P4312_CurrencyConvMethod <> cCurrencyConversionMethod
                                   BF mnBULK_AmbientQtyEntered <> mnAmbientVolume
                                   BF szBULK_AmbientQtyEnteredUOM <> szAmbientVolumeUOM
                                   BF mnBULK_StandardQtyEntered <> mnStandardVolume
                                   BF szBULK_StandardQtyEnteredUOM <> szStandardVolumeUOM
                                   BF mnBULK_WeightQtyEntered <> mnWeightQuantity
                                   BF szBULK_WeightQtyEnteredUOM <> szWeightQuantityUOM
                                   BF mnBULK_Temperature <> mnTemperature
                                   BF cBULK_ProductTemperatureType <> cTemperatureType
                                   BF cBULK_ProductDensityType <> cDensityType
                                   BF mnBULK_DensityTemperature <> mnDensityTemperature
                                   BF cBULK_DensityTemperatureType <> cDensityTemperatureType
                                   BF mnBulk_VolumeCorrectionFactors <> mnVolumeCorrectionFactor
                                   VA evt_P4312_ProgramStatus <> cProgramStatus
                                   VA evt_P4312_BatchStatus <> cBatchStatus
                                   BF mnTRAN_ShipmentNumber -> mnShipmentNumber
                                   VA evt_P4312_TMSJobNumber <> mnTransportationJobNumber
                                   BF mnUnitsSecondaryQtyOr -> mnSecondaryQty
                                   BF szUnitOfMeasureSecondary -> szSecondaryUOM
1879                         End If
1880                         If SV Error_Status is equal to CO SUCCESS
1881                            // ***************************************************************************
1882                            // Always relieve inventory under this situation, regardless of
1883                            // Relieve On-Hand setting or UDC setting
1884                            // ***************************************************************************
1885                            VA evt_UpdateOnHandFlag = "1"
1886                            VA evt_P4312_F4312ErrorID = " "
1887                         Else
1888                            F43121 Delete Work File
                                   BF szComputerID -> szComputerID
                                   VA evt_P4312_POJobNumber -> mnJobNumber
                                   VA evt_P4312_OrderNumber -> mnOrderNumber
                                   VA evt_P4312_OrderType -> szOrderType
                                   VA evt_P4312_OrderCompany -> szOrderCompany
                                   VA evt_P4312_OrderSuffix -> szOrderSuffix
                                   VA evt_PO_P4312Version -> szPOVersion
                                   VA evt_P4312_LCJobNumber -> mnLandedCostJobNumber
                                   VA evt_P4312_InvJobNumber -> mnF4111JobNumber
                                   VA evt_P4312_GLJobNumber -> mnF0911JobNumber
1889                            F0011 Close Batch
                                   VA evt_P4312_BatchNumber -> mnBatchnumber
                                   VA evt_P4312_BatchType -> szBatchtype
                                   <Blank> -> cChangeBatchStatus
                                   "A" -> cOverrideMode
1890                         End If
1891                         Intransit Accounting Cache
                                BF mnJobnumberA -> mnJobNumber
                                BF szComputerID -> szComputerID
                                "A" -> cActionCode
                                VA evt_P4312_F4312ErrorID -> szErrorID
                                VA evt_PO_P4312Version -> szP4312Version
                                VA evt_P4312_POJobNumber -> mnPOJobNumber
                                VA evt_P4312_InvJobNumber -> mnInvJobNumber
                                VA evt_P4312_GLJobNumber -> mnGLJobNumber
                                VA evt_P4312_LCJobNumber -> mnLCJobNumber
                                VA evt_P4312_LCGLJobNumber -> mnLCGLJobNumber
                                VA evt_P4312_F4311JobNumber -> mnF4311JobNumber
                                VA evt_P4312_TMSJobNumber -> mnTMSJobNumber
                                VA evt_P4312_BatchNumber -> mnBatchNumber
                                VA evt_P4312_BatchType -> szBatchType
                                VA evt_P4312_BatchStatus -> cBatchStatus
                                VA evt_P4312_ProgramStatus -> cProgramStatus
                                VA evt_P4312_OrderNumber -> mnOrderNumber
                                VA evt_P4312_OrderType -> szOrderType
                                VA evt_P4312_OrderCompany -> szOrderCompany
                                VA evt_P4312_OrderSuffix -> szOrderSuffix
                                VA evt_P4312_GLDate -> jdGLDate
                                VA evt_P4312_ReceiptDate -> jdReceiptDate
                                VA evt_P4312_LastJELine -> mnLastJELine
                                VA evt_P4312_OrderHoldCode -> szOrderHoldCode
                                VA evt_P4312_CurrencyProcessing -> cCurrencyProcessing
                                VA evt_P4312_CurrencyMode -> cCurrencyMode
                                VA evt_P4312_CurrencyCodeFrom -> szCurrencyCodeFrom
                                VA evt_P4312_ExchangeRate -> mnExchangeRate
                                VA evt_P4312_Supplier -> mnSupplier
1892                      End If
1893                   End If
1894                   // ***************************************************************************
1895                   If BF mnEnteredShipQuantity is not equal to <Zero>
                       And VA evt_NextStatusTable is not equal to "999"
1896                      If VA evt_CommitFlag is not equal to "K"
                          Or VA evt_GenerateWOFlag is equal to "Y"
1897                         //
1898                         VA evt_QuantityShipReversed = [BF mnEnteredShipQuantity]*-1
1899                         // Setup quantities used for on hand and commitment processing
1900                         // Quantity needs to be a non-rounded, converted value. This
1901                         // value is used by F4111 Edit line to setup commitments. The non-rounded
1902                         // value will allow F4111 Edit Line to calculate the correct Secondary Qty.
1903                         VA evt_QuantitySecondaryReversed = 0-[BF mnUnitsSecondaryQtyOr]
1904                         // Use rounded converted value to pass as hard commit value.
1905                         VA evt_QuantityScndryConvReversed = 0-[VA evt_ConvertedSecondaryQuantity]
1906                         If VA evt_F4101_BulkPackFlag is equal to "B"
1907                            VA evt_Bulk_StdQtyEnteredReversed = [BF mnBULK_StandardQtyEntered]*-1
1908                            VA evt_ExtendedCostReversed = [VA evt_ExtendedCost]*-1
1909                            VA evt_AmbientVolumeReversed_AMBR = [BF mnBULK_AmbientQtyEntered]*-1
1910                            VA evt_WeightQuantityReverse_WGTR = [BF mnBULK_WeightQtyEntered]*-1
1911                         End If
1912                         //
1913                         If VA evt_UpdateOnHandFlag is equal to "1"
                             Or VA evt_LotProcessingCode is equal to "4"
1914                            // ==============================================
1915                            // SETUP for XT4111Z1
1916                            // ==============================================
1917                            // Get Sold To Address Description
1918                            F0101 Get Address Information for OP
                                   VA evt_SoldToTable -> mnAddressNumber
                                   VA evt_SoldToName_F0101 <- szAlphaName
                                   UNDEFINED X jdAddressEffectiveDate
                                   UNDEFINED X szTaxCertificate
                                   UNDEFINED X szCreditMessage
                                   UNDEFINED X mnRelatedAddress1
                                   UNDEFINED X mnRelatedAddress2
                                   UNDEFINED X mnRelatedAddress3
                                   UNDEFINED X mnRelatedAddress4
                                   UNDEFINED X mnRelatedAddress5
                                   UNDEFINED X mnRelatedAddress6
                                   UNDEFINED X szBranchPlant
                                   UNDEFINED X szLanguagePreference
                                   UNDEFINED X szErrorMessage
                                   "1" -> cSuppressError
                                   UNDEFINED X szTaxID
                                   UNDEFINED X cPersonCorporationCode
1919                            //
1920                            // Interbranch Orders Only - Set Interbranch Cost
1921                            //
1922                            // SAR 7154871 - Set Unit Cost  = Transfer Unit Cost for Interbranch Order
1923                            // which doesn't have the Interbranch Flag in F4211 populated
1924                            If VA evt_InterbranchOrderFlag is equal to "1,2,3,4" Or VA evt_TranCostInterBPMode_SO01 is equal to "1"
1925                               // SAR 7154871 END
1926                               VA evt_XT4111_UnitCost = VA evt_TransferUnitCost
1927                            Else
1928                               VA evt_XT4111_UnitCost = VA evt_UnitCost
1929                            End If
1930                            //
1931                            //  Ensure Unit cost is in the Transaction Unit of Measure for F4111.
1932                            If BF szUnitOfMeasureAsInput is not equal to VA evt_PrimaryUoM
                                And VA evt_ConversionFactor is not equal to <Zero>
1933                               VA evt_UnitCost_TransactionUOM = [VA evt_XT4111_UnitCost]*[VA evt_ConversionFactor]
1934                            Else
1935                               VA evt_UnitCost_TransactionUOM = VA evt_XT4111_UnitCost
1936                            End If
1937                            //
1938                            // Get Configured String ID for Configured Items
1939                            If VA evt_StockingType_F4102 is equal to "C"
                                And BF cActionCode is not equal to "S"
1940                               //
1941                               // Disabled the call to F32943 because of the B9 database change.
1942                               // Need to enabled it when the configurator team changed the CSID to String
1943                               //
1944 !                               ** Business Function NOT FOUND (F32943GetConfiguredStrngHstryRow)**
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
     !                                  VA evt_XT4111_ConfiguredStringID <- EMBER
     !                                  UNDEFINED X EMBER
     !                                  BF szOrderCompany -> EMBER
     !                                  BF mnOrderNumber -> EMBER
     !                                  BF szOrderType -> EMBER
     !                                  BF mnLineNumber -> EMBER
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
     !                                  "4" -> EMBER
     !                                  "4" -> EMBER
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
     !                                  UNDEFINED X EMBER
1945                            End If
1946                            //
1947                            // If TRANSPORTATION has passed a confirm date, use the passed in date, else use
1948                            // P4205 date
1949                            //
1950                            If BF jdTRAN_LoadConfirmDate is equal to <Null Date>
1951                               VA evt_XT4111_TransactionDate = BF jdActualDeliveryDate
1952                            Else
1953                               VA evt_XT4111_TransactionDate = BF jdTRAN_LoadConfirmDate
1954                            End If
1955                            VA evt_XT4111_UpdatePQOH = VA evt_UpdateOnHandFlag
1956                            //
1957                            VA evt_XT4111_BorrowDueTo = " "
1958                            VA evt_XT4111_BorrowSearchMethod = " "
1959                            VA evt_XT4111_BorrowAgreeSourceTy = "  "
1960                            VA evt_XT4111_BorrowAgreementSour = ""
1961                            VA evt_XT4111_BorrowAgreementSeq = "    "
1962                            VA evt_XT4111_BorrowAgreementNumb = ""
1963                            VA evt_XT4111_BorrowAgreementSupp = ""
1964                            VA evt_XT4111_UpdateGL = ""
1965                            VA evt_XT4111_FromAlternateAAI = "    "
1966                            VA evt_XT4111_OverrideTargetAAI = ""
1967                            //
1968                            //     If Intransit (2 or 3) assign AAIs accordingly (Transportation)
1969                            //     Only populate the GL date for Intransit Inventory movements
1970                            //
1971                            If BF cTRAN_InventoryAffectFlag is equal to "2"
                                Or BF cTRAN_InventoryAffectFlag is equal to "3"
1972                               VA evt_XT4111Z1_GLDate_DGL = BF jdTRAN_LoadConfirmDate
1973                               // Assign Xt4111Z1 Cache Line # = correct line number.
1974                               VA evt_X4111Z1CacheLineNum = VA evt_InventoryLineNumber_LNID
1975                               VA evt_XT4111_CompanyNumOverride = BF szTRAN_DocumentCompany
1976                               VA evt_XT4111_DocTypeOverride = BF szTRAN_OverrideDocumentType
1977                               VA evt_XT4111_DocNumOverride = BF mnTRAN_OverrideInventoryDocNum
1978                               // Change to Acknowledge Direct Shipment Agreements
1979                               IfVA evt_ForeignDepotis equal to"1"OrVA evt_DirectShipAgreementExistsis equal to"1"
1980                                  If VA evt_UpdateGL_Accomadations is equal to "1"
1981                                     VA evt_XT4111_UpdateGL = "1"
1982                                     VA evt_XT4111_FromAlternateAAI = "4241"
1983                                     VA evt_XT4111_OverrideTargetAAI = "4242"
1984                                  End If
1985                                  VA evt_XT4111_UpdatePQOH = "0"
1986                                  VA evt_XT4111_BorrowDueTo = "C "
1987                                  VA evt_XT4111_BorrowSearchMethod = VA evt_PO_AgreementSearchFlag
1988                                  VA evt_XT4111_BorrowAgreeSourceTy = VA evt_BorrowSourceTypeAgreement
1989                                  VA evt_XT4111_BorrowAgreementSour = VA evt_BorrowSourceAgreement
1990                                  VA evt_XT4111_BorrowAgreementSeq = VA evt_BorrowSequenceAgreement
1991                                  VA evt_XT4111_BorrowAgreementNumb = BF szContractNumberDistributi
1992                                  VA evt_XT4111_BorrowAgreementSupp = BF mnContractSupplementDistri
1993                               Else
1994                                  VA evt_XT4111_UpdateGL = "1"
1995                                  VA evt_XT4111_FromAlternateAAI = "4241"
1996                                  VA evt_XT4111_OverrideTargetAAI = "4240"
1997                               End If
1998                            Else
1999                               //
2000                               // If Foreign Depot then process agreements
2001                               //
2002                               // Change to Acknowledge Direct Shipment Agreements
2003                               IfVA evt_ForeignDepotis equal to"1"OrVA evt_DirectShipAgreementExistsis equal to"1"
2004                                  VA evt_XT4111_UpdatePQOH = "0"
2005                                  VA evt_XT4111_BorrowDueTo = "C "
2006                                  VA evt_XT4111_BorrowSearchMethod = VA evt_PO_AgreementSearchFlag
2007                                  VA evt_XT4111_BorrowAgreeSourceTy = VA evt_BorrowSourceTypeAgreement
2008                                  VA evt_XT4111_BorrowAgreementSour = VA evt_BorrowSourceAgreement
2009                                  VA evt_XT4111_BorrowAgreementSeq = VA evt_BorrowSequenceAgreement
2010                                  VA evt_XT4111_BorrowAgreementNumb = BF szContractNumberDistributi
2011                                  VA evt_XT4111_BorrowAgreementSupp = BF mnContractSupplementDistri
2012                               End If
2013                               VA evt_X4111Z1CacheLineNum = BF mnLineNumber
2014                               VA evt_XT4111_CompanyNumOverride = BF szOrderCompany
2015                               VA evt_XT4111_DocTypeOverride = BF szOrderType
2016                               VA evt_XT4111_DocNumOverride = BF mnOrderNumber
2017                            End If
2018                            //   End - Inventory Affect = 2 || = 3
2019                            //
2020                            // Commitments processing for reversed sign amounts
2021                            //
2022                            // Change to prevent commitment relief for Direct shipments
2023                            IfVA evt_CommitmentSignReversalis equal to"1"OrVA evt_TransferDirectShipIntercois equal to"2"
2024                               VA evt_XT4111Z1_QtyHardCommitted = "0"
2025                               VA evt_XT4111Z1_QtySoftCommitted = "0"
2026                            Else
2027                               //
2028                               // Adjust commitment quantities for dual UOM procssing
2029                               If VA evt_CommitFlag is equal to "S"
2030                                  If VA evt_EditforDualUOM is equal to "1"
2031                                     VA evt_XT4111Z1_QtySoftCommitted = VA evt_QuantityScndryConvReversed
2032                                  Else
2033                                     VA evt_XT4111Z1_QtySoftCommitted = VA evt_QuantityShipReversed
2034                                  End If
2035                                  VA evt_XT4111Z1_QtyHardCommitted = "0"
2036                               Else
2037                                  // SAR 7451586 - Set Hard Commit to Quantity Shipped Reversed.
2038                                  VA evt_XT4111Z1_QtyHardCommitted = VA evt_QuantityShipReversed
2039                                  VA evt_XT4111Z1_QtySoftCommitted = "0"
2040                               End If
2041                            End If
2042                            //
2043                            If VA evt_OtherQuantityFlag is equal to "1,2"
2044                               VA evt_OtherCommitOverride = "1"
2045                            End If
2046                            //
2047                            If VA evt_LotProcessingCode is equal to "4"
2048                               If VA evt_CreditOrderNoHdComXT4111Z1 is equal to "1"
2049                                  VA evt_XT4111Z1_QtyHardCommitted = "0"
2050                               End If
2051                               VA evt_XT4111_TransactionDocType = BF szOrderType
2052                               VA evt_XT4111_TransactionDocNum = BF mnOrderNumber
2053                               VA evt_XT4111_OrderNumber = VA evt_XT4111_DocNumOverride
2054                               VA evt_XT4111_OrderType = VA evt_XT4111_DocTypeOverride
2055                               VA evt_XT4111_OrderCompany = VA evt_XT4111_CompanyNumOverride
2056                               VA evt_XT4111_TransactProcessType = "14"
2057                               VA evt_DualOrderType = VA evt_XT4111_DocTypeOverride
2058                               VA evt_DualOrderNumber = VA evt_XT4111_DocNumOverride
2059                               VA evt_DualCompanyKeyOrderNo = VA evt_XT4111_CompanyNumOverride
2060                               If VA evt_UpdateOnHandFlag is equal to "1"
2061                                  VA evt_XT4111_UpdateDataItem = " "
2062                                  VA evt_XT4111_F0911JobNumber = VA evt_HDR_InventoryJobNumber
2063                               Else
2064                                  VA evt_XT4111_UpdateDataItem = "HCOM"
2065                                  VA evt_XT4111_F0911JobNumber = VA evt_HDR_GLJobNumber
2066                               End If
2067                            Else
2068                               VA evt_XT4111_TransactionDocType = VA evt_XT4111_DocTypeOverride
2069                               VA evt_XT4111_TransactionDocNum = VA evt_XT4111_DocNumOverride
2070                               VA evt_XT4111_OrderNumber = BF mnOrderNumber
2071                               VA evt_XT4111_OrderType = BF szOrderType
2072                               VA evt_XT4111_OrderCompany = BF szOrderCompany
2073                               VA evt_XT4111_UpdateDataItem = " "
2074                               VA evt_XT4111_TransactProcessType = "13"
2075                               VA evt_XT4111_F0911JobNumber = VA evt_HDR_GLJobNumber
2076                               VA evt_DualOrderType = BF szOrderType
2077                               VA evt_DualOrderNumber = BF mnOrderNumber
2078                               VA evt_DualCompanyKeyOrderNo = BF szOrderCompany
2079                               If BF mnEnteredShipQuantity is less than <Zero>
2080                                  If VA evt_CreditOrderNoHdComXT4111Z1 is equal to "1"
2081                                     VA evt_XT4111Z1_QtyHardCommitted = "0"
2082                                  End If
2083                                  If VA evt_LocationCache is not equal to <Blank>
                                      And VA evt_LocationCache is not equal to <Null>
2084                                     VA evt_XT4111_TransactProcessType = "14"
2085                                  Else
2086                                     If BF szLot is greater than <Blank>
2087                                        VA evt_XT4111_TransactProcessType = "14"
2088                                     End If
2089                                  End If
2090                               End If
2091                            End If
2092                            //
2093                            F4111 Edit Line
                                   VA evt_XT4111_TransactionDocType -> szTransactionDocumentType
                                   VA evt_ItemNumber -> mnShortItemNumber
                                   BF szBranchPlant -> szBranchPlant
                                   VA evt_LocationCache -> szLocation
                                   BF szLot -> szLotNumber
                                   BF szUnitOfMeasureAsInput -> szTransactionUOM
                                   VA evt_QuantityShipReversed -> mnTransactionQuantity
                                   VA evt_UnitCost_TransactionUOM -> mnTransactionUnitCost
                                   VA evt_ExtendedCostReversed <> mnTransactionExtendedCost
                                   BF szLocation -> szLocationFormatted
                                   VA evt_XT4111_TransactionDate -> jdTransactionDate
                                   VA evt_StandardPotency -> mnLotPotency
                                   VA evt_LotStatusCode_NewLoc -> cLotStatusCode
                                   BF jdDateLotExpiration <> jdExpirationDate
                                   "1" -> cSuppressErrorMessage
                                   "1" -> cAllowHeldLotsEdit
                                   "A" -> cLineAction
                                   BF szComputerID -> szComputerID
                                   VA evt_ErrorCode <- cErrorConditions
                                   VA evt_szCompany_Cache_CO -> szTransactionKeyCompany
                                   VA evt_XT4111_TransactionDocNum -> mnTransactionDocumentNumber
                                   VA evt_XT4111Z1_GLDate_DGL -> jdGLDate
                                   VA evt_SoldToName_F0101 -> szTransactionExplanation
                                   BF szVendorLotNumber -> szSupplierLotNumber
                                   "1" -> cAllowQtyOverAvailable
                                   VA evt_XT4111_OrderNumber -> mnOrderNumber
                                   VA evt_XT4111_OrderType -> szOrderType
                                   VA evt_XT4111_OrderCompany -> szOrderKeyCompany
                                   VA evt_X4111Z1CacheLineNum <> mnOrderLineNumber
                                   "000" -> szTransactionSuffix
                                   VA evt_HDR_BatchNumber <> mnBatchNumber
                                   VA evt_XT4111_UpdatePQOH -> cUpdatePQOH
                                   VA evt_szReasonCode_RCD -> szReasonCode
                                   "1" -> cUnitCostEntered
                                   VA evt_PricingUoM -> szPriceCostUOM
                                   VA evt_ForeignUnitCost -> mnTransactionForeignUnitCost
                                   VA evt_ForeignExtendedCost -> mnTransactionForeignExtendCost
                                   VA evt_XT4111_UpdateDataItem -> szUpdateDataItem
                                   VA evt_GlCategory -> szGLCategory
                                   VA evt_SoldToTable -> mnInventoryTransactionAddress
                                   "S" -> cAsOfPostedCode
                                   VA evt_ExtendedAmount -> mnExtendedPrice
                                   VA evt_XT4111_TransactProcessType -> mnTransactionProcessType
                                   VA evt_XT4111_UpdateGL -> cProcessJE
                                   VA evt_HDR_BatchStatus <> cBatchStatus
                                   VA evt_HDR_LastJELine <> mnLastJELine
                                   VA evt_LotStatusCode1_NewLoc -> cLotStatusCode1
                                   VA evt_XT4111Z1_QtySoftCommitted -> mnSoftCommittedQty
                                   "EP4205" -> szTransactionReference
                                   VA evt_XT4111_F0911JobNumber <> mnF0911JobNumber
                                   BF mnJobnumberA -> mnInvJobNumber
                                   VA evt_Bulk_FromToFlag -> cFromTo
                                   BF szMemoLotField1 -> szMemoLot1
                                   BF szMemoLotField2 -> szMemoLot2
                                   VA evt_XT4111Z1_QtyHardCommitted -> mnQtyHardCommitted
                                   VA evt_RequestedDate_F4211_DRQJ -> jdRequestDate
                                   VA evt_AmbientVolumeReversed_AMBR <> mnAmbientVolume
                                   BF szBULK_AmbientQtyEnteredUOM <> szAmbientVolumeUOM
                                   VA evt_Bulk_StdQtyEnteredReversed <> mnStandardVolume
                                   BF szBULK_StandardQtyEnteredUOM <> szStandardVolumeUOM
                                   VA evt_WeightQuantityReverse_WGTR <> mnWeightQuantity
                                   BF szBULK_WeightQtyEnteredUOM <> szWeightQtyUOM
                                   BF mnBULK_Temperature <> mnTemperature
                                   BF cBULK_ProductTemperatureType <> cTemperatureType
                                   BF cBULK_ProductDensityType <> cDensityType
                                   BF mnBULK_DensityTemperature <> mnDensityTemperature
                                   BF cBULK_DensityTemperatureType <> cDensityTemperatureType
                                   BF mnBulk_VolumeCorrectionFactors <> mnVolumeCorrectionFactors
                                   VA evt_XT4111_FromAlternateAAI -> mnFromAlternateAAI
                                   VA evt_XT4111_OverrideTargetAAI -> mnToAlternateAAI
                                   VA evt_newPrimaryShipQuantity <- mnTransactionQtyInPrimary
                                   BF mnBULK_ProductDensity <> mnDisplayDensity
                                   BF mnBULK_TransactionTime <> mnTime
                                   "000" -> szOrderSuffix
                                   VA evt_XT4111_BorrowAgreementNumb -> szAgreementNumber
                                   VA evt_XT4111_BorrowAgreementSupp -> mnAgreementSupplement
                                   VA evt_XT4111_BorrowAgreementSeq -> mnAgreementSequence
                                   VA evt_XT4111_BorrowDueTo -> cDueTo
                                   VA evt_XT4111_BorrowAgreementSour -> szProductSource
                                   VA evt_XT4111_BorrowAgreeSourceTy -> szProductSourceType
                                   "T" -> cAgreementMode
                                   VA evt_XT4111_BorrowSearchMethod X cAgreementSearchMethod
                                   VA evt_InvErrorID_DTAI <- szErrorMessageID
                                   BF jdBasedOnDate <> jdBasedOnDate
                                   VA evt_XT4111_TransactionDate <> jdOnHandDate
                                   BF jdLotEffectivityDate <> jdLotEffectivityDate
                                   BF jdSellByDate <> jdSellByDate
                                   BF jdBestBeforeDate <> jdBestBeforeDate
                                   BF jdUserLotDate1 <> jdUserLotDate1
                                   BF jdUserLotDate2 <> jdUserLotDate2
                                   BF jdUserLotDate3 <> jdUserLotDate3
                                   BF jdUserLotDate4 <> jdUserLotDate4
                                   BF jdUserLotDate5 <> jdUserLotDate5
2094                            //
2095                            BF mnInvTransactionType = VA evt_XT4111_TransactProcessType
2096                            //
2097                            // Change edit to include test for Inventory Effect Flag = <NULL>
2098                            IfVA evt_ErrorCodeis not equal to"1"
2099                               IfBF cTRAN_InventoryAffectFlagis equal to<Zero>OrBF cTRAN_InventoryAffectFlagis equal to<Blank>OrBF cTRAN_InventoryAffectFlagis equal to<Null>
2100                                  If VA evt_Sales_AgreementNum_DMCT is not equal to <Blank>
                                      And VA evt_Sales_AgreementNum_DMCT is not equal to <Null>
2101                                     F4211 Sales Order Agreement Cache
                                            BF mnJobnumberA -> mnJobNumber_JOBS
                                            BF szComputerID -> szComputerID_CTID
                                            VA evt_Sales_AgreementNum_DMCT -> szAgreementNumber_DMCT
                                            VA evt_Sales_AgreementSuppy_DMCS -> mnAgreementSupplement_DMCS
                                            UNDEFINED X szProductSource_PSR
                                            UNDEFINED X szProductSourceType_PSRY
                                            UNDEFINED X mnSequenceNumber_SEQ
                                            BF mnOrderNumber -> mnOrderNumber_DOCO
                                            BF szOrderType -> szOrderType_DCTO
                                            BF szOrderCompany -> szOrderKeyCompany_KCOO
                                            BF mnLineNumber -> mnLineNumber_LNID
                                            UNDEFINED X mnAgreementsFound_AFND
                                            UNDEFINED X mnLineNumberXREF_LNIX
                                            "2" -> cModeProcessing_MODE
                                            UNDEFINED X mnNumberOfLines_NLIN
                                            "000" -> szOrderSuffix_SFXO
                                            UNDEFINED X idCacheCursor_GENLNG
                                            UNDEFINED X mnNumberOfKeys_CDL
                                            UNDEFINED X cLastRecordRead_EV01
                                            UNDEFINED X cErrorCode_ERRC
                                            UNDEFINED X cSuppressErrorMessage_SUPPS
2102                                  End If
2103                               End If
2104                            End If
2105                            //
2106                            If VA evt_ErrorCode is not equal to "2"
2107                               //
2108                               // For standard intransit load (Tran Inv Aff = 2), assign to
2109                               // the inventory line number dtermined from header cache read.
2110                               If BF cTRAN_InventoryAffectFlag is equal to "2"
2111                                  VA evt_X4111Z1CacheLineNum = VA evt_InventoryLineNumber_LNID
2112                               Else
2113                                  VA evt_X4111Z1CacheLineNum = BF mnLineNumber
2114                               End If
2115                               //
2116                            Else
2117                               VA evt_UpdateOnHandFlag = "0"
2118                               VA evt_X4111Z1CacheLineNum = ""
2119                            End If
2120                            //
2121                            If VA evt_InvErrorID_DTAI is equal to "4723"
2122                               Set NER Error("4723", BF szLot)
2123                               VA evt_EditsProcessedFlag = "0"
2124                            End If
2125                            //
2126                            // Reverse the sign of newPrimary Ship Qty passed back from XT4111 to a
2127                            // positive value for the bulk primary UOM quantity
2128                            VA evt_newPrimaryShipQuantity = 0-[VA evt_newPrimaryShipQuantity]
2129                            //
2130                            // Reverse signs for Bulk Processing fields
2131                            //
2132                            If VA evt_BulkUseManagementFlag is equal to "1"
                                And VA evt_F4101_BulkPackFlag is equal to "B"
2133                               VA evt_ExtendedCost = [VA evt_ExtendedCostReversed]*-1
2134                               BF mnBULK_StandardQtyEntered = [VA evt_Bulk_StdQtyEnteredReversed]*-1
2135                               BF mnBULK_AmbientQtyEntered = [VA evt_AmbientVolumeReversed_AMBR]*-1
2136                               BF mnBULK_WeightQtyEntered = [VA evt_WeightQuantityReverse_WGTR]*-1
2137                            End If
2138                            //
2139                            // End - Transaction Flag NE 3
2140                         Else
2141                            //
2142                            // if F4111 Edit Line is not run, then validate Lot/Location and CSID when
2143                            // the input line being processed relates to a Configured items
2144                            //
2145                            If VA evt_CommitFlag is equal to "K"
                                Or VA evt_CommitFlag is equal to "H"
2146                               If VA evt_StockingType_F4102 is equal to "C"
                                   And BF cActionCode is not equal to "S"
2147                                  //
2148                                  // - Need to pass in correct Index and correct number of keys to call B3700140.
2149                                  // Need to pass in the File value of location to be able to successfully
2150                                  // fetch the F41021
2151                                  //
2152                                  F4100 Format Location
                                         BF szBranchPlant -> szCostCenter
                                         BF szLocation -> szDisplayFormatLocation
                                         VA evt_szFileFormatLocation_LOCN <- szFileFormatLocation
                                         "4" -> cValidate
                                         UNDEFINED X szAisle
                                         UNDEFINED X szBin
                                         UNDEFINED X szLocation3
                                         UNDEFINED X szLocation4
                                         UNDEFINED X szLocation5
                                         UNDEFINED X szLocation6
                                         UNDEFINED X szLocation7
                                         UNDEFINED X szLocation8
                                         UNDEFINED X szLocation9
                                         UNDEFINED X szLocation10
                                         "2" -> cMode
                                         UNDEFINED X idBranchConstantRecord
2153                                  F41021.Fetch Single
                                         VA evt_ItemNumber =  TK Item Number - Short
                                         BF szBranchPlant =  TK Business Unit
                                         VA evt_szFileFormatLocation_LOCN =  TK Location
                                         BF szLot =  TK Lot/Serial Number
2154                                  //
2155                                  // Disabled the call to F32943 because of the B9 database change.
2156                                  // Need to enabled it when the configurator team changed the CSID to String
2157                                  //
2158 !                                  ** Business Function NOT FOUND (F32943GetConfiguredStrngHstryRow)**
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
     !                                     VA evt_XT4111_ConfiguredStringID <- EMBER
     !                                     UNDEFINED X EMBER
     !                                     BF szOrderCompany -> EMBER
     !                                     BF mnOrderNumber -> EMBER
     !                                     BF szOrderType -> EMBER
     !                                     BF mnLineNumber -> EMBER
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
     !                                     "4" -> EMBER
     !                                     "4" -> EMBER
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
     !                                     UNDEFINED X EMBER
2159                                  //
2160                                  If VA evt_ConfiguredStringID is not equal to VA evt_XT4111_ConfiguredStringID
2161                                     Set NER Error("122G", BF szLot)
2162                                  End If
2163                               End If
2164                            End If
2165                            //
2166                         End If
2167                      End If
2168                      // END -  Update OH Flag = 1  and  Lot Process Code = 4   Check
2169                      //  KIT and WO check
2170                   End If
2171                   //  END - Ship Qty NE 0 and  NextStatus NE 999
2172                   //
2173                   // process DUAL UOM Edits after the call to F4111 Edit Line. Dual UOM Edits
2174                   // needs to use common flags with the prior edits. (If both SOQS and SQOR are
2175                   // zero, bypass edits. This line is either being cancelled or backordered, and
2176                   // Calculate New Quantities will perform all required edits.)
2177                   //
2178                   // Change edit to list values of "1,2"
2179                   If BF mnEnteredShipQuantity is not equal to <Zero> And BF mnUnitsSecondaryQtyOr is not equal to <Zero> And VA evt_DualUnitOfMeasureItem is equal to "1,2"
2180                      Dual Unit of Measure
                             "1" -> cSuppressErrorMessage
                             VA evt_ErrorMessageReturned <- szErrorMessageID
                             VA evt_ItemNumber -> mnIdentifierShortItem
                             BF szBranchPlant -> szBranchPlant
                             VA evt_QuantityShipReversed -> mnUnitsTransactionQty
                             BF szUnitOfMeasureAsInput -> szUnitOfMeasureAsInput
                             VA evt_QuantitySecondaryReversed -> mnUnitsSecondaryQty
                             BF szUnitOfMeasureSecondary -> szUnitOfMeasureSecondAsInput
                             VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
                             VA evt_DualTolerance -> mnDualTolerance
                             VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                             VA evt_PrimaryUoM -> szUnitOfMeasurePrimary
                             VA evt_SecondaryPrimaryUoM -> szUnitOfMeasureSecondary
                             "1" -> cInventoryTransactionProcess
                             <Blank> -> cTransactionException
                             BF mnJobnumberA -> mnDualJobNumber
                             VA evt_DualOrderNumber -> mnOrderNumber
                             VA evt_DualOrderType -> szOrderType
                             VA evt_DualCompanyKeyOrderNo -> szCompanyKeyOrderNo
                             "000" -> szOrderSuffix
                             VA evt_X4111Z1CacheLineNum -> mnLineNumber
                             <Zero> -> mnNoOfLinesOnOrder
                             BF szComputerID -> szComputerID
                             VA evt_XT4111_UpdatePQOH -> cUpdateSecondaryQuantityOnHand
                             UNDEFINED X mnExtendedAmount
                             UNDEFINED X mnPrimaryQuantity
                             UNDEFINED X mnSecondaryQuantity
                             UNDEFINED X cCycleCountVariance
2181                      //
2182                      If VA evt_ErrorMessageReturned is greater than <Blank>
2183                         Set NER Error(VA evt_ErrorMessageReturned, BF mnEnteredShipQuantity)
2184                         Retrieve F9207 Info for Error Messages
                                VA evt_ErrorMessageReturned -> szDataItem
                                VA evt_ErrorLevel <- cErrorLevel
                                UNDEFINED X idDataStructureTemplateID
                                UNDEFINED X szDataStructureObjectName
                                UNDEFINED X idDataDictionaryID
2185                         If VA evt_ErrorLevel is equal to "1"
2186                            VA evt_EditsProcessedFlag = "0"
2187                         End If
2188                      End If
2189                   End If
2190                   //
2191                Else
2192                   //   Inventory already relieved by Transportation.
2193                   //   Ignore UDC values.  Do not call XT4111.  Force F4211 OnHand Flag to 1.
2194                   VA evt_UpdateOnHandFlag = "0"
2195                   VA evt_X4111Z1CacheLineNum = ""
2196                End If
2197                //  END - Inventory Affect Flag = 3
2198                //
2199             End If
2200             //
2201          End If
2202          //  End -  Relieve OH  for records passing Edits.
2203       End If
2204       // PRE-EDIT MODE
2205    End If
2206    //  END - ACTION CODE   NE  "D"
2207    //
2208    VA evt_UpdateSalesAgreement = " "
2209    // If branch plant or Qty has changed move '1' to UpdateSalesAgreement
2210    If VA evt_SaveBranchPlant is not equal to BF szBranchPlant
        Or VA evt_SaveQuantity is not equal to BF mnEnteredShipQuantity
2211       //
2212       // Decide whether to update prepayments or not since
2213       // prepayments uses Update Sales Agreement flag as well but doesn't always need
2214       // to be updated when agreements needs it.
2215       // 1 = update agreements only, prepayment still needs to authorize for the B/O
2216       //         quantity and the shipped qty.
2217       // 2 = update agreements and prepayments since prepayments needs to only
2218       //       authorize for the shipped qty, not the canceled qty.
2219       //
2220       If BF mnEnteredBackorderQuantity is greater than <Zero>
2221          VA evt_UpdateSalesAgreement = "1"
2222       Else
2223          VA evt_UpdateSalesAgreement = "2"
2224       End If
2225    End If
2226    //
2227    // ==========================================
2228    // COMMITMENT PROCESSING
2229    // ==========================================
2230    //  Process adjustments to Commitments (F41021) and reversals of
2231    // prior commitments. Only process when Mode Procssing not equal to 5, Inventory
2232    // Interface is on, the line is a text line, and Order Quantity from the table i
2233    // not zero or Action Code equals 'S'.
2234    //
2235    // Add Dual UOM adjustments to commitment processing
2236    //
2237    //
2238    If BF cModeProcessing is not equal to "5"
        And VA evt_InventoryInterface is equal to "Y"
        And VA evt_TextLineYN is not equal to "Y"
2239       If VA evt_TableQuantityOrdered is not equal to <Zero>
           Or BF cActionCode is equal to "S"
2240          //
2241          // LPN - Shall not commit to item location that has a license plate
2242          If VA evt_cLPExist_EV01 is not equal to <Blank> And VA evt_cLPExist_EV01 is not equal to <Null> And VA evt_UpdateOnHandFlag is less than or equal to <Zero>
2243             Set NER Error("133LPN", BF szLocation)
2244             VA evt_EditsProcessedFlag = "0"
2245          Else
2246             //
2247             // remove prior processed edits
2248             //
2249             If VA evt_CachedEditsProcessed is equal to "1"
2250                //
2251                // set commitment override flag depending on whether or not F4111 Edit Line was
2252                // called. When F4111 Edit Line is called, override should be <blank>.
2253                //
2254                // Other Quantity Flag will always be blank when removing a previous
2255                // commitment.
2256                //
2257                VA evt_OtherQuantityFlagOverride = " "
2258                //
2259                If VA evt_CachedActionCode is not equal to "S"
2260                   //
2261                   // remove original adjustment if line is in cache, has a different value from th
2262                   // table, and is either deselected or modified a second time
2263                   //
2264                   If VA evt_OriginalBranchPlant is not equal to VA evt_CachedBranchPlant
                       Or VA evt_OriginalLot is not equal to VA evt_CachedLot
                       Or VA evt_OriginalLocation is not equal to VA evt_CachedLocation
                       Or VA evt_EditingTableShipQuantity is not equal to VA evt_EditingCachedShippedQty
                       Or VA evt_OriginalBackorderQuantity is not equal to VA evt_CachedQuantityBackordered
                       Or VA evt_CachedOtherCommitOverride is equal to "1"
                       Or VA evt_OriginalCommittedHS is not equal to VA evt_CachedCommittedFlag
2265                      //
2266                      If VA evt_OriginalCommittedHS is not equal to "K"
                          Or VA evt_GenerateWOFlag is equal to "Y"
2267                         //
2268                         // Commitments for reversal processing
2269                         //
2270                         If VA evt_EditingCachedShippedQty is less than <Zero>
                             And VA evt_EditingTableShipQuantity is greater than <Zero>
2271                            VA evt_CommitmentSignRollback = "1"
2272                         End If
2273                         //
2274                         If VA evt_CommitmentSignRollback is not equal to "1"
2275                            //
2276                            // remove commitment for cached row
2277                            //
2278                            // SAR 7451586 - add flag to mark the the update as transaction related.
2279                            // Transaction updates require actuals and not converted ratios
2280                            F41021 Update Order Commitment to Inventory
                                   VA evt_CachedItemNumber -> mnItemNumber
                                   VA evt_CachedBranchPlant -> szBranchPlant
                                   VA evt_CachedLocation -> szLocation
                                   VA evt_CachedLot -> szLotNumber
                                   VA evt_CachedQuantityShipped -> mnShippingQuantity
                                   <Zero> -> mnBackorderQuantity
                                   VA evt_CachedConversionFactor -> mnTransToPrimConvFactor
                                   VA evt_CachedCommittedFlag -> cCommitmentFlag
                                   VA evt_OtherQuantityFlagOverride -> cOtherQuantity12
                                   "1" -> cReverseCommitment
                                   BF szProgramID -> szProgramId
                                   <Blank> -> cSuppressErrorMessage
                                   "1" -> cSuppressUpdateMRPFlag
                                   "1" -> cUseCacheFlag
                                   BF mnJobnumberA -> mnJobNo
                                   BF szUserId -> szUserID
                                   BF szWorkStationId -> szWorkStationID
                                   VA evt_TimeOfDay -> mnTimeOfDay
                                   VA evt_TodaysDate -> jdDate
                                   VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                                   VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
                                   VA evt_CachedSecondaryQuantity -> mnDualQuantity
                                   VA evt_CachedConvFctScndtoScnPrim -> mnInputSecondToItemMasSecond
                                   VA evt_CachedConvFactorTrantoDual -> mnTransToSecondConvFactor
                                   "1" -> cTransactionRelatedProcess
2281                            //
2282                            // reinstate original commitment
2283                            //
2284                            // Do not call the B4200470 if the BF cTranInventoryAffectFlag = 3
2285                            //  Compartmentalize In-Transit Load
2286                            //
2287                            If BF cTRAN_InventoryAffectFlag is not equal to "3"
2288                               F41021 Update Order Commitment to Inventory
                                      VA evt_ItemNumber -> mnItemNumber
                                      VA evt_OriginalBranchPlant -> szBranchPlant
                                      VA evt_OriginalLocation -> szLocation
                                      VA evt_OriginalLot -> szLotNumber
                                      VA evt_TableQuantityShipped -> mnShippingQuantity
                                      VA evt_OriginalBackorderQuantity -> mnBackorderQuantity
                                      VA evt_mnOriginalConvFactor_CNV1 -> mnTransToPrimConvFactor
                                      VA evt_OriginalCommittedHS -> cCommitmentFlag
                                      VA evt_OtherQuantityFlag -> cOtherQuantity12
                                      <Zero> -> cReverseCommitment
                                      BF szProgramID -> szProgramId
                                      <Blank> -> cSuppressErrorMessage
                                      "1" -> cSuppressUpdateMRPFlag
                                      "1" -> cUseCacheFlag
                                      BF mnJobnumberA -> mnJobNo
                                      BF szUserId -> szUserID
                                      BF szWorkStationId -> szWorkStationID
                                      VA evt_TimeOfDay -> mnTimeOfDay
                                      VA evt_TodaysDate -> jdDate
                                      VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                                      VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
                                      VA evt_TableSecondaryQuantity -> mnDualQuantity
                                      VA evt_CachedConvFctScndtoScnPrim -> mnInputSecondToItemMasSecond
                                      VA evt_CachedConvFactorTrantoDual -> mnTransToSecondConvFactor
2289                            End If
2290                            //
2291                         End If
2292                         //
2293                         // setup Ship Difference if quantity changes for Multi Location Parent
2294                         //
2295                         If VA evt_CachedActionCode is equal to "P"
2296                            VA evt_MultiLocationParentChange = "1"
2297                         End If
2298                         //
2299                         // Commitments for reversal processing
2300                         //
2301                         If VA evt_CommitmentSignRollback is not equal to "1"
2302                            // SAR 7451586 - Use TableQuantityOrdered when calculating Shipped Difference
2303                            // reversal for all non-multilocation parent lines.
2304                            If VA evt_CachedActionCode is equal to "P"
2305                               VA evt_ShippedDifferenceReversal = [VA evt_CachedQuantityOrdered]-(([VA evt_CachedQuantityShipped]+[VA evt_CachedQuantityBackordered])+[VA evt_CachedQuantityCanceled])
2306                            Else
2307                               VA evt_ShippedDifferenceReversal = [VA evt_TableQuantityOrdered]-(([VA evt_CachedQuantityShipped]+[VA evt_CachedQuantityBackordered])+[VA evt_CachedQuantityCanceled])
2308                            End If
2309                            If VA evt_EditforDualUOM is equal to "1"
                                And VA evt_CachedConvFactorTrantoDual is not equal to <Zero>
2310                               // Calculate difference in Secondary Unit of Measure
2311                               // SAR 7451586 - Use TableQuantityOrdered when calculating Shipped Difference
2312                               // reversal for all non-multilocation parent lines.
2313                               If VA evt_CachedActionCode is equal to "P"
2314                                  VA evt_SecondaryShipDiffReversal = (([VA evt_CachedQuantityOrdered]-([VA evt_CachedQuantityBackordered]+[VA evt_CachedQuantityCanceled]))*[VA evt_CachedConvFactorTrantoDual])-[VA evt_CachedSecondaryQuantity]
2315                               Else
2316                                  VA evt_SecondaryShipDiffReversal = (([VA evt_TableQuantityOrdered]-([VA evt_CachedQuantityBackordered]+[VA evt_CachedQuantityCanceled]))*[VA evt_CachedConvFactorTrantoDual])-[VA evt_CachedSecondaryQuantity]
2317                                  // SAR 7451586 - recalculate ShipDifferencereversal based on
2318                                  // SecondaryShipDifferenceReversal when DPP is 'ON'
2319                                  If VA evt_DualPickingProcessOption is equal to "1"
2320                                     VA evt_ShippedDifferenceReversal = [VA evt_SecondaryShipDiffReversal]/[VA evt_CachedConvFactorTrantoDual]
2321                                  End If
2322                               End If
2323                               VA evt_SecondaryShipDiffReversal = round([VA evt_SecondaryShipDiffReversal],1)
2324                            End If
2325                         Else
2326                            VA evt_ShippedDifferenceReversal = [VA evt_CachedQuantityShipped]*-1
2327                            VA evt_SecondaryShipDiffReversal = [VA evt_CachedSecondaryQuantity]*-1
2328                         End If
2329                         //
2330                         // Account for reveral commitment of partial credit orders
2331                         //
2332                         VA evt_CommitDifferenceExists = "0"
2333                         If VA evt_EditforDualUOM is not equal to "1"
2334                            If VA evt_ShippedDifferenceReversal is greater than <Zero>
                                And VA evt_CachedQuantityOrdered is greater than <Zero>
2335                               VA evt_CommitDifferenceExists = "1"
2336                            Else
2337                               If VA evt_ShippedDifferenceReversal is less than <Zero>
                                   And VA evt_CachedQuantityOrdered is less than <Zero>
2338                                  VA evt_CommitDifferenceExists = "1"
2339                               End If
2340                            End If
2341                         Else
2342                            If VA evt_SecondaryShipDiffReversal is greater than <Zero>
                                And VA evt_CachedQuantityOrdered is greater than <Zero>
2343                               VA evt_CommitDifferenceExists = "1"
2344                            Else
2345                               If VA evt_SecondaryShipDiffReversal is less than <Zero>
                                   And VA evt_CachedQuantityOrdered is less than <Zero>
2346                                  VA evt_CommitDifferenceExists = "1"
2347                               End If
2348                            End If
2349                         End If
2350                         //
2351                         // remove commitment of  difference for partial shipment
2352                         //
2353                         If VA evt_CommitDifferenceExists is equal to "1"
                             Or VA evt_CachedQuantityBackordered is not equal to <Zero>
2354                            //
2355                            If VA evt_CommitDifferenceExists is equal to "1"
2356                               If VA evt_OriginalCommittedHS is equal to "C,H"
2357                                  VA evt_CommittedHS_Override = "H"
2358                               Else
2359                                  VA evt_CommittedHS_Override = "S"
2360                               End If
2361                            Else
2362                               VA evt_CommittedHS_Override = "S"
2363                            End If
2364                            If VA evt_CachedQuantityBackordered is not equal to <Zero>
2365                               //
2366                               // Retrieve the primary Location/Lot so that we can get the conversion factor
2367                               // for it.
2368                               F41021 Get Item Location Row
                                      VA evt_OriginalBranchPlant -> szBranchPlant
                                      VA evt_ItemNumber -> mnShortItemNumber
                                      VA evt_Location_BO_Cancel <- szLocation
                                      VA evt_Lot_BO_Cancel <- szLotNumber
                                      "4" -> mnIndex
                                      "3" -> mnKeys
                                      "1" -> cCallType
                                      "1" -> cSuppressErrorMessages
2369                               //
2370                               // If this is a potency item, AND the lot or branch plant has changed then
2371                               // retrieve the conversion factor for the original lot or branch plant.  This
2372                               // conversion factor is needed to reverse the original inventory commitments.
2373                               If VA evt_PotencyControl is equal to "Y"
2374                                  If VA evt_OriginalLot is not equal to BF szLot Or VA evt_OriginalBranchPlant is not equal to BF szBranchPlant
2375                                     If VA evt_OriginalLot is not equal to <Blank> And VA evt_OriginalLot is not equal to <Null> Or BF szLot is not equal to <Blank> And BF szLot is not equal to <Null>
2376                                        F41002 Get Item UoM Conversion
                                               VA evt_OriginalBranchPlant -> szBranchPlant
                                               BF szUnitOfMeasureAsInput -> szFromUnitOfMeasure
                                               VA evt_PricingUoM -> szToUnitOfMeasure
                                               VA evt_CachedQuantityBackordered -> mnQuantityToConvert
                                               VA evt_ItemMasterExists -> cInventoryInterfaceFlag
                                               VA evt_mnBackorderConvFactor_CNV1 <- mnConversionFactorFromToPrim
                                               VA evt_cPotencyMode_EV01 -> cPotencyMode
                                               VA evt_Lot_BO_Cancel -> szLotNumber
                                               VA evt_PotencyControl -> cPotencyControl
                                               VA evt_StandardPotency -> mnStandardPotency
                                               "1" -> cSuppressErrorMsg
                                               VA evt_ItemNumber -> mnShortItemNumber
                                               VA evt_PrimaryUoM -> szUOMToPrimary
                                               VA evt_StandardUoMConversion -> szStandardUOMConversion
2377                                     End If
2378                                  End If
2379                                  // ---------------------------------------------
2380                                  // SAR 7190599 - Add ELSE to assign conversion factor assignment for
2381                                  // non-potency control items
2382                               Else
2383                                  VA evt_mnBackorderConvFactor_CNV1 = VA evt_mnOriginalConvFactor_CNV1
2384                                  // End SAR 7190599
2385                                  // ---------------------------------------------
2386                                  //
2387                               End If
2388                               //
2389                               VA evt_Location_BO_Cancel = " "
2390                               VA evt_Lot_BO_Cancel = " "
2391                            Else
2392                               VA evt_Location_BO_Cancel = VA evt_OriginalLocation
2393                               VA evt_Lot_BO_Cancel = VA evt_OriginalLot
2394                               VA evt_mnBackorderConvFactor_CNV1 = VA evt_mnOriginalConvFactor_CNV1
2395                            End If
2396                            //
2397                            F41021 Update Order Commitment to Inventory
                                   VA evt_CachedItemNumber -> mnItemNumber
                                   VA evt_OriginalBranchPlant -> szBranchPlant
                                   VA evt_Location_BO_Cancel -> szLocation
                                   VA evt_Lot_BO_Cancel -> szLotNumber
                                   VA evt_ShippedDifferenceReversal -> mnShippingQuantity
                                   VA evt_CachedQuantityBackordered -> mnBackorderQuantity
                                   VA evt_mnOriginalConvFactor_CNV1 -> mnTransToPrimConvFactor
                                   VA evt_CommittedHS_Override -> cCommitmentFlag
                                   VA evt_CachedOtherQuantity12 -> cOtherQuantity12
                                   <Zero> -> cFutureCommitment
                                   "1" -> cReverseCommitment
                                   BF szProgramID -> szProgramId
                                   <Blank> -> cSuppressErrorMessage
                                   "1" -> cSuppressUpdateMRPFlag
                                   "1" -> cUseCacheFlag
                                   BF mnJobnumberA -> mnJobNo
                                   BF szUserId -> szUserID
                                   BF szWorkStationId -> szWorkStationID
                                   VA evt_TimeOfDay -> mnTimeOfDay
                                   VA evt_TodaysDate -> jdDate
                                   VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                                   VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
                                   VA evt_SecondaryShipDiffReversal -> mnDualQuantity
                                   VA evt_CachedConvFctScndtoScnPrim -> mnInputSecondToItemMasSecond
                                   VA evt_CachedConvFactorTrantoDual -> mnTransToSecondConvFactor
2398                            //
2399                         End If
2400                      End If
2401                   End If
2402                   //
2403                Else
2404                   // remove commitment for prior processed Multi Location child line
2405                   //
2406                   F41021 Update Order Commitment to Inventory
                          VA evt_CachedItemNumber -> mnItemNumber
                          VA evt_CachedBranchPlant -> szBranchPlant
                          VA evt_CachedLocation -> szLocation
                          VA evt_CachedLot -> szLotNumber
                          VA evt_CachedQuantityShipped -> mnShippingQuantity
                          <Zero> -> mnBackorderQuantity
                          VA evt_CachedConversionFactor -> mnTransToPrimConvFactor
                          VA evt_CachedCommittedFlag -> cCommitmentFlag
                          VA evt_OtherQuantityFlagOverride -> cOtherQuantity12
                          "1" -> cReverseCommitment
                          BF szProgramID -> szProgramId
                          <Blank> -> cSuppressErrorMessage
                          "1" -> cSuppressUpdateMRPFlag
                          "1" -> cUseCacheFlag
                          BF mnJobnumberA -> mnJobNo
                          BF szUserId -> szUserID
                          BF szWorkStationId -> szWorkStationID
                          VA evt_TimeOfDay -> mnTimeOfDay
                          VA evt_TodaysDate -> jdDate
                          VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                          VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
                          VA evt_CachedSecondaryQuantity -> mnDualQuantity
                          VA evt_CachedConvFctScndtoScnPrim -> mnInputSecondToItemMasSecond
                          VA evt_CachedConvFactorTrantoDual -> mnTransToSecondConvFactor
2407                   //
2408                End If
2409                //
2410             End If
2411             //
2412             // processing of commitments for changed lines
2413             //
2414             If BF cActionCode is not equal to "D"
                 And VA evt_EditsProcessedFlag is equal to "1"
2415                //
2416                // set commitment override flag depending on whether or not F4111 Edit Line is
2417                // called. When F4111 Edit Line is called, override should be <blank>.
2418                //
2419                // Other Quantity Flag will always be blank when adding a commitment.
2420                //
2421                VA evt_OtherQuantityFlagOverride = " "
2422                //
2423                If BF cActionCode is not equal to "S"
2424                   //
2425                   If VA evt_LocationCache is equal to <Null>
2426                      VA evt_CommitLocation = VA evt_OriginalLocation
2427                   Else
2428                      VA evt_CommitLocation = VA evt_LocationCache
2429                   End If
2430                   //
2431                   // adjust original commitment if a commitment related field has changed
2432                   //
2433                   // 7187023 - Consider the case of CI load for updating F41021 so that HCOM
2434                   // value is relieved
2435                   If VA evt_OriginalBranchPlant is not equal to BF szBranchPlant Or VA evt_OriginalLot is not equal to BF szLot Or VA evt_OriginalLocation is not equal to VA evt_CommitLocation Or VA evt_EditingTableShipQuantity is not equal to VA evt_EditingShippedQuantity Or VA evt_OriginalBackorderQuantity is not equal to BF mnEnteredBackorderQuantity Or VA evt_MultiLocationParentChange is equal to "1" Or VA evt_OtherCommitOverride is equal to "1" Or VA evt_OriginalCommittedHS is not equal to VA evt_CommitFlag Or BF cTRAN_InventoryAffectFlag is equal to "3"
2436                      // End SAR 7187023
2437                      //
2438                      If VA evt_OriginalCommittedHS is not equal to "K"
                          Or VA evt_GenerateWOFlag is equal to "Y"
2439                         //
2440                         // Commitments for reversal processing
2441                         //
2442                         If VA evt_CommitmentSignReversal is not equal to "1"
2443                            //
2444                            // remove original commitment
2445                            //
2446                            F41021 Update Order Commitment to Inventory
                                   VA evt_ItemNumber -> mnItemNumber
                                   VA evt_OriginalBranchPlant -> szBranchPlant
                                   VA evt_OriginalLocation -> szLocation
                                   VA evt_OriginalLot -> szLotNumber
                                   VA evt_TableQuantityShipped -> mnShippingQuantity
                                   VA evt_OriginalBackorderQuantity -> mnBackorderQuantity
                                   VA evt_mnOriginalConvFactor_CNV1 -> mnTransToPrimConvFactor
                                   VA evt_OriginalCommittedHS -> cCommitmentFlag
                                   VA evt_OtherQuantityFlag -> cOtherQuantity12
                                   "1" -> cReverseCommitment
                                   BF szProgramID -> szProgramId
                                   <Blank> -> cSuppressErrorMessage
                                   "1" -> cSuppressUpdateMRPFlag
                                   "1" -> cUseCacheFlag
                                   BF mnJobnumberA -> mnJobNo
                                   BF szUserId -> szUserID
                                   BF szWorkStationId -> szWorkStationID
                                   VA evt_TimeOfDay -> mnTimeOfDay
                                   VA evt_TodaysDate -> jdDate
                                   VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                                   VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
                                   VA evt_TableSecondaryQuantity -> mnDualQuantity
                                   VA evt_ConvFactorSecndtoScndPrime -> mnInputSecondToItemMasSecond
                                   VA evt_ConvFactorTranstoSecondary -> mnTransToSecondConvFactor
2447                            //
2448                            // add new commitment
2449                            //
2450                            // Do not call the B4200470 if the BF cTranInventoryAffectFlag = 3
2451                            //  Compartmentalize In-Transit Load
2452                            //
2453                            If BF cTRAN_InventoryAffectFlag is not equal to "3"
2454                               // SAR 7451586 - add flag to mark the the update as transaction related.
2455                               F41021 Update Order Commitment to Inventory
                                      VA evt_ItemNumber -> mnItemNumber
                                      BF szBranchPlant -> szBranchPlant
                                      VA evt_LocationCache -> szLocation
                                      BF szLot -> szLotNumber
                                      BF mnEnteredShipQuantity -> mnShippingQuantity
                                      <Zero> -> mnBackorderQuantity
                                      VA evt_ConversionFactor -> mnTransToPrimConvFactor
                                      VA evt_CommitFlag -> cCommitmentFlag
                                      VA evt_OtherQuantityFlagOverride -> cOtherQuantity12
                                      <Zero> -> cReverseCommitment
                                      BF szProgramID -> szProgramId
                                      <Blank> -> cSuppressErrorMessage
                                      "1" -> cSuppressUpdateMRPFlag
                                      "1" -> cUseCacheFlag
                                      BF mnJobnumberA -> mnJobNo
                                      BF szUserId -> szUserID
                                      BF szWorkStationId -> szWorkStationID
                                      VA evt_TimeOfDay -> mnTimeOfDay
                                      VA evt_TodaysDate -> jdDate
                                      VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                                      VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
                                      BF mnUnitsSecondaryQtyOr -> mnDualQuantity
                                      VA evt_ConvFactorSecndtoScndPrime -> mnInputSecondToItemMasSecond
                                      VA evt_ConvFactorTranstoSecondary -> mnTransToSecondConvFactor
                                      "1" -> cTransactionRelatedProcess
2456                            End If
2457                            //
2458                         Else
2459                            VA evt_CommitQuantityDifference = 0-[BF mnEnteredShipQuantity]
2460                            VA evt_CommitScndryQtyDifference = 0-[BF mnUnitsSecondaryQtyOr]
2461                         End If
2462                         //
2463                         // Account for commitment of partial credit orders
2464                         //
2465                         VA evt_CommitDifferenceExists = "0"
2466                         If VA evt_EditforDualUOM is not equal to "1"
2467                            If VA evt_CommitQuantityDifference is greater than <Zero>
                                And VA evt_OriginalOrderQuantity is greater than <Zero>
2468                               VA evt_CommitDifferenceExists = "1"
2469                            Else
2470                               If VA evt_CommitQuantityDifference is less than <Zero>
                                   And VA evt_OriginalOrderQuantity is less than <Zero>
2471                                  VA evt_CommitDifferenceExists = "1"
2472                               End If
2473                            End If
2474                         Else
2475                            If VA evt_CommitScndryQtyDifference is greater than <Zero>
                                And VA evt_OriginalOrderQuantity is greater than <Zero>
2476                               VA evt_CommitDifferenceExists = "1"
2477                            Else
2478                               If VA evt_CommitScndryQtyDifference is less than <Zero>
                                   And VA evt_OriginalOrderQuantity is less than <Zero>
2479                                  VA evt_CommitDifferenceExists = "1"
2480                               End If
2481                            End If
2482                         End If
2483                         //
2484                         // commit difference if partial shipment
2485                         //
2486                         If VA evt_CommitDifferenceExists is equal to "1"
                             Or BF mnEnteredBackorderQuantity is not equal to <Zero>
2487                            //
2488                            If VA evt_CommitDifferenceExists is equal to "1"
2489                               If VA evt_OriginalCommittedHS is equal to "C,H"
2490                                  VA evt_CommittedHS_Override = "H"
2491                               Else
2492                                  VA evt_CommittedHS_Override = "S"
2493                               End If
2494                            Else
2495                               VA evt_CommittedHS_Override = "S"
2496                            End If
2497                            If BF mnEnteredBackorderQuantity is not equal to <Zero>
2498                               //
2499                               // Retrieve the primary Location/Lot so that we can get the conversion factor
2500                               // for it.
2501                               F41021 Get Item Location Row
                                      VA evt_OriginalBranchPlant -> szBranchPlant
                                      VA evt_ItemNumber -> mnShortItemNumber
                                      VA evt_Location_BO_Cancel <- szLocation
                                      VA evt_Lot_BO_Cancel <- szLotNumber
                                      "4" -> mnIndex
                                      "3" -> mnKeys
                                      "1" -> cCallType
                                      "1" -> cSuppressErrorMessages
2502                               //
2503                               // If this is a potency item, AND the lot or branch plant has changed then
2504                               // retrieve the conversion factor for the original lot or branch plant.  This
2505                               // conversion factor is needed to reverse the original inventory commitements.
2506                               If VA evt_PotencyControl is equal to "Y"
2507                                  If VA evt_OriginalLot is not equal to BF szLot Or VA evt_OriginalBranchPlant is not equal to BF szBranchPlant
2508                                     If VA evt_OriginalLot is not equal to <Blank> And VA evt_OriginalLot is not equal to <Null> Or BF szLot is not equal to <Blank> And BF szLot is not equal to <Null>
2509                                        F41002 Get Item UoM Conversion
                                               VA evt_OriginalBranchPlant -> szBranchPlant
                                               BF szUnitOfMeasureAsInput -> szFromUnitOfMeasure
                                               VA evt_PricingUoM -> szToUnitOfMeasure
                                               BF mnEnteredShipQuantity -> mnQuantityToConvert
                                               VA evt_ItemMasterExists -> cInventoryInterfaceFlag
                                               VA evt_mnBackorderConvFactor_CNV1 <- mnConversionFactorFromToPrim
                                               VA evt_cPotencyMode_EV01 -> cPotencyMode
                                               VA evt_Lot_BO_Cancel -> szLotNumber
                                               VA evt_PotencyControl -> cPotencyControl
                                               VA evt_StandardPotency -> mnStandardPotency
                                               "1" -> cSuppressErrorMsg
                                               VA evt_ItemNumber -> mnShortItemNumber
                                               VA evt_PrimaryUoM -> szUOMToPrimary
                                               VA evt_StandardUoMConversion -> szStandardUOMConversion
2510                                     End If
2511                                  End If
2512                                  //
2513                                  // ---------------------------------------------
2514                                  // SAR 7190599 - Add ELSE to assign conversion factor assignment for
2515                                  // non-potency control items
2516                               Else
2517                                  VA evt_mnBackorderConvFactor_CNV1 = VA evt_mnOriginalConvFactor_CNV1
2518                                  // End SAR 7190599
2519                                  // ---------------------------------------------
2520                                  //
2521                               End If
2522                               //
2523                               VA evt_Location_BO_Cancel = " "
2524                               VA evt_Lot_BO_Cancel = " "
2525                            Else
2526                               VA evt_Location_BO_Cancel = VA evt_OriginalLocation
2527                               VA evt_Lot_BO_Cancel = VA evt_OriginalLot
2528                               VA evt_mnBackorderConvFactor_CNV1 = VA evt_mnOriginalConvFactor_CNV1
2529                            End If
2530                            //
2531                            F41021 Update Order Commitment to Inventory
                                   VA evt_ItemNumber -> mnItemNumber
                                   VA evt_OriginalBranchPlant -> szBranchPlant
                                   VA evt_Location_BO_Cancel -> szLocation
                                   VA evt_Lot_BO_Cancel -> szLotNumber
                                   VA evt_CommitQuantityDifference -> mnShippingQuantity
                                   BF mnEnteredBackorderQuantity -> mnBackorderQuantity
                                   VA evt_mnBackorderConvFactor_CNV1 -> mnTransToPrimConvFactor
                                   VA evt_CommittedHS_Override -> cCommitmentFlag
                                   VA evt_OtherQuantityFlag -> cOtherQuantity12
                                   <Zero> -> cFutureCommitment
                                   <Zero> -> cReverseCommitment
                                   BF szProgramID -> szProgramId
                                   <Blank> -> cSuppressErrorMessage
                                   "1" -> cSuppressUpdateMRPFlag
                                   "1" -> cUseCacheFlag
                                   BF mnJobnumberA -> mnJobNo
                                   BF szUserId -> szUserID
                                   BF szWorkStationId -> szWorkStationID
                                   VA evt_TimeOfDay -> mnTimeOfDay
                                   VA evt_TodaysDate -> jdDate
                                   VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                                   VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
                                   VA evt_CommitScndryQtyDifference -> mnDualQuantity
                                   VA evt_ConvFactorSecndtoScndPrime -> mnInputSecondToItemMasSecond
                                   VA evt_ConvFactorTranstoSecondary -> mnTransToSecondConvFactor
2532                            //
2533                         End If
2534                         //
2535                      End If
2536                   End If
2537                Else
2538                   // commitment Multi Location child line
2539                   //
2540                   // SAR 7451586 - add flag to mark the the update as transaction related.
2541                   F41021 Update Order Commitment to Inventory
                          VA evt_ItemNumber -> mnItemNumber
                          BF szBranchPlant -> szBranchPlant
                          VA evt_LocationCache -> szLocation
                          BF szLot -> szLotNumber
                          BF mnEnteredShipQuantity -> mnShippingQuantity
                          <Zero> -> mnBackorderQuantity
                          VA evt_ConversionFactor -> mnTransToPrimConvFactor
                          VA evt_CommitFlag -> cCommitmentFlag
                          VA evt_OtherQuantityFlagOverride -> cOtherQuantity12
                          <Zero> -> cReverseCommitment
                          BF szProgramID -> szProgramId
                          <Blank> -> cSuppressErrorMessage
                          "1" -> cSuppressUpdateMRPFlag
                          "1" -> cUseCacheFlag
                          BF mnJobnumberA -> mnJobNo
                          BF szUserId -> szUserID
                          BF szWorkStationId -> szWorkStationID
                          VA evt_TimeOfDay -> mnTimeOfDay
                          VA evt_TodaysDate -> jdDate
                          VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                          VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
                          BF mnUnitsSecondaryQtyOr -> mnDualQuantity
                          VA evt_ConvFactorSecndtoScndPrime -> mnInputSecondToItemMasSecond
                          VA evt_ConvFactorTranstoSecondary -> mnTransToSecondConvFactor
                          "1" -> cTransactionRelatedProcess
2542                   //
2543                End If
2544                //
2545             End If
2546             //
2547          End If
2548          //
2549       End If
2550       //
2551    End If
2552    // END COMMITMENTS PROCESSING
2553    //
2554    // ===============================================
2555    //    LOAD SHIP CONFIRM CACHE
2556    // ===============================================
2557    If BF cActionCode is not equal to "D"
2558       If BF cModeProcessing is not equal to "2"
2559          //   Cache records not written if ModeProcessing = 2,  ("Preliminary Edit Check"
2560          If BF cRecordWritten is not equal to "1"
2561             BF cRecordWritten = "1"
2562             //
2563             If BF mnTRAN_ShipmentNumber is less than or equal to <Zero>
                 And VA evt_Tran_ShipmentNumber is not equal to <Blank>
                 Or BF mnTRAN_ShipmentNumber is less than or equal to <Zero>
                 And VA evt_Tran_ShipmentNumber is not equal to <Null>
2564                BF mnTRAN_ShipmentNumber = VA evt_Tran_ShipmentNumber
2565             End If
2566             //
2567             // If setup for Dual edits, convert secondary order qty back to
2568             // secondary UOM and pass to the cache for end doc
2569             If VA evt_EditforDualUOM is equal to "1"
2570                VA evt_OriginalOrderQtySecondary = [VA evt_OriginalOrderQtySecondary]*[VA evt_ConvFactorTranstoSecondary]
2571                VA evt_OriginalOrderQtySecondary = round([VA evt_OriginalOrderQtySecondary],[VA evt_DecimalsforRounding_SQOR])
2572                //
2573                // Construct secondary order quantity for Multi Location parent.
2574                // An adjustment needs to be made to account for the conversion ration issues
2575                // associated with lines other than the parent line. This allows the parent
2576                // line to have a quantity that is not based upon a standard conversion ratio.
2577                //
2578                If BF cActionCode is equal to "P"
2579                   VA evt_OriginalOrderQtySecondary = [VA evt_OriginalOrderQtySecondary]+[VA evt_mnMultiLocDualAdjQty_SQOR]
2580                   //
2581                   // An additional adjustment needs to be made to the parent line quantity if
2582                   // the line is related to an over-ship transaction. This accounts for the
2583                   // rounding issues that occur in Calculate New Quantities when the Ship
2584                   // Difference amount is added to the Secondary Order Quantity.
2585                   //
2586                   If BF mnMultiLocSecondaryOrderQty is greater than <Zero> And BF mnMultiLocSecondaryQtyShipVar is greater than <Zero>
2587                      VA evt_OriginalOrderQtySecondary = [VA evt_OriginalOrderQtySecondary]+[VA evt_mnMultiLocDiffAdjQty_SQOR]
2588                   Else
2589                      If BF mnMultiLocSecondaryOrderQty is less than <Zero> And BF mnMultiLocSecondaryQtyShipVar is less than <Zero>
2590                         VA evt_OriginalOrderQtySecondary = [VA evt_OriginalOrderQtySecondary]+[VA evt_mnMultiLocDiffAdjQty_SQOR]
2591                      End If
2592                   End If
2593                End If
2594             End If
2595             // FutureUseMathNumeric 1 = DecimalsforRounding_SOQS
2596             // ============================================================
2597             // If sales order line is a kit parent, blank out Actual Shipment Time.
2598             // ============================================================
2599             If VA evt_CommitFlag is equal to "K" Or VA evt_LineNumberKitMaster is greater than <Zero>
2600                VA evt_mnWriteActualShipTime_ADTM = "0"
2601             Else
2602                VA evt_mnWriteActualShipTime_ADTM = BF mnActualShipmentTime
2603             End If
2604             // ============================================================
2605             // Pass evt_mnWriteActualShipTime_ADTM instead of BF mnActualShipmentTIme to
2606             // Load Or Unload Ship Confirm Cache
2607             // ============================================================
2608             // SAR 7461686-Calculate the Quantity Ordered in Primary UOM in variable VA
2609             // evt_QtyOrderedInPrimary
2610             VA evt_QtyOrderedInPrimary = [VA evt_OriginalOrderQuantity]*[VA evt_ConversionFactor]
2611 !             Load Or Unload Ship Confirm Cache
     !                BF mnOrderNumber -> mnOrderNumber
     !                BF szOrderType -> szOrderType
     !                BF szOrderCompany -> szOrderCompany
     !                BF mnLineNumber -> mnLineNumber
     !                VA evt_ItemNumber -> mnItemNumber
     !                BF szEnteredLineType -> szLineType
     !                VA evt_OriginalOrderQuantity -> mnQuantityOrdered
     !                BF mnEnteredShipQuantity -> mnQuantityShipped
     !                BF mnEnteredBackorderQuantity -> mnQuantityBackordered
     !                BF mnEnteredCancelQuantity -> mnQuantityCanceled
     !                BF szBranchPlant -> szBranchPlant
     !                VA evt_LocationCache -> szLocation
     !                BF szLot -> szLot
     !                VA evt_CommitFlag -> cCommitmentFlag
     !                VA evt_OtherQuantityFlag -> cOtherQuantityFlag
     !                VA evt_LastStatus -> szLastStatus
     !                VA evt_NextStatus -> szNextStatus
     !                VA evt_UpdateOnHandFlag -> cOnHandFlag
     !                BF jdActualDeliveryDate -> jdActualShipDate
     !                VA evt_CostLevel -> cCostLevel
     !                VA evt_UnitCost -> mnUnitCost
     !                VA evt_ExtendedCost -> mnExtendedCost
     !                VA evt_ForeignUnitCost -> mnForeignUnitCost
     !                VA evt_ForeignExtendedCost -> mnForeignExtendedCost
     !                VA evt_UnitPrice -> mnUnitPrice
     !                VA evt_ExtendedAmount -> mnExtendedAmount
     !                VA evt_ForeignUnitPrice -> mnForeignUnitPrice
     !                VA evt_ForeignExtendedAmount -> mnForeignExtendedPrice
     !                BF szContainerID -> szContainerID
     !                BF mnCarrier -> mnCarrierID
     !                VA evt_UnitWeight -> mnItemWeight
     !                VA evt_WeightUoM -> szWeightUOM
     !                VA evt_ApplyFreightFlag -> cApplyFreightFlag
     !                VA evt_CurrencyConversionRate -> mnCurrencyConverRate
     !                VA evt_FreightCalculated -> cFreightCalculated
     !                VA evt_FreightRateCode -> szFreightRateCode
     !                VA evt_AllowPartialShipments -> cAllowPartialShipments
     !                VA evt_SDAllowBackorders -> cSalesDetailBackorderFlag
     !                VA evt_RelatedItemNumber -> szRelatedItemNumber
     !                BF szUnitOfMeasureSecondary -> szSecondaryUOM
     !                VA evt_PricingUoM -> szPricingUOM
     !                VA evt_VolumeUoM -> szVolumeUOM
     !                VA evt_IMBackFlag -> cItemMasterBackorderFlag
     !                VA evt_IBBackFlag -> cItemBalanceBackorderFlag
     !                VA evt_PotencyControl -> cPotencyControl
     !                VA evt_StandardPotency -> mnStandardPotency
     !                VA evt_LotProcessingCode -> cLotProcessingCode
     !                VA evt_InventoryInterface -> cInventoryInterface
     !                VA evt_EditsProcessedFlag -> cEditsProcessedFlag
     !                "1" -> cSuppressErrorMessage
     !                BF mnWorkFileLineNumber <- mnCacheLineNumber
     !                "A" -> cObsoleteCode
     !                VA evt_CurrencyCode -> szCurrencyCode
     !                <Zero> -> cOpenCacheCursorFlag
     !                VA evt_WriteLedgerFlag -> cWriteLedgerFlag
     !                VA evt_ConversionFactor -> mnConversionFactor
     !                <Blank> -> cCallType
     !                BF mnLineNumber -> mnLastLineNumAssign
     !                BF mnJobnumberA -> mnJobNumberA
     !                BF szComputerID -> szComputerID
     !                VA evt_X4111Z1CacheLineNum -> mnX4111Z1CacheLineNum
     !                VA evt_B4200310CacheLineNum -> mnB4200310CacheLineNum
     !                VA evt_RecordWrittentoB4200310 -> cRecordWrittenToWFB4200310
     !                BF cActionCode -> cSODetailActionCode
     !                BF mnTRAN_TimeLoad -> mnActualShipTime
     !                BF jdTRAN_DeliveryDate -> jdActualDeliveryDate
     !                BF cTRAN_InventoryAffectFlag -> cInventoryAffectFlag
     !                BF mnTRAN_ShipmentNumber -> mnShipmentNumber
     !                BF mnBULK_AmbientQtyEntered -> mnAmbientVolume
     !                BF szBULK_AmbientQtyEnteredUOM -> szAmbientVolumeUOM
     !                BF mnBULK_StandardQtyEntered -> mnStandardVolume
     !                BF szBULK_StandardQtyEnteredUOM -> szStandardVolumeUOM
     !                BF mnBULK_WeightQtyEntered -> mnWeightQuantity
     !                BF szBULK_WeightQtyEnteredUOM -> szWeightQuantityUOM
     !                BF mnBULK_Temperature -> mnTemperature
     !                BF cBULK_ProductTemperatureType -> cTemperatureType
     !                BF mnBULK_ProductDensity -> mnDensity
     !                BF cBULK_ProductDensityType -> cDensityType
     !                BF mnBULK_DensityTemperature -> mnDensityTemperature
     !                BF cBULK_DensityTemperatureType -> cDensityTemperatureType
     !                BF mnBULK_TransactionTime -> mnTransactionTime
     !                VA evt_OtherCommitOverride -> cOHInventoryRelievedFlag
     !                BF mnBulk_VolumeCorrectionFactors -> mnVolumeCorrectionFactors
     !                BF mnOriginal_LineNumber_3 -> mnOriginalLineNumber
     !                VA evt_ValidateStatusCode -> cValidateStatusCode
     !                VA evt_SerialNumberRequired -> cSerialNumberRequired
     !                BF szUnitOfMeasureAsInput -> szUnitOfMeasureAsInput
     !                VA evt_MPSP_PlanFenceRule -> cPlanTimeFenceRule
     !                VA evt_newPrimaryShipQuantity -> mnQtyCountedInPrimary
     !                VA evt_UnitVolume -> mnAmountUnitVolume
     !                BF mnUnitsSecondaryQtyOr -> mnUnitsSecondaryQtyOr
     !                "6" -> mnNumberKeys
     !                "2" -> szCacheActionCode
     !                VA evt_SoldToTable -> mnAddressNumber
     !                BF mnAddressNumberShipTo -> mnAddressNumberShipTo
     !                VA evt_TransactionDateF4211 -> jdDateTransactionJulian
     !                VA evt_TransferUnitCost -> mnExtendedCostTransfer
     !                VA evt_InterbranchOrderFlag -> cInterbranchSalesFlag
     !                VA evt_NextStatusSplit -> szNextStatusCodeSplit
     !                VA evt_CurrencyCodeSellingBranch -> szSellingCompanyCurrecyCode
     !                BF mnContractSupplementDistri -> mnContractSupplementDistri
     !                BF szContractNumberDistributi -> szContractNumberDistributi
     !                BF szTRAN_PrimaryVehicleId -> szPrimaryVehicleId
     !                BF szTRAN_RegistrationLicenseNum -> szRegistrationLicenseNumbe
     !                VA evt_UpdateSalesAgreement -> szUpdateSalesAgreement
     !                BF jdTRAN_LoadConfirmDate -> jdLoadConfirmDate
     !                BF mnTRAN_TimeLoad -> mnTimeLoad
     !                VA evt_F4101_BulkPackFlag -> cBulkPackedFlag
     !                VA evt_BorrowSourceAgreement -> szAGREE_ProductSource
     !                VA evt_BorrowSourceTypeAgreement -> szAGREE_ProductSourceType
     !                VA evt_BorrowSequenceAgreement -> mnAGREE_SequenceNumber1
     !                VA evt_ShipDateOverridden_SO07 -> cShipDateOverridden
     !                VA evt_ModeOfTransport_MOT -> szModeOfTransport
     !                VA evt_PurchasingReportCode1_PRP1 -> szPurchasingReportCode1
     !                BF szTRAN_OverrideNextStatus -> szTranOverride_NXTR
     !                VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
     !                VA evt_DualPickingProcessOption -> cDualPickingProcessOption
     !                VA evt_ConvFactorTranstoSecondary -> mnConversionFactorTrantoSecnd
     !                VA evt_ConvFactorSecondarytoTrans -> mnConvFactorSecondarytoTrans
     !                VA evt_ConvFactorSecndtoScndPrime -> mnConvFactorScndrytoScndPrime
     !                VA evt_OriginalOrderQtySecondary -> mnOrderQuantityinSecondaryUOM
     !                BF cCheckExpirationDate -> cCheckExpirationDate
     !                BF cCheckSellByDate -> cCheckSellByDate
     !                BF cCheckBestBeforeDate -> cCheckBestBeforeDate
     !                BF jdBestBeforeDate -> jdBestBeforeDate
     !                BF jdSellByDate -> jdSellByDate
     !                VA evt_InventoryCommitPref_SO06 -> cPrefLotBasedOnDates
     !                BF jdDateLotExpiration -> jdDateLotExpiration
     !                VA evt_CommitmentDateMethod_CMDM -> cCommitmentDateMethod
     !                VA evt_LineType -> szLineTypeTable_LNTY
     !                VA evt_TableQuantityOrdered -> mnOrderQtyTable_UORG
     !                VA evt_TableQuantityShipped -> mnShipQtyTable_SOQS
     !                VA evt_BackorderQtyTable_SOBK -> mnBackorderQtyTable_SOBK
     !                VA evt_CancelQtyTable_SOCN -> mnCancelQtyTable_SOCN
     !                VA evt_OriginalBranchPlant -> szBranchPlantTable_MCU
     !                VA evt_OriginalLocation -> szLocationTable_LOCN
     !                VA evt_OriginalLot -> szLotNumberTable_LOTN
     !                VA evt_OriginalCommittedHS -> cCommitFlagTable_COMM
     !                VA evt_NextStatusTable -> szNextStatusTable_NXTR
     !                VA evt_OnHandFlagF4211_SO02 -> cOnHandFlagF4211_SO02
     !                VA evt_UnitCostTable_UNCS -> mnUnitCostTable_UNCS
     !                VA evt_CostExtendedTable_ECST -> mnCostExtendedTable_ECST
     !                VA evt_ForeignUnitCostTable_FUC -> mnForeignUnitCostTable_FUC
     !                VA evt_ForeignExtCostTable_FEC -> mnForeignExtCostTable_FEC
     !                VA evt_ExtendedPriceTable_AEXP -> mnExtendedPriceTable_AEXP
     !                VA evt_ForeignExtPriceTable_FEA -> mnForeignExtPriceTable_FAP
     !                VA evt_ContainerID -> szContainerIDTable_CNID
     !                VA evt_CarrierID -> mnCarrierTable_CARS
     !                VA evt_ItemWeight -> mnItemWeightTable_ITWT
     !                VA evt_CurrencyCode -> szCurrencyCodeTable_CRCD
     !                VA evt_PrimaryUoM -> szPrimaryUoMTable_UOM1
     !                VA evt_ScheduledPickDate4211_PDDJ -> jdSchedPickDateTable_PDDJ
     !                VA evt_szIdentifier2ndItem_LITM -> szItemNumber2nd_LITM
     !                VA evt_szIdentifier3rdItem_AITM -> szItemNumber3rd_AITM
     !                VA evt_Company_F4211 -> szCompany_Table_CO
     !                VA evt_PickSlipNumberTable_PSN -> mnPickSlipNumbTable_PSN
     !                VA evt_ItemVolumeTable_ITVL -> mnItemVolumeTable_ITVL
     !                VA evt_CostOverrideFlag -> cCostOverrideFlagTable_CSTO
     !                VA evt_PrimaryQtyOrderTable_PQOR -> mnPrimaryOrderQtyTable_PQOR
     !                VA evt_TableSecondaryQuantity -> mnSecondOrderQtyTable_SQOR
     !                VA evt_RequestedDate_F4211_DRQJ -> jdDateRequestedTable_DRQJ
     !                VA evt_DateReleaseTable_RSDJ -> jdDateReleaseTable_RSDJ
     !                VA evt_Sales_AgreementNum_DMCT -> szSalesAgreementNumb_DMCT
     !                VA evt_Sales_AgreementSuppy_DMCS -> mnSalesAgreementSupp_DMCS
     !                VA evt_UpdateGL_Accomadations -> cUpdateGLAccommodations_UPGL
     !                VA evt_ConvFactPricToPrim -> mnConvFactPricToPrim_CNV1
     !                VA evt_StandardUOMConversion_TFLA -> szStandardUOMConversion_TFLA
     !                VA evt_WarehouseOnFlag_WCTL -> cWarehouseOnFlag_WCTL
     !                VA evt_TextLineYN -> cTextLineYN
     !                VA evt_ShipDateF4211Table_ADDJ -> jdShipDateF4211Table_ADDJ
     !                BF szPortOfEntryExit -> szPortOfEntryExit
     !                VA evt_UpdateLastShipmentTableYN -> cFutureUseChar01
     !                VA evt_DecimalsforRounding_SOQS -> mnFutureUseMathNum01
     !                VA evt_DatePromisedPickF4211_PPDJ -> jdDatePromisedPickTable
     !                VA evt_FreightHandlingCodeF4211 -> szFreightHandlingCodeTable
     !                VA evt_SecondaryPrimaryUoM -> szSecondaryPrimaryUOM
     !                VA evt_mnWriteActualShipTime_ADTM -> mnActualShipTimeP4205Cache
     !                VA evt_mnActualShipTimeTable_ADTM -> mnActualShipTimeTable
     !                VA evt_mnReqDeliverTimeTable_DRQT -> mnRequestedDeliveryTime
     !                VA evt_mnPromisedPickTimeTbl_PDTT -> mnPromisedShipmentTime
     !                VA evt_mnPromisedDlvrTimeTbl_RSDT -> mnPromisedDeliveryTime
     !                VA evt_PriceAmbientStandardF49211 -> cPriceatAmbiantorStandard
     !                VA evt_szItemNumberPrimary_UITM -> szItemNumberPrimary
     !                VA evt_szCompany_Cache_CO -> szCompany_Cache_CO
     !                VA evt_StatusInWarehouse -> cStatusInWarehouse
     !                VA evt_jdCancelDate_CNDJ -> jdCancelDate
     !                VA evt_szGlCategory_Cache_GLPT -> szGlCategory_Cache
2612             // Pass VA evt_QtyOrderedInPrimary to mnQtyCountedInPrimary instead of VA
2613             // evt_newPrimaryShipQuantity
2614             Load Or Unload Ship Confirm Cache
                    BF mnOrderNumber -> mnOrderNumber
                    BF szOrderType -> szOrderType
                    BF szOrderCompany -> szOrderCompany
                    BF mnLineNumber -> mnLineNumber
                    VA evt_ItemNumber -> mnItemNumber
                    BF szEnteredLineType -> szLineType
                    VA evt_OriginalOrderQuantity -> mnQuantityOrdered
                    BF mnEnteredShipQuantity -> mnQuantityShipped
                    BF mnEnteredBackorderQuantity -> mnQuantityBackordered
                    BF mnEnteredCancelQuantity -> mnQuantityCanceled
                    BF szBranchPlant -> szBranchPlant
                    VA evt_LocationCache -> szLocation
                    BF szLot -> szLot
                    VA evt_CommitFlag -> cCommitmentFlag
                    VA evt_OtherQuantityFlag -> cOtherQuantityFlag
                    VA evt_LastStatus -> szLastStatus
                    VA evt_NextStatus -> szNextStatus
                    VA evt_UpdateOnHandFlag -> cOnHandFlag
                    BF jdActualDeliveryDate -> jdActualShipDate
                    VA evt_CostLevel -> cCostLevel
                    VA evt_UnitCost -> mnUnitCost
                    VA evt_ExtendedCost -> mnExtendedCost
                    VA evt_ForeignUnitCost -> mnForeignUnitCost
                    VA evt_ForeignExtendedCost -> mnForeignExtendedCost
                    VA evt_UnitPrice -> mnUnitPrice
                    VA evt_ExtendedAmount -> mnExtendedAmount
                    VA evt_ForeignUnitPrice -> mnForeignUnitPrice
                    VA evt_ForeignExtendedAmount -> mnForeignExtendedPrice
                    BF szContainerID -> szContainerID
                    BF mnCarrier -> mnCarrierID
                    VA evt_UnitWeight -> mnItemWeight
                    VA evt_WeightUoM -> szWeightUOM
                    VA evt_ApplyFreightFlag -> cApplyFreightFlag
                    VA evt_CurrencyConversionRate -> mnCurrencyConverRate
                    VA evt_FreightCalculated -> cFreightCalculated
                    VA evt_FreightRateCode -> szFreightRateCode
                    VA evt_AllowPartialShipments -> cAllowPartialShipments
                    VA evt_SDAllowBackorders -> cSalesDetailBackorderFlag
                    VA evt_RelatedItemNumber -> szRelatedItemNumber
                    BF szUnitOfMeasureSecondary -> szSecondaryUOM
                    VA evt_PricingUoM -> szPricingUOM
                    VA evt_VolumeUoM -> szVolumeUOM
                    VA evt_IMBackFlag -> cItemMasterBackorderFlag
                    VA evt_IBBackFlag -> cItemBalanceBackorderFlag
                    VA evt_PotencyControl -> cPotencyControl
                    VA evt_StandardPotency -> mnStandardPotency
                    VA evt_LotProcessingCode -> cLotProcessingCode
                    VA evt_InventoryInterface -> cInventoryInterface
                    VA evt_EditsProcessedFlag -> cEditsProcessedFlag
                    "1" -> cSuppressErrorMessage
                    BF mnWorkFileLineNumber <- mnCacheLineNumber
                    "A" -> cObsoleteCode
                    VA evt_CurrencyCode -> szCurrencyCode
                    <Zero> -> cOpenCacheCursorFlag
                    VA evt_WriteLedgerFlag -> cWriteLedgerFlag
                    VA evt_ConversionFactor -> mnConversionFactor
                    <Blank> -> cCallType
                    BF mnLineNumber -> mnLastLineNumAssign
                    BF mnJobnumberA -> mnJobNumberA
                    BF szComputerID -> szComputerID
                    VA evt_X4111Z1CacheLineNum -> mnX4111Z1CacheLineNum
                    VA evt_B4200310CacheLineNum -> mnB4200310CacheLineNum
                    VA evt_RecordWrittentoB4200310 -> cRecordWrittenToWFB4200310
                    BF cActionCode -> cSODetailActionCode
                    BF mnTRAN_TimeLoad -> mnActualShipTime
                    BF jdTRAN_DeliveryDate -> jdActualDeliveryDate
                    BF cTRAN_InventoryAffectFlag -> cInventoryAffectFlag
                    BF mnTRAN_ShipmentNumber -> mnShipmentNumber
                    BF mnBULK_AmbientQtyEntered -> mnAmbientVolume
                    BF szBULK_AmbientQtyEnteredUOM -> szAmbientVolumeUOM
                    BF mnBULK_StandardQtyEntered -> mnStandardVolume
                    BF szBULK_StandardQtyEnteredUOM -> szStandardVolumeUOM
                    BF mnBULK_WeightQtyEntered -> mnWeightQuantity
                    BF szBULK_WeightQtyEnteredUOM -> szWeightQuantityUOM
                    BF mnBULK_Temperature -> mnTemperature
                    BF cBULK_ProductTemperatureType -> cTemperatureType
                    BF mnBULK_ProductDensity -> mnDensity
                    BF cBULK_ProductDensityType -> cDensityType
                    BF mnBULK_DensityTemperature -> mnDensityTemperature
                    BF cBULK_DensityTemperatureType -> cDensityTemperatureType
                    BF mnBULK_TransactionTime -> mnTransactionTime
                    VA evt_OtherCommitOverride -> cOHInventoryRelievedFlag
                    BF mnBulk_VolumeCorrectionFactors -> mnVolumeCorrectionFactors
                    BF mnOriginal_LineNumber_3 -> mnOriginalLineNumber
                    VA evt_ValidateStatusCode -> cValidateStatusCode
                    VA evt_SerialNumberRequired -> cSerialNumberRequired
                    BF szUnitOfMeasureAsInput -> szUnitOfMeasureAsInput
                    VA evt_MPSP_PlanFenceRule -> cPlanTimeFenceRule
                    VA evt_QtyOrderedInPrimary -> mnQtyCountedInPrimary
                    VA evt_UnitVolume -> mnAmountUnitVolume
                    BF mnUnitsSecondaryQtyOr -> mnUnitsSecondaryQtyOr
                    "6" -> mnNumberKeys
                    "2" -> szCacheActionCode
                    VA evt_SoldToTable -> mnAddressNumber
                    BF mnAddressNumberShipTo -> mnAddressNumberShipTo
                    VA evt_TransactionDateF4211 -> jdDateTransactionJulian
                    VA evt_TransferUnitCost -> mnExtendedCostTransfer
                    VA evt_InterbranchOrderFlag -> cInterbranchSalesFlag
                    VA evt_NextStatusSplit -> szNextStatusCodeSplit
                    VA evt_CurrencyCodeSellingBranch -> szSellingCompanyCurrecyCode
                    BF mnContractSupplementDistri -> mnContractSupplementDistri
                    BF szContractNumberDistributi -> szContractNumberDistributi
                    BF szTRAN_PrimaryVehicleId -> szPrimaryVehicleId
                    BF szTRAN_RegistrationLicenseNum -> szRegistrationLicenseNumbe
                    VA evt_UpdateSalesAgreement -> szUpdateSalesAgreement
                    BF jdTRAN_LoadConfirmDate -> jdLoadConfirmDate
                    BF mnTRAN_TimeLoad -> mnTimeLoad
                    VA evt_F4101_BulkPackFlag -> cBulkPackedFlag
                    VA evt_BorrowSourceAgreement -> szAGREE_ProductSource
                    VA evt_BorrowSourceTypeAgreement -> szAGREE_ProductSourceType
                    VA evt_BorrowSequenceAgreement -> mnAGREE_SequenceNumber1
                    VA evt_ShipDateOverridden_SO07 -> cShipDateOverridden
                    VA evt_ModeOfTransport_MOT -> szModeOfTransport
                    VA evt_PurchasingReportCode1_PRP1 -> szPurchasingReportCode1
                    BF szTRAN_OverrideNextStatus -> szTranOverride_NXTR
                    VA evt_DualUnitOfMeasureItem -> cDualUnitOfMeasureItem
                    VA evt_DualPickingProcessOption -> cDualPickingProcessOption
                    VA evt_ConvFactorTranstoSecondary -> mnConversionFactorTrantoSecnd
                    VA evt_ConvFactorSecondarytoTrans -> mnConvFactorSecondarytoTrans
                    VA evt_ConvFactorSecndtoScndPrime -> mnConvFactorScndrytoScndPrime
                    VA evt_OriginalOrderQtySecondary -> mnOrderQuantityinSecondaryUOM
                    BF cCheckExpirationDate -> cCheckExpirationDate
                    BF cCheckSellByDate -> cCheckSellByDate
                    BF cCheckBestBeforeDate -> cCheckBestBeforeDate
                    BF jdBestBeforeDate -> jdBestBeforeDate
                    BF jdSellByDate -> jdSellByDate
                    VA evt_InventoryCommitPref_SO06 -> cPrefLotBasedOnDates
                    BF jdDateLotExpiration -> jdDateLotExpiration
                    VA evt_CommitmentDateMethod_CMDM -> cCommitmentDateMethod
                    VA evt_LineType -> szLineTypeTable_LNTY
                    VA evt_TableQuantityOrdered -> mnOrderQtyTable_UORG
                    VA evt_TableQuantityShipped -> mnShipQtyTable_SOQS
                    VA evt_BackorderQtyTable_SOBK -> mnBackorderQtyTable_SOBK
                    VA evt_CancelQtyTable_SOCN -> mnCancelQtyTable_SOCN
                    VA evt_OriginalBranchPlant -> szBranchPlantTable_MCU
                    VA evt_OriginalLocation -> szLocationTable_LOCN
                    VA evt_OriginalLot -> szLotNumberTable_LOTN
                    VA evt_OriginalCommittedHS -> cCommitFlagTable_COMM
                    VA evt_NextStatusTable -> szNextStatusTable_NXTR
                    VA evt_OnHandFlagF4211_SO02 -> cOnHandFlagF4211_SO02
                    VA evt_UnitCostTable_UNCS -> mnUnitCostTable_UNCS
                    VA evt_CostExtendedTable_ECST -> mnCostExtendedTable_ECST
                    VA evt_ForeignUnitCostTable_FUC -> mnForeignUnitCostTable_FUC
                    VA evt_ForeignExtCostTable_FEC -> mnForeignExtCostTable_FEC
                    VA evt_ExtendedPriceTable_AEXP -> mnExtendedPriceTable_AEXP
                    VA evt_ForeignExtPriceTable_FEA -> mnForeignExtPriceTable_FAP
                    VA evt_ContainerID -> szContainerIDTable_CNID
                    VA evt_CarrierID -> mnCarrierTable_CARS
                    VA evt_ItemWeight -> mnItemWeightTable_ITWT
                    VA evt_CurrencyCode -> szCurrencyCodeTable_CRCD
                    VA evt_PrimaryUoM -> szPrimaryUoMTable_UOM1
                    VA evt_ScheduledPickDate4211_PDDJ -> jdSchedPickDateTable_PDDJ
                    VA evt_szIdentifier2ndItem_LITM -> szItemNumber2nd_LITM
                    VA evt_szIdentifier3rdItem_AITM -> szItemNumber3rd_AITM
                    VA evt_Company_F4211 -> szCompany_Table_CO
                    VA evt_PickSlipNumberTable_PSN -> mnPickSlipNumbTable_PSN
                    VA evt_ItemVolumeTable_ITVL -> mnItemVolumeTable_ITVL
                    VA evt_CostOverrideFlag -> cCostOverrideFlagTable_CSTO
                    VA evt_PrimaryQtyOrderTable_PQOR -> mnPrimaryOrderQtyTable_PQOR
                    VA evt_TableSecondaryQuantity -> mnSecondOrderQtyTable_SQOR
                    VA evt_RequestedDate_F4211_DRQJ -> jdDateRequestedTable_DRQJ
                    VA evt_DateReleaseTable_RSDJ -> jdDateReleaseTable_RSDJ
                    VA evt_Sales_AgreementNum_DMCT -> szSalesAgreementNumb_DMCT
                    VA evt_Sales_AgreementSuppy_DMCS -> mnSalesAgreementSupp_DMCS
                    VA evt_UpdateGL_Accomadations -> cUpdateGLAccommodations_UPGL
                    VA evt_ConvFactPricToPrim -> mnConvFactPricToPrim_CNV1
                    VA evt_StandardUOMConversion_TFLA -> szStandardUOMConversion_TFLA
                    VA evt_WarehouseOnFlag_WCTL -> cWarehouseOnFlag_WCTL
                    VA evt_TextLineYN -> cTextLineYN
                    VA evt_ShipDateF4211Table_ADDJ -> jdShipDateF4211Table_ADDJ
                    BF szPortOfEntryExit -> szPortOfEntryExit
                    VA evt_UpdateLastShipmentTableYN -> cFutureUseChar01
                    VA evt_DecimalsforRounding_SOQS -> mnFutureUseMathNum01
                    VA evt_DatePromisedPickF4211_PPDJ -> jdDatePromisedPickTable
                    VA evt_FreightHandlingCodeF4211 -> szFreightHandlingCodeTable
                    VA evt_SecondaryPrimaryUoM -> szSecondaryPrimaryUOM
                    VA evt_mnWriteActualShipTime_ADTM -> mnActualShipTimeP4205Cache
                    VA evt_mnActualShipTimeTable_ADTM -> mnActualShipTimeTable
                    VA evt_mnReqDeliverTimeTable_DRQT -> mnRequestedDeliveryTime
                    VA evt_mnPromisedPickTimeTbl_PDTT -> mnPromisedShipmentTime
                    VA evt_mnPromisedDlvrTimeTbl_RSDT -> mnPromisedDeliveryTime
                    VA evt_PriceAmbientStandardF49211 -> cPriceatAmbiantorStandard
                    VA evt_szItemNumberPrimary_UITM -> szItemNumberPrimary
                    VA evt_szCompany_Cache_CO -> szCompany_Cache_CO
                    VA evt_StatusInWarehouse -> cStatusInWarehouse
                    VA evt_jdCancelDate_CNDJ -> jdCancelDate
                    VA evt_szGlCategory_Cache_GLPT -> szGlCategory_Cache
2615             // End SAR  7461686
2616             If BF cTRAN_InventoryAffectFlag is equal to "2"
2617                If VA evt_HDR_GLJobNumber is greater than <Zero> And VA evt_XT4111_F0911JobNumber is equal to <Zero>
2618                   VA evt_XT4111_F0911JobNumber = VA evt_HDR_GLJobNumber
2619                End If
2620                Load Or Unload Ship Confirm Hdr Cache
                       "7" -> szCacheActionCode
                       "2" -> mnNumberKeys
                       "1" -> cSuppressErrorMessage
                       BF mnJobnumberA -> mnJobnumberA
                       VA evt_XT4111_F0911JobNumber -> mnInventoryJobnumberA
                       VA evt_XT4111_F0911JobNumber -> mnGLJobnumberA
                       VA evt_HDR_BatchNumber -> mnBatchNumber
                       VA evt_HDR_BatchStatus -> cBatchStatus
                       VA evt_HDR_LastJELine -> mnLastJELine
                       VA evt_HDR_OverrideDocNumber -> mnDocVoucherInv
                       VA evt_HDR_OverrideDocType -> szDocumentType
                       VA evt_HDR_OverrideCompanyKey -> szCompanyKey
                       BF szComputerID -> szComputerID
                       VA evt_HDR_LastOverrideLineNumber -> mnLastOverrideLineNo
2621             End If
2622             If VA evt_ConstAndPOCacheWrittenFlag is not equal to "Y"
2623                Load or Unload Ship Confirm Constants/POCache
                       BF mnJobnumberA -> mnJobNumber
                       BF szComputerID -> szComputerID
                       "2" -> szCacheActionCode
                       "2" -> mnNumberKeys
                       "1" -> cSuppressErrorMessage
                       VA evt_PO_NextStatusConfirm -> szPO_NextStatusConfirm
                       VA evt_PO_NextStatusAddlLine -> szPO_NextStatusAddlLine
                       VA evt_PO_NextStatusBackOrder -> szPO_NextStatusBackOrder
                       VA evt_PO_CheckAvailability -> cPO_CheckAvailability
                       VA evt_PO_PreventNegOnHand -> cPO_PreventNegOnHand
                       VA evt_PO_PreventOverShip -> cPO_PreventOverShip
                       VA evt_PO_BackCancelRemainQty -> cPO_BackCancelRemainQty
                       VA evt_PO_ErrorLocationOnHold -> cPO_ErrorLocationOnHold
                       VA evt_PO_VersionR42565 -> szPO_VersionR42565
                       VA evt_PO_DisplayKitItems -> cPO_DisplayKitItems
                       VA evt_TestResultsVersion -> szPO_TestResultsVersion
                       VA evt_CertificateAnalyFlag -> cPO_CertificateAnalyFlag
                       VA evt_CertificateAnalyVersion -> szPO_CertificateAnalyVersion
                       VA evt_PO_AgreementDestination -> szPO_AgreementDestination
                       VA evt_PO_AgreementBPFlag -> cPO_AgreementBPFlag
                       VA evt_PO_AgreementSearchFlag -> cPO_AgreementSearchFlag
                       VA evt_PO_OutboundEDITTypeTran -> szPO_OutboundEDITTypeTran
                       VA evt_PO_OutboundUBERun -> cPO_OutboundUBERun
                       VA evt_PO_BulkTransactVolFlagEV01 -> cPO_BulkTransactVolFlag
                       VA evt_PO_R4210ICVersion -> szPO_R4210ICVersion
                       VA evt_PO_CreateIntercoOrder -> cPO_CreateIntercoOrder
                       VA evt_PO_OverrideRelieveOnHand -> cPO_OverrideRelieveOnHand
                       VA evt_PO_QM_COAProcessFlag -> cPO_QM_COAProcessFlag
                       VA evt_cPO_QMReEvalTestRslts_EV01 -> cPO_QMReEvalTestRslts
                       VA evt_PO_AutoPrintInvoice -> szPO_AutoPrintInvoice
                       VA evt_PO_PrepaymentProcessing -> cPO_PrepaymentProcessing
                       VA evt_PO_Prepay_AuthorizeVersion -> szPO_Prepay_AuthorizeVersion
                       VA evt_PO_Prepay_SettleVersion -> szPO_Prepay_SettleVersion
                       VA evt_PO_Prepay_AuthorizeHold -> szPO_Prepay_AuthorizeHold
                       VA evt_PO_Prepay_SettleHold -> szPO_Prepay_SettleHold
                       VA evt_PO_Prepay_AuthorizeStatus -> szPO_Prepay_AuthorizeStatus
                       VA evt_PO_Prepay_SettleStatus -> szPO_Prepay_SettleStatus
                       VA evt_PO_Prepay_AuthorizeProcess -> cPO_Prepay_AuthorizeProcess
                       VA evt_PO_Prepay_SettleProcess -> cPO_Prepay_SettleProcess
                       VA evt_PO_CallR45100Mode -> cPO_CallR45100Mode
                       VA evt_PO_R45100Version -> szPO_R45100Version
                       VA evt_PO_R42950SubmitUpdate -> cPO_R42950SubmitUpdate
                       VA evt_PO_R42950Version -> szPO_R42950Version
                       VA evt_PO_SADWarningError_EV01 -> cPO_SADWarningError
                       VA evt_PO_AllowNewLot4CreditOrder -> cPO_NewLotsForCO
                       VA evt_TodaysDate -> jdTodaysDate
                       VA evt_TimeOfDay -> mnTimeOfDay
                       VA evt_BulkUseManagementFlag -> cBulkUseMgmtFlag
                       VA evt_cQualityMgmtInstalled_EV01 -> cQualityMgmtInstalled
                       VA evt_PriceRetrievalUOM_UMB1 -> cPriceRetrievalUOM
                       BF cShipAscendingDateFlag -> cShipAscendingDateFlag
                       VA evt_cDemandSchedReleased_DSRFU -> cFutureUseChar01
                       VA evt_UserId -> szUserId
                       VA evt_szCnfrmtnCartonStatus_CRSS -> szMinimumCartonStatus
                       VA evt_cPOReconcilCartonShip_RCSD -> cReconcileCartonShipmentDe
                       VA evt_cUseNextOrderStsPref_UNOP -> cUse_Next_Order_Status_Pre
                       VA evt_PO_LotGroupName_LOTGRP -> szLotGroup
                       VA evt_cPricingBasedOnDate_CP01 -> cPricingBasedOnDate
2624             End If
2625             //
2626          End If
2627       Else
2628          //   Cache record not written for "Preliminary Edit Checks".
2629          //   Indicate this to the calling Application.
2630          BF cRecordWritten = "0"
2631       End If
2632       //
2633       //  **********
2634       //         Set Error Condition Flag to be sent back to calling Application:
2635       //         Success = "",   Warning = 1,    Error = 2
2636       // **********
2637       If VA evt_EditsProcessedFlag is equal to "1"
2638          BF cErrorConditions = " "
2639       Else
2640          BF cErrorConditions = "2"
2641       End If
2642       //
2643       // Report Warning if data edits discovered warning, but no errors.
2644       If VA evt_2716WarningFlag is equal to "1"
           And VA evt_EditsProcessedFlag is equal to "1"
2645          BF cErrorConditions = "1"
2646       Else
2647          If VA evt_c109YWarningFlag_EV01 is equal to "1"
              And VA evt_EditsProcessedFlag is equal to "1"
2648             BF cErrorConditions = "1"
2649          Else
2650             IfVA evt_387AWarningFlagis equal to"1"AndVA evt_EditsProcessedFlagis equal to"1"
2651                BF cErrorConditions = "1"
2652             End If
2653          End If
2654       End If
2655       //
2656    Else
2657       // This record was de-selected for Ship Confirm (Action Code = D).    Indicate t
2658       // Calling Application the record has been removed from the ShipConfirm Cache.
2659       BF cRecordWritten = "0"
2660       BF cErrorConditions = "" ""
2661       // ***************************************************
2662       // CALL KIT PROCESSING TO REMOVE ANY COMPONENT RECORDS
2663       // ADDED TO THE SHIP CONFIRMATION AND SPLIT KIT CACHES
2664       // ***************************************************
2665       If VA evt_PO_DisplayKitItems is not equal to "1"
           And VA evt_CommitFlag is equal to "K"
           And VA evt_StockingType_F4102 is not equal to "C"
2666          Kit Processing for Shipment Confirmation
                 BF mnJobnumberA -> mnJobnumber
                 BF mnOrderNumber -> mnDocumentOrderNumber
                 BF szOrderType -> szOrderType
                 BF szOrderCompany -> szCompanyKeyOrderNo
                 BF mnLineNumber -> mnLineNumberOfKitParent
                 "1" -> cSuppressErrorMessage
                 BF szBranchPlant -> szBranchPlant
                 BF szComputerID -> szComputerID
                 BF cActionCode -> cActionCode
                 VA evt_Save_RecordWritten -> cRecordWritten
                 VA evt_PO_LotGroupName_LOTGRP -> szLotGroup
2667       End If
2668       // ***************************************************
2669       // CALL F4211 EDIT  WORK ORDER COMPONENTS TO
2670       // REMOVE RELATED TEXT LINES FROM CACHE
2671       // ***************************************************
2672       If VA evt_CommitFlag is equal to "K"
           Or VA evt_CommitFlag is equal to "H"
2673          If VA evt_GenerateWOFlag is equal to "Y"
              And VA evt_StockingType_F4102 is equal to "C"
2674             F4211 Edit Work Order Components
                    BF mnJobnumberA -> mnJobnumber
                    BF szComputerID -> szComputerID
                    BF mnOrderNumber -> mnDocumentOrderInvoiceE
                    BF szOrderType -> szOrderType
                    BF szOrderCompany -> szCompanyKey
                    BF mnLineNumber -> mnLineNumber
                    BF cActionCode -> cActionCode
                    "1" -> cSuppressErrorMessage
                    UNDEFINED X szErrorMessageID
                    UNDEFINED X cModeProcessing
                    UNDEFINED X szShipConfirmNextStatus
                    UNDEFINED X mnOriginalQuantityShipped
                    UNDEFINED X mnEnteredQuantityShipped
2675          End If
2676       End If
2677    End If
2678    //
2679    // ***************************************
2680    // Keep Track of XT4111 and B4200310 Cache records in P4205 until
2681    //  retrieval from Ship Cache on subsequent calls is working.
2682    BF mnB4200310LineNumber = VA evt_B4200310CacheLineNum
2683    BF mnXT4111LineNumber = VA evt_X4111Z1CacheLineNum
2684    //
2685    // ***************************************
2686    //
2687 End If
2688 //  End - Bypass Record.  Already relieved of On Hand.

Wednesday October 01, 2014  19:45
